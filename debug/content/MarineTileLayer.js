define(["require","leaflet"],function(e){var t=e("leaflet"),n=t.TileLayer.extend({initialize:function(e,n){t.Util.setOptions(this,n),this.url=e||"http://downloadqdc.garmin.com/GCSProxyServlet/MarineImages/{quadkey}.png"},getTileUrl:function(e){var t=this._getZoomForUrl();return this.url.replace("{quadkey}",this.tile2quad(e.x,e.y,t))},tile2quad:function(e,t,n){var r="";for(var i=n;i>0;i--){var s=0,o=1<<i-1;(e&o)!==0&&(s+=1),(t&o)!==0&&(s+=2),r+=s}return r},_animateZoom:function(e){this.zoomingIn=e.zoom>this._map.getZoom(),t.TileLayer.prototype._animateZoom.call(this,e)},_tileLoaded:function(){this._tilesToLoad--,this._animated&&t.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._clearBgBuffer())},_prepareBgBuffer:function(){var e=this._tileContainer,n=this._bgBuffer,r=this._getLoadedTilesPercentage(n),i=this._getLoadedTilesPercentage(e);if(n&&r>.5&&i<.5){e.style.visibility="hidden",this._stopLoadingImages(e);return}n.style.visibility="hidden",this.zoomingIn?(n.style.zIndex=1,e.style.zIndex=2):(n.style.zIndex=2,e.style.zIndex=1),delete this.zoomingIn,n.style[t.DomUtil.TRANSFORM]="",this._tileContainer=n,n=this._bgBuffer=e,this._stopLoadingImages(n),clearTimeout(this._clearBgBufferTimer)}});return n});