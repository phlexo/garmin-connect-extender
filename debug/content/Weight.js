define("views/weight/WeightChartView",["require","backbone","localizer","personalizer","utils/personalizer/NumberFormats","highcharts"],function(e){var t=e("backbone"),n=e("localizer"),r=e("personalizer"),i=e("utils/personalizer/NumberFormats"),s=e("highcharts"),o=864e5,u=t.View.extend({initialize:function(e){this.type=e.type,this.weightData=e.weightData,this.goalData=e.goalData,this.periodMin=e.periodMin.getTime(),this.periodMax=e.periodMax.getTime(),this.numberFormat=e.numberFormat,this.weightDisplayUnit=e.weightDisplayUnit},render:function(){var e=this.getWeightRange(),t=e.dataMax,r=e.dataMin,i=this;this.chartObj!=undefined&&this.chartObj.destroy(),Highcharts.setOptions({global:{useUTC:!1}}),this.chartObj=new Highcharts.Chart({chart:{renderTo:i.el,type:"area",backgroundColor:null,zoomType:"xy",spacingLeft:0,marginBottom:70,height:210,width:290,events:{load:function(e){i.$(".highcharts-legend-item rect").attr("height","2").attr("y","8"),i.$(".highcharts-legend-item image").remove();var t=i.$(".highcharts-legend-item text").get(),n;for(var r=0,s=t.length;r<s;r++)n=t[r],n.setAttribute("y",24),n.setAttribute("x",0)}}},credits:{enabled:!1},title:{text:""},plotOptions:{series:{events:{legendItemClick:function(){return!1}},states:{hover:{enabled:!1}}}},xAxis:{type:"datetime",labels:{formatter:function(){return n.formatDate(new Date(this.value),"ddd")}},tickInterval:o,gridLineWidth:1,gridLineColor:"#E8E8E8",startOfWeek:0,tickLength:0,min:this.periodMin,max:this.periodMax},yAxis:{title:{text:n.localize(i.getWeightLongUnit()),style:{fontSize:"12px",color:"#555"}},labels:{style:{fontSize:"9px"},x:-10,formatter:function(){return i.convertNumberByFormat(this.value)}},gridLineColor:"#E8E8E8",startOnTick:!1,max:t==null?null:t+.5,min:r==null?null:Math.max(r-.5,0)},series:[{fillOpacity:.4,type:"area",color:"#daf200",name:n.localize("weight"),enableMouseTracking:!0,data:this.weightData},{name:n.localize("goal"),type:"line",color:"#0D324B",step:"right",marker:{symbol:"url(/modern/images/highcharts/goal-checkmark.png)"},enableMouseTracking:!0,data:this.goalData}],tooltip:{formatter:function(){var e=new Date(this.x),t=n.formatDate(new Date(this.x),"MMM");return t+" "+e.getDate()+", "+e.getFullYear()+"<br />"+this.series.name+": <strong>"+i.convertNumberByFormat(this.y)+"</strong>"},style:{textAlign:"center",color:"#222"}},legend:{enabled:!0,floating:!0,align:"left",width:"100%",x:20,borderWidth:0,symbolWidth:100,itemWidth:160,itemStyle:{cursor:"default",color:"#222"},itemHoverStyle:{cursor:"default",color:"#222"}},exporting:{enabled:!1}})},convertNumberByFormat:function(e){return r.personalizeWeightWithoutConvert(e,i.PRECISION1_NOSEP)},getWeightRange:function(){var e=null,t=null;if(this.weightData.length>0){var n=-1,r=this.weightData.length-1;for(var i=this.weightData.length-1;i>=0;i--){if(this.weightData[i][0]<this.periodMin||this.weightData[i][0]>this.periodMax)continue;i>n&&(n=i),i<r&&(r=i)}if(n<r){n=this.weightData.length-1,r=0;for(var i=this.weightData.length-1;i>=0;i--){if(this.weightData[i][0]-this.periodMax<0)break;n=i}for(var i=0;i<this.weightData.length;i++){if(this.weightData[i][0]-this.periodMin>0)break;r=i}}else n!=this.weightData.length-1&&n++,r!=0&&r--;for(var i=n;i>=r;i--){var s=this.weightData[i][1];if(s=="--")continue;e==null?e=s:s>e&&(e=s),t==null?t=s:s<t&&(t=s)}}if(!this.goalData)return{dataMax:e,dataMin:t};for(var i=this.goalData.length-1;i>=0;i--){var o=this.goalData[i][1];e==null?e=o:o>e&&(e=o),t==null?t=o:o<t&&(t=o)}return{dataMax:e,dataMin:t}},getWeightLongUnit:function(){return this.weightDisplayUnit=="weight_unit_metric"?"kilograms":this.weightDisplayUnit=="weight_unit_statute"?"pounds":"stones"}});return u}),define("collections/weight/Weights",["backbone","models/weight/Weight"],function(e,t){var n={WEIGHTS_FETCHED:"WEIGHTS_FETCHED"},r=e.Collection.extend({model:t,initialize:function(e){this.fetching=!1,this.fetchSize=36288e5},url:function(){var e="/proxy/userprofile-service/userprofile/personal-information/weightWithOutbound/filterByDay?";return typeof this.fromTime!="undefined"&&(e+="from="+this.fromTime),typeof this.untilTime!="undefined"&&(typeof this.fromTime!="undefined"&&(e+="&"),e+="until="+this.untilTime),e},getCurrentWeight:function(){if(this.length>0)return this.at(0)},setPeriod:function(e,t){this.fromTime=e,this.untilTime=t},fetchMore:function(){if(!this.fetching){this.fetching=!0,this.fromTime-=this.fetchSize,this.untilTime-=this.fetchSize;var e=this;this.fetch({add:!0,remove:!1,success:function(t,r){t.fetching=!1;if(t){var i=t.length-r.length;for(var s=1;s<3;s++)r.length>=s&&e.remove(e.at(i-1));t.trigger(n.WEIGHTS_FETCHED)}},error:function(e,t){e.fetching=!1}})}}});return r.Events=n,r}),define("models/wellness/UserGoal",["backbone"],function(e){var t=e.Model.extend({initialize:function(e){this.displayName=e.displayName},urlRoot:function(){return+(this.displayName?this.displayName:"")},url:function(){var e="/proxy/wellness-service/wellness/wellness-goals/";return this.id&&(e+=this.id+"/"),e+=this.displayName,e},setDisplayName:function(e){this.displayName=e}});return t}),define("collections/wellness/UserGoals",["backbone","models/wellness/UserGoal","utils/date/DateUtil"],function(e,t,n){var r=e.Collection.extend({model:t,urlRoot:function(){return"/proxy/wellness-service/wellness/wellness-goals/"+this.displayName},url:function(){var e=this.urlRoot()+"?userGoalType="+this.userGoalType;return e},initialize:function(e){if(typeof e.displayName=="undefined")throw"User display name is required";if(typeof e.userGoalType=="undefined")throw"User goal type is required";this.displayName=e.displayName,this.userGoalType=e.userGoalType},findEffectiveUserGoal:function(e,t){var r=n.getDateFromISODateString(t).getTime();for(var i=0;i<this.length;i++){var s=this.at(i);if(s.get("userGoalCategoryPK")==e){var o=0,u=Number.MAX_VALUE,a=s.get("startDate"),f=s.get("endDate");a&&(o=n.getDateFromISODateString(a).getTime()),f&&(u=n.getDateFromISODateString(f).getTime());if(r>=o&&r<=u)return s}}return null}});return r}),define("text!widgets/weight/templates/NoticeWeightView.html",[],function(){return'<div class="widget-sheet-content-inner">\n    <p><%= text1 %><br/><%= text2 %></p>\n\n</div>\n'}),define("widgets/weight/views/NoticeWeightView",["underscore","backbone","moment","localizer","personalizer","text!widgets/weight/templates/NoticeWeightView.html"],function(e,t,n,r,i,s){var o=t.View.extend({initialize:function(t){var n=r.localize(i.getWeightUnitKey()),o=t.weight-t.previousWeight;o=parseFloat(o.toFixed(2)),o<=0?this.text1=r.localize("lose_weight",-1*o,n):this.text1=r.localize("gain_weight",o,n);var u=Math.abs(t.weight-t.userGoal);u=parseFloat(u.toFixed(2)),t.weight<t.userGoal&&t.previousWeight<=t.userGoal?this.text2=r.localize("weight_below_goal",u,n):t.weight>t.userGoal&&t.previousWeight>=t.userGoal?this.text2=r.localize("weight_above_goal",u,n):this.text2=r.localize("weight_match_goal"),this.template=e.template(s)},render:function(){var e=this,t=this.template({Localizer:r,text1:e.text1,text2:e.text2});return this.$el.html(t),this.el}});return o}),define("views/weight/RemoveGoalPromptView",["underscore","backbone","localizer","utils/extensions/Loadable","jquerymenus"],function(e,t,n,r){var i={ON_REMOVE_GOAL:"ON_REMOVE_GOAL"},s=t.View.extend(r),o=s.extend({propertyFiles:["/main/js/properties/weightwidget/weightwidget"],initialize:function(t){this.template=e.template(t.templateHtml)},render:function(){var e=this.template({Localizer:n});jQuery(this.el).html(e),jQuery(this.$(".confirm-false")).on("click",function(e){e.stopPropagation(),jQuery(e.target).closest(".popbox").hide().removeClass("active")});var t=this;jQuery(this.$(".confirm-true")).on("click",function(e){e.stopPropagation(),t.trigger(i.ON_REMOVE_GOAL),jQuery(e.target).closest(".popbox").hide().removeClass("active")}),this.$(".popbox").garminMenus()},onDependenciesLoaded:function(){this.render()}});return o.Events=i,o}),define("text!widgets/weight/templates/weight.html",[],function(){return'\n<div class="data-1">\n    <h3 class="data-bit"><a href="<%= url(\'/weight/weekly/\'+weekIdx) %>"><%= title %></a></h3>\n</div>\n\n<div class="chart-container top-xs">\n    <div class="chart chart-widget chart-area-weight">\n        <div class="weightChartPlaceholder"></div>\n    </div>\n</div>\n\n<div class="weight-entry-container top-s">\n    <div class="data-1">\n        <div class="data-bit">\n            <span class="input-append">\n                <input type="tel" id="weightTodayEntry" class="input-mini text-right">\n                <span class="st-label add-on"><%= weightUnit%></span>\n            </span>\n            <% if(displayWeightSecondInput == true) { %>\n            <span class="input-append">\n                <input type="tel" id="weightTodaySecondEntry" class="input-mini text-right">\n                <span class="lbs-label add-on"><%= Localizer.localize(\'weight_unit_statute\') %></span>\n            </span>\n            <% } %>\n            <button class="btn btn-form left-xs btn-save-weight"><%= Localizer.localize(\'button_save\') %></button>\n        </div>\n        <div class="data-label"><%= Localizer.localize(\'today_weight\') %></div>\n    </div>\n</div>\n<div class="row-fluid top-s">\n    <div class="span6 data-block xsmall">\n        <div class="data-bit"><%= previousWeight %></div>\n        <div class="data-label"><%= Localizer.localize(\'last_weight\') %></div>\n    </div>\n    <div class="span6 data-block xsmall">\n\n        <% if (previousGoal == \'--\') {  %>\n        <div class="weight-goal-create">\n            <a class="data-bit h6 colored add-goal-link" href="<%= url(\'/weight\') %>"><%= Localizer.localize(\'add_goal\')+\'...\' %></a>\n        </div>\n        <% } else { %>\n        <div class="data-bit"><%= previousGoal %></div>\n        <% } %>\n        <div class="data-label"><%= Localizer.localize(\'goal\') %></div>\n    </div>\n</div>\n\n\n\n'}),define("text!widgets/weight/templates/noData.html",[],function(){return'\n<div class="text-center">\n    <p class="top-xl"><%= Localizer.localize(\'no_weight_save\') %><br />\n        <a class="colored start-track-weight-link" href="#"><%= Localizer.localize(\'track_weight\') %></a></p>\n\n    <p class="top-xl"><%= Localizer.localize(\'no_goal_save\') %><br />\n        <a class="colored start-add-goal-link" href="<%= url(\'/weight\') %>"><%= Localizer.localize(\'add_goal\') %></a></p>\n</div>'}),define("text!templates/weight/RemoveGoalPromptView.html",[],function(){return'<div id="delete-goal-trigger" class="element popbox span2">\n    <div class="element-body top right">\n        <p><%= Localizer.localize(\'check_delete_goal\') %></p>\n        <div class="confirm-actions text-right">\n            <button class="btn btn-secondary btn-small confirm-false"><%= Localizer.localize(\'keep\') %></button>\n            <button class="btn btn-danger btn-small confirm-true"><%= Localizer.localize(\'delete\') %></button>\n        </div>\n    </div>\n</div>\n'}),define("widgets/weight/states/WeightState",["underscore","backbone","localizer","moment","personalizer","models/user/ViewerUserPreferences","models/user/ViewerUserBiometrics","views/main/WidgetStateView","views/weight/WeightChartView","collections/weight/Weights","models/weight/Weight","models/wellness/UserGoal","models/user/UserPreference","collections/wellness/UserGoals","utils/date/DateUtil","utils/parsers/NumberParser","models/user/ViewerSocialProfile","widgets/weight/views/NoticeWeightView","views/weight/RemoveGoalPromptView","views/utils/InlineEditView","text!widgets/weight/templates/weight.html","text!widgets/weight/templates/noData.html","text!templates/weight/RemoveGoalPromptView.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){var x=864e5,T=u.extend({name:"weightLarge",headerUrl:"/weight",titleKeyName:"title_weight_widget",menuKeyName:"menu_weight",stateClassName:"widget-large weight",templateHtml:w,noDataTemplateHtml:E,events:{"click .btn-save-weight":"onSaveWeightButtonClicked","click .start-track-weight-link":"onStartTrackWeightClicked"},initializeWidgetState:function(){this.weights=new f([],{});var e=r().endOf("day"),t=r(e),n=r(e).subtract(this.weights.fetchSize,"milliseconds");this.weights.setPeriod(n.valueOf(),t.valueOf()),this.firstWeight=new l({isFirst:!0}),this.userGoals=new p({displayName:this.getDisplayName(),userGoalType:4}),this.userProfilePK=m.get("profileId"),this.displayName=this.getDisplayName(),this.displayPeriodMin=null,this.displayPeriodMax=null,this.updateLatestWeight=!1,this.setFirstData=!1,this.numberFormat=this.userPreferences.getNumberFormat(),this.userPreferenceWeightUnit=new h({key:"weight_display_unit"}),this.parser||(this.parser=new v),this.timezoneOffset=(new Date).getTimezoneOffset()*6e4},provideDependencies:function(e,t){e.addModel({model:this.weights,required:!0}),e.addModel({model:this.firstWeight,required:!0}),e.addModel({model:this.userGoals,required:!0}),e.addModel({model:this.userPreferenceWeightUnit,required:!0})},getPreviousTwoWeight:function(){if(this.weights.length<2)return null;var e=this.weights.at(1).get("weight");return e=i.convertWeightToGivenUnit(e,this.weightDisplayUnit),e},getPreviousDate:function(){if(this.weights.length==0)return null;var e=this.weights.at(0).get("date");return e},getPreviousWeight:function(){if(this.weights.length==0)return null;var e=this.weights.at(0).get("weight");return e=i.convertWeightToGivenUnit(e,this.weightDisplayUnit),e},getPreviousGoal:function(){if(this.hasActiveGoal()==0)return null;var e;return e=this.userGoals.at(0).get("goalValue"),e=i.convertWeightToGivenUnit(e,this.weightDisplayUnit),e},onDependenciesLoaded:function(){return this.userPreferences.get("measurementSystem")==i.MeasurementSystems.STATUTE_UK?this.userPreferenceWeightUnit.get("value")!=null?this.weightDisplayUnit=this.userPreferenceWeightUnit.get("value"):this.weightDisplayUnit=i.WeightUnitKeys.STATUTE:this.weightDisplayUnit=i.getWeightUnitKey(),!0},fetchMore:function(){this.weights.once(f.Events.WEIGHTS_FETCHED,e.bind(this.fetchMoreComplete,this)),this.weights.fetchMore()},countDisplayPeriod:function(e){var t=r().endOf("day");this.weights.length>0?(this.setFirstData=!1,this.displayPeriodMax=r().endOf("day").subtract(7*e,"days").toDate()):this.displayPeriodMax=t.toDate(),this.displayPeriodMin=r(this.displayPeriodMax).subtract(6,"days").toDate()},hasActiveGoal:function(){return this.userGoals.length>0?this.userGoals.at(0).get("endDate")==null||typeof this.userGoals.at(0).get("endDate")=="undefined"?!0:!1:!1},formatWeightStringWithUnit:function(e){var t;if(this.weightDisplayUnit==i.WeightUnitKeys.STATUTE_UK){var r=e*i.ConversionFactors.GramsToSt,s=i.convertStoneToStLbs(r);t=s.stone+" "+n.localize(this.weightDisplayUnit),s.pounds!=0&&(t+=" "+s.pounds+" "+n.localize("weight_unit_statute"))}else t=i.personalizeWeight(e)+" "+n.localize(this.weightDisplayUnit);return t},provideModels:function(e){this.countDisplayPeriod(e);var t=!1,r=i.personalizeShortMonthDateRange(this.displayPeriodMin,this.displayPeriodMax,t,n),s=!1;this.weightDisplayUnit==i.WeightUnitKeys.STATUTE_UK&&(s=!0);var o="--";this.weights.length>0&&(o=this.formatWeightStringWithUnit(this.weights.at(0).get("weight")));var u="--";return this.hasActiveGoal()==1&&(u=this.formatWeightStringWithUnit(this.userGoals.at(0).get("goalValue"))),{title:r,previousWeight:o,previousGoal:u,weightUnit:n.localize(this.weightDisplayUnit),displayWeightSecondInput:s,weekIdx:e}},getMaxWeekNum:function(){if(this.weights.length==0)return 0;var e=r().endOf("day").valueOf(),t=r.utc(this.firstWeight.get("date")).startOf("day").valueOf()+this.timezoneOffset,n=(e-t)/x+1,i=Math.ceil(n/7);return i},getLoadedWeekNum:function(){if(this.weights.length==0)return 0;var e=r().endOf("day").valueOf(),t=r.utc(this.weights.at(this.weights.length-1).get("date")).startOf("day").valueOf()+this.timezoneOffset,n=(e-t)/x+1,i=Math.ceil(n/7);return i},formatFooter:function(e){var t,r=!1;return this.displayPeriodMin&&this.displayPeriodMax&&(t=i.personalizeShortMonthDateRange(this.displayPeriodMin,this.displayPeriodMax,r,n)),t},numLoadedPages:function(){return this.weights.length==0?this.setFirstData==1?1:0:this.getLoadedWeekNum()},maxPage:function(){return this.weights.length==0&&this.setFirstData==1?0:this.getMaxWeekNum()-1},postRender:function(e){if(this.weights.length==0&&this.setFirstData==0)return;if(this.displayPeriodMin==null||this.displayPeriodMax==null)return;var t=this.getWeightData();this.WeightChartView=new a({weightData:t,goalData:this.getGoalData(t),numberFormat:this.numberFormat,weightDisplayUnit:this.weightDisplayUnit,periodMin:r(this.displayPeriodMin).subtract(1,"days").toDate(),periodMax:this.displayPeriodMax,el:this.$(".weightChartPlaceholder")}),this.WeightChartView.render();var n=this.getPreviousGoal();n==null&&(n=0),this.hasActiveGoal()?this.resetGoalInputValue():this.$(".weight-goal-entry").hide();if(this.updateLatestWeight==1){var i=this.getPreviousWeight(),s=this.getPreviousTwoWeight(),o=new g({weight:i,previousWeight:s,userGoal:n});this.displaySheet(o,"","widget-sheet widget-sheet-bottom widget-sheet-no-data"),this.updateLatestWeight=!1}},resetGoalInputValue:function(){if(!this.hasActiveGoal())return;if(this.weightDisplayUnit==i.WeightUnitKeys.STATUTE_UK){var e=this.userGoals.at(0).get("goalValue"),t=e*i.ConversionFactors.GramsToSt,n=i.convertStoneToStLbs(t);this.$(".goal-edit-input").val(n.stone),this.$(".goal-edit-second-input").val(n.pounds)}else{var e=this.getPreviousGoal();this.$(".goal-edit-input").val(i.personalizeWeightWithoutConvert(e))}},getWeightData:function(){var e=[];if(this.weights.length==0)return e;for(var t=this.weights.length-1;t>=0;t--){var n=[],s=r.utc(this.weights.at(t).get("date")).startOf("day").valueOf()+this.timezoneOffset;n[0]=s,n[1]=i.convertWeightToGivenUnit(this.weights.at(t).get("weight"),this.weightDisplayUnit),e.push(n)}if(e.length>0){var n=[],o=r().endOf("day").valueOf();n[0]=o+x,n[1]=e[this.weights.length-1][1],e.push(n)}return e},getGoalData:function(e){var t=[];if(this.userGoals.length<1)return t;var n=0,s;for(var o=this.userGoals.length-1;o>=0;o--){var u=i.convertWeightToGivenUnit(this.userGoals.at(o).attributes.goalValue,this.weightDisplayUnit),a=r(this.userGoals.at(o).get("endDate")).endOf("day").valueOf();a<0&&(a=0);var f;o!=this.userGoals.length-1?f=s:f=0;var l=[],c=[];o==this.userGoals.length-1&&(l[0]=this.displayPeriodMin.getTime()-x,l[1]=u,t.push(l)),o==0&&this.userGoals.at(o).get("endDate")==null&&(c[0]=this.displayPeriodMax.getTime()+x,c[1]=u,t.push(c));if(e.length>0)for(var h=n;h<e.length-1;h++){var p=e[h][0],d=e[h][1];if(a!=0&&p>a||f!=0&&p<f)continue;if(d==u){var v=[];v[0]=e[h][0],v[1]=e[h][1],t.push(v),s=v[0],this.userGoals.at(o).endTime=e[h][0],n=h}if(h==0)continue;var m=e[h-1][1],g=e[h-1][0],v=[];if(d<u)m>u&&(v[0]=p-(p-g)*(u-d)/(m-d),v[1]=u);else if(m<u){var v=[];v[0]=g+(p-g)*(u-m)/(d-m),v[1]=u}if(v[0]&&v[1]){if(o<this.userGoals.length-1){var y=r(this.userGoals.at(o+1).get("endDate")).endOf("day").valueOf();if(v[0]<y)continue}t.push(v),s=v[0],this.userGoals.at(o).endTime=v[0],n=h}if(o>0&&p>this.userGoals.at(o-1).get("startTime"))break}}return t.sort(),t},onStartTrackWeightClicked:function(e){e.preventDefault(),this.setFirstData=!0,this.moveToPage(0)},validateWeight:function(e,t){var r=e.search(/^[0-9]+(,[0-9]{3})*(\.[0-9]+)?$/),i=e.search(/^[0-9]+(\.[0-9]{3})*(,[0-9]+)?$/);if(this.numberFormat=="decimal_comma"&&i!=-1||this.numberFormat=="decimal_period"&&r!=-1){var s;try{s=this.parser.parse(e)||0}catch(o){s=0}return s>=1e3||s<0?(alert(n.localize(t,e)),!1):!0}return alert(n.localize("invalid_char_message")),!1},getWeightValueInDisplayUnit:function(e,t){var n;try{n=this.parser.parse(e)||0}catch(r){n=0}if(typeof t!="undefined"&&t.length>0){var s;try{s=this.parser.parse(t)||0}catch(r){s=0}var o=s*i.ConversionFactors.LbsToSt;return n+o}return n},onSaveWeightButtonClicked:function(e){e.preventDefault();var t=r(),n=t.format("YYYY-MM-DD"),s=this.$("input[id=weightTodayEntry]").val(),o,u=this;if(this.validateWeight(s,"invalid_weight_message")==0)return;if(this.weightDisplayUnit==i.WeightUnitKeys.STATUTE_UK){o=this.$("input[id=weightTodaySecondEntry]").val();if(o.length>0&&this.validateWeight(o,"invalid_weight_message")==0)return}var a="kg";this.weightDisplayUnit==i.WeightUnitKeys.STATUTE?a="lbs":this.weightDisplayUnit==i.WeightUnitKeys.STATUTE_UK&&(a="st");var f;this.weightDisplayUnit==i.WeightUnitKeys.STATUTE_UK?f=this.getWeightValueInDisplayUnit(s,o):f=this.getWeightValueInDisplayUnit(s);var c=new l({value:f,unitKey:a,date:n});c.save(c.attributes,{success:function(){u.weightCallback(+f)}})},weightCallback:function(e){this.weightDisplayUnit==i.WeightUnitKeys.METRIC?o.updateWeightInKg(e):this.weightDisplayUnit==i.WeightUnitKeys.STATUTE?o.updateWeightInLbs(e):o.updateWeightInSt(e);var t=!1,n=this.getPreviousDate();if(n!=null){var s=r().endOf("day").valueOf(),u=r.utc(n).endOf("day").valueOf()+this.timezoneOffset;s>u&&this.hasActiveGoal()&&(t=!0)}var a=r(),f=a.format("YYYY-MM-DD"),c=new l({weight:i.convertWeightToGramsByUnit(e,this.weightDisplayUnit),date:(new Date(f)).getTime()});if(this.weights.length>0){var u=r.utc(n).endOf("day").valueOf()+this.timezoneOffset;d.isToday(new Date(u))&&this.weights.remove(this.weights.at(0))}this.weights.add(c,{at:0}),this.firstWeight=this.weights.at(this.weights.length-1),this.updateLatestWeight=t;var h=this.getCurrentPageIndex();this.setFirstData==1&&(h=0),this.moveToPage(h)}});return T}),define("widgets/weight/states/SmallState",["underscore","backbone","views/main/WidgetStateView","text!templates/main/Widget/SmallWidgetContent.html"],function(e,t,n,r){var i=n.extend({titleKeyName:"title_weight_widget",menuKeyName:"title_widget_small",headerUrl:"/weight",name:"weightSmall",stateClassName:"widget widget-small",templateHtml:r,noDataTemplateHtml:r,showFooter:!1,showHeaderTitle:!1,events:{"click [href^=\\/health]":"onWeightLinkClicked"},maxPage:function(){return 0},numLoadedPages:function(){return 1},provideModels:function(){return{classIconName:"icon-weight"}},onWeightLinkClicked:function(e){e.preventDefault(),Window.App.navigate("/health",{trigger:!0})}});return i}),define("widgets/weight/Weight",["underscore","backbone","localizer","personalizer","views/main/WidgetView","widgets/weight/states/WeightState","widgets/weight/states/SmallState"],function(e,t,n,r,i,s,o){return i.extend({viewStates:[{name:"large-state",views:[{titleKeyName:"title_weight_widget",name:"weightLarge",widgetStateView:s}]},{name:"small-state",views:[{name:"weightSmall",widgetStateView:o}]}],propertyFiles:["/main/js/properties/weightwidget/weightwidget","/main/js/properties/common/common","/main/js/properties/units/units"]})});