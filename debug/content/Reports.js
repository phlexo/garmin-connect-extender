/* Chosen v1.6.1 | (c) 2011-2016 by Harvest | MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md */

define("models/reports/StatisticsAvailability",["backbone"],function(e){var t=e.Model.extend({url:function(){return"/proxy/userstats-service/statistics/availability/"+this.getDisplayName()},setDisplayName:function(e){this.displayName=e},getDisplayName:function(){return this.displayName},hasMetricAvailable:function(e,t){var n=this.get(e),r=!1;return n&&n.length>0&&_.each(n,function(e){e.metric.metricName===t&&e.available&&(r=!0)}),r},getMetricId:function(e,t){var n=this.get(e),r=_.find(n,function(e){return e.metric.metricName===t});return r?r.metric.metricId:""}});return t}),define("collections/activity/Activities",["backbone","models/activity/Activity"],function(e,t){var n=!1,r={NO_MORE_ACTIVITIES:"NO_MORE_ACTIVITIES",ACTIVITIES_FETCHED:"ACTIVITIES_FETCHED"},i=e.Collection.extend({model:t,initialize:function(e,t){this.initializeBaseCollection(e,t)},initializeBaseCollection:function(e,t){this.pollStartTime=null,this.pollingEnabled=!0,this.fetching=!1,this.maxCount=t.maxCount,this.fetchSize=t.fetchSize,this.startIndex=t.startIndex,this.startIndex||(this.startIndex=1),this.mayHaveMoreModels=!0,this.comparator=function(e){var t=e.get("startTimeGMT");return typeof t!="undefined"&&t!=null?-Date.parse(t):-9999999999}},fetch:function(t){if(typeof t=="undefined"||t==null)t={};return t.cache=!1,this.log("Activities.fetch("+JSON.stringify(t)+")"),this.log("Activities.fetch "+this.url()),e.Collection.prototype.fetch.call(this,t)},parse:function(e,t){return this.requestorRelationship=e.requestorRelationship,this.length+e.activityList.length<this.startIndex+this.fetchSize-1&&(this.mayHaveMoreModels=!1,this.trigger(r.NO_MORE_ACTIVITIES)),e.activityList},getDisplayName:function(){return this.displayName},poll:function(){if(!this.fetching){this.log("Activities.poll()"),this.fetching=!0,this.length>0?this.pollStartTime=this.first().get("startTimeGMT"):this.pollStartTime=null;var e=this;this.fetch({add:!0,success:function(e){e.fetching=!1},error:e.onPollingError})}},onPollingError:function(e,t){e.fetching=!1,e.pollingEnabled=!1,typeof console!="undefined"&&typeof console.log!="undefined"&&console.log((new Date).toString()+" - "+"Error polling: "+t.status+" "+t.statusText)},isPollingEnabled:function(){return this.pollingEnabled},fetchMore:function(){this.pollStartTime=null;if(!this.fetching){this.fetching=!0,this.startIndex+=this.fetchSize;if(this.startIndex>this.maxCount){this.trigger(r.NO_MORE_ACTIVITIES);return}this.startIndex+this.fetchSize-1>this.maxCount&&(this.fetchSize=this.maxCount-this.startIndex+1);var e=this;this.log("Activities.fetchMore()"),this.fetch({add:!0,remove:!1,success:e.onFetchMoreSuccess,error:e.onFetchMoreError})}},onFetchMoreSuccess:function(e,t){e.fetching=!1,e.trigger(r.ACTIVITIES_FETCHED),e.length<e.startIndex+e.fetchSize-1&&(e.mayHaveMoreModels=!1,e.trigger(r.NO_MORE_ACTIVITIES))},onFetchMoreError:function(e,t){e.fetching=!1,typeof console!="undefined"&&typeof console.log!="undefined"&&console.log((new Date).toString()+" - "+"fetching more: "+t.status+" "+t.statusText)},log:function(e){n&&typeof console!="undefined"&&typeof console.log!="undefined"&&console.log((new Date).toString()+" - "+e)}});return i.Events=r,i}),define("collections/activity/ActivitiesByActivityType",["require","collections/activity/Activities","utils/date/DateFormatter"],function(e){var t=e("collections/activity/Activities"),n=e("utils/date/DateFormatter"),r=t.extend({url:function(){var e="/proxy/activitylist-service/activities/list/"+this.getDisplayName(),t=[];return this.activityTypeId&&t.push("activityTypeId="+this.activityTypeId),this.fetchSize&&t.push("limit="+this.fetchSize),this.startTimestampLocal?t.push("startTimestampLocal="+this.startTimestampLocal):t.push("startTimestampLocal="+n.formatConnectTimestamp(new Date(0))),this.endTimestampLocal?t.push("endTimestampLocal="+this.endTimestampLocal):t.push("endTimestampLocal="+n.formatConnectTimestamp(new Date)),this.startIndex&&t.push("start="+this.startIndex),e+(t.length>0?"?"+t.join("&"):"")},initialize:function(e,t){this.initializeBaseCollection(e,t);if(typeof t.displayName=="undefined")throw"Invalid displayName in ActivitiesByActivityType Collection.";if(typeof t.activityTypeId=="undefined")throw"Invalid activity type id in ActivitiesByActivityType Collection.";this.displayName=t.displayName,this.activityTypeId=t.activityTypeId,this.fetchSize=t.fetchSize,this.startTimestampLocal=t.startTimestampLocal,this.endTimestampLocal=t.endTimestampLocal}});return r}),define("models/indicators/UsageIndicators",["require","backbone"],function(e){var t=e("backbone");return t.Model.extend({url:"/proxy/web-gateway/snapshot/usageIndicators",hasIndicator:function(e,t){if(e==="device")return this.get("deviceBasedIndicators")[t];if(e==="activity"){var n=this.get("performanceBasedIndicators").activityIndicators[t];return n&&n.lastActivityDate!==null}if(e==="wellness")return this.get("performanceBasedIndicators").wellnessIndicators[t];if(e==="sleep")return this.get("sleepBasedIndicators")[e]},checkDeviceIndicator:function(e){var t=this.get("deviceBasedIndicators");return t&&t[e]}})}),define("utils/ActivityTypeMapper",[],function(){return{Cycling:"cycling",Running:"running",Hiking:"hiking",Walking:"walking",Swimming:"swimming",FitnessEquip:"fitness_equipment",Other:"other",Uncategorized:"uncategorized",Yoga:"yoga",StrengthTraining:"strength_training",Cardio:"indoor_cardio"}}),define("utils/ReportTypes",["require"],function(e){return{ACTIVITY_ACTIVE_CALORIES:"ACTIVITY_ACTIVE_CALORIES",ACTIVITY_AVERAGE_SPEED:"ACTIVITY_AVERAGE_SPEED",ACTIVITY_AVERAGE_PACE:"ACTIVITY_AVERAGE_PACE",ACTIVITY_AVERAGE_SWIM_PACE:"ACTIVITY_AVERAGE_SWIM_PACE",ACTIVITY_AVERAGE_HEART_RATE:"ACTIVITY_AVERAGE_HEART_RATE",ACTIVITY_MAX_HEART_RATE:"ACTIVITY_MAX_HEART_RATE",ACTIVITY_AVERAGE_POWER:"ACTIVITY_AVERAGE_POWER",ACTIVITY_AVERAGE_BIKE_CADENCE:"ACTIVITY_AVERAGE_BIKE_CADENCE",ACTIVITY_AVERAGE_RUN_CADENCE:"ACTIVITY_AVERAGE_RUN_CADENCE",ACTIVITY_NORMALIZED_POWER:"ACTIVITY_NORMALIZED_POWER",ACTIVITY_MAX_20_MIN_AVERAGE_POWER:"ACTIVITY_MAX_20_MIN_AVERAGE_POWER",ACTIVITY_VERTICAL_OSCILLATION:"ACTIVITY_VERTICAL_OSCILLATION",ACTIVITY_GROUND_CONTACT_TIME:"ACTIVITY_GROUND_CONTACT_TIME",ACTIVITY_AVERAGE_STROKES:"ACTIVITY_AVERAGE_STROKES",ACTIVITY_AVERAGE_SWOLF:"ACTIVITY_AVERAGE_SWOLF",ACTIVITY_MINIMUM_SWOLF:"ACTIVITY_MINIMUM_SWOLF",ACTIVITY_NUMBER_OF_ACTIVITIES:"ACTIVITY_NUMBER_OF_ACTIVITIES",ACTIVITY_TOTAL_DISTANCE:"ACTIVITY_TOTAL_DISTANCE",ACTIVITY_TOTAL_DURATION:"ACTIVITY_TOTAL_DURATION",ACTIVITY_TRAINING_STRESS_SCORE:"ACTIVITY_TRAINING_STRESS_SCORE",ACTIVITY_VO2_MAX:"ACTIVITY_VO2_MAX",ACTIVITY_VO2_MAX_CYCLING:"ACTIVITY_VO2_MAX_CYCLING",ACTIVITY_AVG_GROUND_CONTACT_BALANCE:"ACTIVITY_AVG_GROUND_CONTACT_BALANCE",ACTIVITY_AVG_STRIDE_LENGTH:"ACTIVITY_AVG_STRIDE_LENGTH",ACTIVITY_AVG_VERTICAL_RATIO:"ACTIVITY_AVG_VERTICAL_RATIO",ACTIVITY_AVG_LACTATE_THRESHOLD_BPM:"ACTIVITY_AVG_LACTATE_THRESHOLD_BPM",ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC:"ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC",COMMON_TOTAL_CALORIES:"COMMON_TOTAL_CALORIES",WELLNESS_TOTAL_STEPS:"WELLNESS_TOTAL_STEPS",SLEEP_SLEEP_DURATION:"SLEEP_SLEEP_DURATION",FOOD_CALORIES_CONSUMED:"FOOD_CALORIES_CONSUMED",ACTIVITY_MAX_FTP:"ACTIVITY_MAX_FTP",FOOD_CALORIES_REMAINING:"FOOD_CALORIES_REMAINING",WELLNESS_FLOORS_ASCENDED:"WELLNESS_FLOORS_ASCENDED",WELLNESS_MODERATE_INTENSITY_MINUTES:"WELLNESS_MODERATE_INTENSITY_MINUTES",WELLNESS_RESTING_HEART_RATE:"WELLNESS_RESTING_HEART_RATE",ACTIVITY_AEROBIC_TRAINING_EFFECT:"ACTIVITY_AEROBIC_TRAINING_EFFECT",ACTIVITY_ANAEROBIC_TRAINING_EFFECT:"ACTIVITY_ANAEROBIC_TRAINING_EFFECT",WELLNESS_AVERAGE_STRESS:"WELLNESS_AVERAGE_STRESS",ACTIVITY_TRAINING_STATUS:"ACTIVITY_TRAINING_STATUS",ACTIVITY_HRV_STRESS_TEST:"ACTIVITY_HRV_STRESS_TEST",STRENGTH_TRAINING:"STRENGTH_TRAINING"}}),define("utils/ReportChartUtil",["localizer"],function(e){var t={personalizeDateRange:function(t,n,r,i,s){var o=t.split("-"),t=new Date(o[0],o[1]-1,o[2],0,0,0),u=n.split("-"),a=new Date(u[0],u[1]-1,u[2],0,0,0),f="";switch(r){case"daily":case"weekly":t.getFullYear()==a.getFullYear()?e.currentDateFormatKey=="yyyymmdd"?f=e.formatShortDate(t,null)+" - "+e.formatShortDateNoYear(a,null):f=e.formatShortDateNoYear(t,null)+" - "+e.formatShortDate(a,null):f=e.formatShortDate(t,null)+" - "+e.formatShortDate(a,null);break;case"monthly":case"yearly":var l=t.getFullYear().toString(),c=(t.getMonth()+1).toString(),h=a.getFullYear().toString(),p=(a.getMonth()+1).toString(),d=e.localize("month.abbr."+(c.length>1?c:"0"+c)),v=e.localize("month.abbr."+(p.length>1?p:"0"+p));e.currentDateFormatKey=="yyyymmdd"?f=l+" "+d+(l==h?" - "+v:" - "+h+" "+v):f=d+(l==h?" - "+v:" "+l+" - "+v)+" "+h}return f},formatDate:function(e){var t=new Date;t.setHours(12),t.setMinutes(0),t.setMilliseconds(0),t.setDate(t.getDate()+e);var n=t.getFullYear().toString(),r=(t.getMonth()+1).toString(),i=t.getDate().toString();return n+"-"+(r.length>1?r:"0"+r)+"-"+(i.length>1?i:"0"+i)},formatAdjustedStartDate:function(e,t,n){var r=new Date,i=r.getDay(),s=0,o=0;switch(n){case"daily":o=0;break;case"weekly":switch(t.get("firstDayOfWeek").dayName){case"saturday":s=6;break;case"monday":s=1}i<s?o=s-i-1:o=6-(i-s);break;case"monthly":case"yearly":var u=(new Date(r.getFullYear(),r.getMonth()+1,0)).getDate();o=u-r.getDate()+1}r.setDate(r.getDate()+(e+o));var a=r.getFullYear().toString(),f=(r.getMonth()+1).toString(),l=r.getDate().toString();return a+"-"+(f.length>1?f:"0"+f)+"-"+(l.length>1?l:"0"+l)},determineNumberOfDays:function(e,t){var n=e.split("-"),e=new Date(n[0],n[1]-1,n[2],0,0,0),r=t.split("-"),i=new Date(r[0],r[1]-1,r[2],0,0,0);return Math.round((i-e)/864e5)+1},determineNonZeroMetricsFound:function(e,t){var n=!1;if(e&&e.length>0){var r=e.at(0),i=r.get("metricsMap"),s=i[t];if(s)for(var o=0;o<s.length;o++)if(s[o].value&&s[o].value>0){n=!0;break}}return n},determineNonNullMetricsFound:function(e,t){var n=!1;if(e&&e.length>0){var r=e.at(0),i=r.get("metricsMap"),s=i[t];if(s)for(var o=0;o<s.length;o++)if(s[o].value!=null){n=!0;break}}return n},determineNonZeroActivityMetricsFound:function(e,t){var n=!1;if(e.length>0){var r=e[0],i=r.running,s=r.cycling,o=r.swimming,u=r.walking,a=r.hiking,f=r.other,l=r.fitness_equipment,c=r.yoga;if(i){var h=i.metricsMap,p=h[t];for(var d=0;d<p.length;d++)if(p[d].value>0)return!0}if(s){var h=s.metricsMap,p=h[t];for(var d=0;d<p.length;d++)if(p[d].value>0)return!0}if(o){var h=o.metricsMap,p=h[t];for(var d=0;d<p.length;d++)if(p[d].value>0)return!0}if(u){var h=u.metricsMap,p=h[t];for(var d=0;d<p.length;d++)if(p[d].value>0)return!0}if(a){var h=a.metricsMap,p=h[t];for(var d=0;d<p.length;d++)if(p[d].value>0)return!0}if(f){var h=f.metricsMap,p=h[t];for(var d=0;d<p.length;d++)if(p[d].value>0)return!0}if(l){var h=l.metricsMap,p=h[t];for(var d=0;d<p.length;d++)if(p[d].value>0)return!0}if(c){var h=c.metricsMap,p=h[t];for(var d=0;d<p.length;d++)if(p[d].value>0)return!0}}return n}};return t}),define("views/report/ChartView",["underscore","backbone","localizer","personalizer","utils/ReportChartUtil","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i){return t.View.extend({initialize:function(e){this.report=e.report,this.reportType=e.reportType,this.activeTab=e.activeTab,this.metricList=e.metricList,this.metricPeriod=e.metricPeriod,this.userPreferences=e.userPreferences,this.daysInMonth=e.daysInMonth,this.chartType=e.chartType,this.chartFormat=e.chartFormat,this.currentDateOffset=e.currentDateOffset,this.initExportData(),this.initializeChart(e)},initExportData:function(){this.exportDataCount=0,this.exportData={title:n.localize(this.report.metricName),rows:[]}},initializeChart:function(e){},render:function(){this.calcStartingMonthDayAndYearNumbers(),this.getXAxisCategories(),this.yAxisTitle=this.determineYAxisTitle(),this.yAxisLabel=this.determineYAxisLabel(),this.initializeChartSeries(),this.createExportDataRowHeader(),this.compileStats();if(this.chartSeries==null)return;this.options=this.createOption(),this.setCategories(),this.setSeries(),this.customizeOptions(),this.chartObj=new Highcharts.Chart(this.el,this.options)},initializeChartSeries:function(){this.chartSeries={}},createExportDataRowHeader:function(){},determineYAxisLabel:function(){return""},compileStats:function(){this.metricList.each(this.processMetricList,this)},processMetricList:function(e){var t=e.get("metricsMap"),n=t[this.report.metricName];if(n){this.metricAvailable=n.length;for(var r=0;r<n.length;r++)this.addMetricToDataset(n[r])}},createZeroArray:function(){switch(this.metricPeriod){case"daily":return[0,0,0,0,0,0,0];case"weekly":return[0,0,0,0];case"monthly":return[0,0,0,0,0,0];case"yearly":return[0,0,0,0,0,0,0,0,0,0,0,0]}},createNullArray:function(){switch(this.metricPeriod){case"daily":return[null,null,null,null,null,null,null];case"weekly":return[null,null,null,null];case"monthly":return[null,null,null,null,null,null];case"yearly":return[null,null,null,null,null,null,null,null,null,null,null,null]}},getXAxisCategories:function(){switch(this.metricPeriod){case"daily":this.getDailyCategories();break;case"weekly":this.getWeeklyCategories();break;case"monthly":this.getMonthlyCategories();break;case"yearly":this.getYearlyCategories()}},createOption:function(){var e={chart:{renderTo:"report-graph",type:this.chartType,backgroundColor:"transparent"},exporting:{enabled:!1},credits:{enabled:!1},title:{text:""},xAxis:{},yAxis:{min:0,title:{text:"",style:{color:"#222"}},labels:{formatter:function(){return r.formatDecimalNumber(this.value,0)+" "+n.yAxisLabel}},plotLines:[{value:0,width:1,color:"#808080"}],allowDecimals:!1},legend:{enabled:!1,itemStyle:{fontWeight:"normal"}},plotOptions:{},tooltip:{}},n=this;return this.chartFormat=="widget"?(e.chart.height=180,e.chart.width=290,e.chart.events={click:function(e){e.preventDefault();var r="/report/"+n.report.metricId+"/"+n.reportType+"/"+n.activeTab;t.history.navigate(r,{trigger:!0})}}):e.chart.zoomType="x",e},setCategories:function(){this.options.xAxis={categories:this.categories}},setSeries:function(){this.options.series=e.toArray(this.chartSeries)},getDailyCategories:function(){this.categories=[];for(var e=-6;e<=0;e++){var t=new Date;t.setHours(12),t.setMinutes(0),t.setMilliseconds(0),t.setDate(t.getDate()+this.currentDateOffset),t.setDate(t.getDate()+e);var r="",i=t.getDay().toString();r=n.localize("day."+i+".short"),this.categories.push(r)}},getWeeklyCategories:function(){this.categories=[];var e=this.userPreferences.get("firstDayOfWeek"),t="0";switch(e.dayName){case"saturday":t="6";break;case"monday":t="1"}for(var r=this.daysInMonth;r<=0;r++){var i=new Date;i.setHours(12),i.setMinutes(0),i.setMilliseconds(0),i.setDate(i.getDate()+this.currentDateOffset),i.setDate(i.getDate()+r);var s="",o=i.getDay().toString();if(o==t){var u=i.getDate().toString(),a=(i.getMonth()+1).toString(),f=this.userPreferences.get("dateFormat"),s="";f.formatKey=="mmddyyyy"||f.formatKey=="yyyymmdd"?s=n.localize("month.abbr."+(a.length>1?a:"0"+a))+" "+u:s=u+" "+n.localize("month.abbr."+(a.length>1?a:"0"+a)),this.categories.push(s)}}},getMonthlyCategories:function(){this.categories=[];var e=this.startMonth,t=this.startYear;for(var r=0;r<6;r++){var i=new Date(t,e+1,0,0,0,0,0),s=i.getMonth()+1;this.categories.push(n.localize("month.abbr."+(s>9?s:"0"+s))),e++,e>11&&(t++,e=0)}},getYearlyCategories:function(){this.categories=[];var e=this.startMonth,t=this.startYear;for(var r=0;r<12;r++){var i=new Date(t,e+1,0,0,0,0,0),s=i.getMonth()+1;this.categories.push(n.localize("month.abbr."+(s>9?s:"0"+s))),e++,e>11&&(t++,e=0)}},calcStartingMonthDayAndYearNumbers:function(){var e=new Date;e.setHours(12),e.setMinutes(0),e.setMilliseconds(0),e.setDate(e.getDate()+this.currentDateOffset);switch(this.metricPeriod){case"daily":break;case"weekly":var t=new Date(e.setMonth(e.getMonth()-1));break;case"monthly":var t=new Date(e.setMonth(e.getMonth()-5));break;case"yearly":var t=new Date(e.setMonth(e.getMonth()-11))}this.startMonth=e.getMonth(),this.startYear=e.getFullYear(),this.startDate=e.getDate()},calculateDailyDataIndex:function(e){var t=i.formatDate(this.currentDateOffset),n=i.determineNumberOfDays(e,t),r=7-n;return r<0||r>6?-1:r},calculateWeeklyDataIndex:function(e){var t=e.split("-"),r=new Date(t[0],t[1]-1,t[2],0,0,0),i=r.getMonth()+1,s=r.getDate(),o=this.userPreferences.get("dateFormat"),u="";o.formatKey=="mmddyyyy"||o.formatKey=="yyyymmdd"?u=n.localize("month.abbr."+(i>9?i:"0"+i))+" "+s:u=s+" "+n.localize("month.abbr."+(i>9?i:"0"+i));var a=this.categories.indexOf(u);return a<0||a>3?-1:a},calculateMonthlyDataIndex:function(e){var t=n.localize("month.abbr."+(e>9?e:"0"+e)),r=this.categories.indexOf(t);return r<0||r>5?-1:r},calculateYearlyDataIndex:function(e,t){var n=e-this.startMonth+(t-this.startYear)*12;return n<0||n>11?-1:n},determineDataIndex:function(e){var t="";switch(this.metricPeriod){case"daily":t=this.calculateDailyDataIndex(e.calendarDate);break;case"weekly":t=this.calculateWeeklyDataIndex(e.startDateOfWeek);break;case"monthly":var n=e.month;t=this.calculateMonthlyDataIndex(n.monthId);break;case"yearly":var n=e.month;t=this.calculateYearlyDataIndex(n.monthId-1,n.year,this.startMonth,this.startYear)}return t},getExportData:function(){return this.exportData}})}),define("views/report/ActivityChartView",["underscore","backbone","localizer","personalizer","utils/ActivityTypeMapper","utils/ReportTypes","views/report/ChartView","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s,o){return o.extend({determineYAxisTitle:function(){switch(this.report.metricName){case s.ACTIVITY_NUMBER_OF_ACTIVITIES:return n.localize("activities");case s.ACTIVITY_TOTAL_DISTANCE:return this.reportType=="swimming"?this.userPreferences.get("measurementSystem")=="metric"?n.localize("meter"):n.localize("yard"):this.userPreferences.get("measurementSystem")=="metric"?n.localize("label_distance_unit_metric"):n.localize("label_distance_unit_statute");case s.ACTIVITY_TOTAL_DURATION:return n.localize("label_duration_unit");case s.ACTIVITY_ACTIVE_CALORIES:return n.localize("label_calories")}},createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("activity.type.label"),n.localize("value.label")]}},customizeOptions:function(){var e=this;switch(this.report.metricName){case s.ACTIVITY_NUMBER_OF_ACTIVITIES:this.options.plotOptions={series:{showCheckbox:!1,selected:!0,states:{hover:{enabled:!0,halo:null}}}};break;case s.ACTIVITY_TOTAL_DISTANCE:case s.ACTIVITY_TOTAL_DURATION:case s.ACTIVITY_ACTIVE_CALORIES:this.options.plotOptions={column:{stacking:"normal",dataLabels:{enabled:!1,color:"white"}},series:{stacking:"normal",showCheckbox:!1,selected:!0}}}switch(this.report.metricName){case s.ACTIVITY_NUMBER_OF_ACTIVITIES:this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+" "+n.localize("activities")}};break;case s.ACTIVITY_TOTAL_DISTANCE:var t=this.userPreferences.get("measurementSystem")=="metric"?n.localize("distance_unit_metric"):n.localize("distance_unit_statute");e.reportType=="swimming"&&(t=this.userPreferences.get("measurementSystem")=="metric"?n.localize("distance.meter"):n.localize("distance.yard")),this.options.yAxis.title.text=e.yAxisTitle,this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+r.formatDecimalNumber(this.y,2)+" "+t+"<br/>"+n.localize("total")+": "+r.formatDecimalNumber(Math.round(this.point.stackTotal*100)/100,2)+" "+t}};break;case s.ACTIVITY_TOTAL_DURATION:var t=n.localize("activity_duration_unit");this.options.yAxis.title.text=e.yAxisTitle,this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+r.formatDecimalNumber(this.y,2)+" "+t+"<br/>"+n.localize("total")+": "+r.formatDecimalNumber(Math.round(this.point.stackTotal*100)/100,2)+" "+t}};break;case s.ACTIVITY_ACTIVE_CALORIES:this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+r.formatDecimalNumber(this.y,0)+" "+n.localize("label_calories_abbr")+"<br/>"+n.localize("total")+": "+r.formatDecimalNumber(this.point.stackTotal,0)+" "+n.localize("label_calories_abbr")}}}this.options.legend.enabled=!0},processMetricList:function(e){var t=e.get("running"),r=e.get("cycling"),s=e.get("swimming"),o=e.get("walking"),u=e.get("fitness_equipment"),a=e.get("hiking"),f=e.get("yoga"),l=e.get("other");if(t){this.chartSeries[i.Running]={color:"#11a9ed",name:n.localize("activity_type_running"),data:this.createZeroArray(this.metricPeriod)},this.activityType="running";var c=t.metricsMap,h=c[this.report.metricName];for(var p=0;p<h.length;p++)this.addMetricToDataset(h[p])}if(r){this.chartSeries[i.Cycling]={color:"#ff0035",name:n.localize("activity_type_cycling"),data:this.createZeroArray(this.metricPeriod)},this.activityType="cycling";var c=r.metricsMap,h=c[this.report.metricName];for(var p=0;p<h.length;p++)this.addMetricToDataset(h[p])}if(s){this.chartSeries[i.Swimming]={color:"#ff9e0d",name:n.localize("activity_type_swimming"),data:this.createZeroArray(this.metricPeriod)},this.activityType="swimming";var c=s.metricsMap,h=c[this.report.metricName];for(var p=0;p<h.length;p++)this.addMetricToDataset(h[p])}if(o){this.chartSeries[i.Walking]={color:"#72ea24",name:n.localize("activity_type_walking"),data:this.createZeroArray(this.metricPeriod)},this.activityType="walking";var c=o.metricsMap,h=c[this.report.metricName];for(var p=0;p<h.length;p++)this.addMetricToDataset(h[p])}if(u){this.chartSeries[i.FitnessEquip]={color:"#0e334c",name:n.localize("activity_type_fitness_equipment"),data:this.createZeroArray(this.metricPeriod)},this.activityType="fitness_equipment";var c=u.metricsMap,h=c[this.report.metricName];for(var p=0;p<h.length;p++)this.addMetricToDataset(h[p])}if(a){this.chartSeries[i.Hiking]={color:"#632d5c",name:n.localize("activity_type_hiking"),data:this.createZeroArray(this.metricPeriod)},this.activityType="hiking";var c=a.metricsMap,h=c[this.report.metricName];for(var p=0;p<h.length;p++)this.addMetricToDataset(h[p])}if(f){this.chartSeries[i.Yoga]={color:"#632d5c",name:n.localize("activity_type_yoga"),data:this.createZeroArray(this.metricPeriod)},this.activityType="yoga";var c=f.metricsMap,h=c[this.report.metricName];for(var p=0;p<h.length;p++)this.addMetricToDataset(h[p])}if(l){this.chartSeries[i.Other]={color:"#cf23b8",name:n.localize("activity_type_other"),data:this.createZeroArray(this.metricPeriod)},this.activityType="other";var c=l.metricsMap,h=c[this.report.metricName];for(var p=0;p<h.length;p++)this.addMetricToDataset(h[p])}},addMetricToDataset:function(e){var t=this.determineDataIndex(e);if(t>=0){if(this.chartSeries[this.activityType])switch(this.report.metricName){case s.ACTIVITY_NUMBER_OF_ACTIVITIES:this.value=e.value;break;case s.ACTIVITY_TOTAL_DISTANCE:this.reportType=="all"?this.value=Math.round(r.convertDistance(e.value)*100)/100:this.value=Math.round(r.convertDistance(e.value,this.activityType)*100)/100;break;case s.ACTIVITY_TOTAL_DURATION:this.value=Math.round(e.value/60*100)/100;break;case s.ACTIVITY_ACTIVE_CALORIES:this.value=Math.round(r.convertCalories(e.value))}this.chartSeries[this.activityType].data[t]=this.value,this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],n.localize(this.activityType),this.value]}}}})}),function(){var e,t,n,r,i,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return"OPTGROUP"===e.nodeName.toUpperCase()?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,n,r,i,s,o;for(t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:this.escapeExpression(e.label),title:e.title?e.title:void 0,children:0,disabled:e.disabled,classes:e.className}),s=e.childNodes,o=[],r=0,i=s.length;i>r;r++)n=s[r],o.push(this.add_option(n,t,e.disabled));return o},e.prototype.add_option=function(e,t,n){return"OPTION"===e.nodeName.toUpperCase()?(""!==e.text?(null!=t&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,title:e.title?e.title:void 0,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t,group_label:null!=t?this.parsed[t].label:null,classes:e.className,style:e.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},e.prototype.escapeExpression=function(e){var t,n;return null==e||e===!1?"":/[\&\<\>\"\'\`]/.test(e)?(t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/&(?!\w+;)|[\<\>\"\'\`]/g,e.replace(n,function(e){return t[e]||"&amp;"})):e},e}(),r.select_to_array=function(e){var t,n,i,s,o;for(n=new r,o=e.childNodes,i=0,s=o.length;s>i;i++)t=o[i],n.add_node(t);return n.parsed},t=function(){function e(t,n){this.form_field=t,this.options=null!=n?n:{},e.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers(),this.on_ready())}return e.prototype.set_default_values=function(){var e=this;return this.click_test_action=function(t){return e.test_active_click(t)},this.activate_action=function(t){return e.activate_field(t)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0,this.group_search=null!=this.options.group_search?this.options.group_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null!=this.options.single_backstroke_delete?this.options.single_backstroke_delete:!0,this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null!=this.options.display_selected_options?this.options.display_selected_options:!0,this.display_disabled_options=null!=this.options.display_disabled_options?this.options.display_disabled_options:!0,this.include_group_label_in_selected=this.options.include_group_label_in_selected||!1,this.max_shown_results=this.options.max_shown_results||Number.POSITIVE_INFINITY,this.case_sensitive_search=this.options.case_sensitive_search||!1},e.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||e.default_multiple_text:this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||e.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||e.default_no_result_text},e.prototype.choice_label=function(e){return this.include_group_label_in_selected&&null!=e.group_label?"<b class='group-name'>"+e.group_label+"</b>"+e.html:e.html},e.prototype.mouse_enter=function(){return this.mouse_on_container=!0},e.prototype.mouse_leave=function(){return this.mouse_on_container=!1},e.prototype.input_focus=function(e){var t=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return t.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},e.prototype.input_blur=function(e){var t=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return t.blur_test()},100))},e.prototype.results_option_build=function(e){var t,n,r,i,s,o,u;for(t="",i=0,u=this.results_data,s=0,o=u.length;o>s&&(n=u[s],r="",r=n.group?this.result_add_group(n):this.result_add_option(n),""!==r&&(i++,t+=r),(null!=e?e.first:void 0)&&(n.selected&&this.is_multiple?this.choice_build(n):n.selected&&!this.is_multiple&&this.single_set_selected_text(this.choice_label(n))),!(i>=this.max_shown_results));s++);return t},e.prototype.result_add_option=function(e){var t,n;return e.search_match&&this.include_option_in_results(e)?(t=[],e.disabled||e.selected&&this.is_multiple||t.push("active-result"),!e.disabled||e.selected&&this.is_multiple||t.push("disabled-result"),e.selected&&t.push("result-selected"),null!=e.group_array_index&&t.push("group-option"),""!==e.classes&&t.push(e.classes),n=document.createElement("li"),n.className=t.join(" "),n.style.cssText=e.style,n.setAttribute("data-option-array-index",e.array_index),n.innerHTML=e.search_text,e.title&&(n.title=e.title),this.outerHTML(n)):""},e.prototype.result_add_group=function(e){var t,n;return(e.search_match||e.group_match)&&e.active_options>0?(t=[],t.push("group-result"),e.classes&&t.push(e.classes),n=document.createElement("li"),n.className=t.join(" "),n.innerHTML=e.search_text,e.title&&(n.title=e.title),this.outerHTML(n)):""},e.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing?this.winnow_results():void 0},e.prototype.reset_single_select_options=function(){var e,t,n,r,i;for(r=this.results_data,i=[],t=0,n=r.length;n>t;t++)e=r[t],e.selected?i.push(e.selected=!1):i.push(void 0);return i},e.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},e.prototype.results_search=function(e){return this.results_showing?this.winnow_results():this.results_show()},e.prototype.winnow_results=function(){var e,t,n,r,i,s,o,u,a,f,l,c;for(this.no_results_clear(),r=0,s=this.get_search_text(),e=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),a=new RegExp(e,"i"),n=this.get_search_regex(e),c=this.results_data,f=0,l=c.length;l>f;f++)t=c[f],t.search_match=!1,i=null,this.include_option_in_results(t)&&(t.group&&(t.group_match=!1,t.active_options=0),null!=t.group_array_index&&this.results_data[t.group_array_index]&&(i=this.results_data[t.group_array_index],0===i.active_options&&i.search_match&&(r+=1),i.active_options+=1),t.search_text=t.group?t.label:t.html,(!t.group||this.group_search)&&(t.search_match=this.search_string_match(t.search_text,n),t.search_match&&!t.group&&(r+=1),t.search_match?(s.length&&(o=t.search_text.search(a),u=t.search_text.substr(0,o+s.length)+"</em>"+t.search_text.substr(o+s.length),t.search_text=u.substr(0,o)+"<em>"+u.substr(o)),null!=i&&(i.group_match=!0)):null!=t.group_array_index&&this.results_data[t.group_array_index].search_match&&(t.search_match=!0)));return this.result_clear_highlight(),1>r&&s.length?(this.update_results_content(""),this.no_results(s)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight())},e.prototype.get_search_regex=function(e){var t,n;return t=this.search_contains?"":"^",n=this.case_sensitive_search?"":"i",new RegExp(t+e,n)},e.prototype.search_string_match=function(e,t){var n,r,i,s;if(t.test(e))return!0;if(this.enable_split_word_search&&(e.indexOf(" ")>=0||0===e.indexOf("["))&&(r=e.replace(/\[|\]/g,"").split(" "),r.length))for(i=0,s=r.length;s>i;i++)if(n=r[i],t.test(n))return!0},e.prototype.choices_count=function(){var e,t,n,r;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,r=this.form_field.options,t=0,n=r.length;n>t;t++)e=r[t],e.selected&&(this.selected_option_count+=1);return this.selected_option_count},e.prototype.choices_click=function(e){return e.preventDefault(),this.results_showing||this.is_disabled?void 0:this.results_show()},e.prototype.keyup_checker=function(e){var t,n;switch(t=null!=(n=e.which)?n:e.keyCode,this.search_field_scale(),t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(e.preventDefault(),this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:case 18:break;default:return this.results_search()}},e.prototype.clipboard_event_checker=function(e){var t=this;return setTimeout(function(){return t.results_search()},50)},e.prototype.container_width=function(){return null!=this.options.width?this.options.width:""+this.form_field.offsetWidth+"px"},e.prototype.include_option_in_results=function(e){return this.is_multiple&&!this.display_selected_options&&e.selected?!1:!this.display_disabled_options&&e.disabled?!1:e.empty?!1:!0},e.prototype.search_results_touchstart=function(e){return this.touch_started=!0,this.search_results_mouseover(e)},e.prototype.search_results_touchmove=function(e){return this.touch_started=!1,this.search_results_mouseout(e)},e.prototype.search_results_touchend=function(e){return this.touch_started?this.search_results_mouseup(e):void 0},e.prototype.outerHTML=function(e){var t;return e.outerHTML?e.outerHTML:(t=document.createElement("div"),t.appendChild(e),t.innerHTML)},e.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)||/IEMobile/i.test(window.navigator.userAgent)||/Windows Phone/i.test(window.navigator.userAgent)||/BlackBerry/i.test(window.navigator.userAgent)||/BB10/i.test(window.navigator.userAgent)||/Android.*Mobile/i.test(window.navigator.userAgent)?!1:!0},e.default_multiple_text="Select Some Options",e.default_single_text="Select an Option",e.default_no_result_text="No results match",e}(),e=jQuery,e.fn.extend({chosen:function(r){return t.browser_is_supported()?this.each(function(t){var i,s;return i=e(this),s=i.data("chosen"),"destroy"===r?void (s instanceof n&&s.destroy()):void (s instanceof n||i.data("chosen",new n(this,r)))}):this}}),n=function(t){function n(){return i=n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.setup=function(){return this.form_field_jq=e(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},n.prototype.set_up_html=function(){var t,n;return t=["chosen-container"],t.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&t.push(this.form_field.className),this.is_rtl&&t.push("chosen-rtl"),n={"class":t.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(n.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=e("<div />",n),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default"><span>'+this.default_text+'</span><div><b><i class="icon-pointer-down"></i></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior()},n.prototype.on_ready=function(){return this.form_field_jq.trigger("chosen:ready",{chosen:this})},n.prototype.register_observers=function(){var e=this;return this.container.bind("touchstart.chosen",function(t){return e.container_mousedown(t),t.preventDefault()}),this.container.bind("touchend.chosen",function(t){return e.container_mouseup(t),t.preventDefault()}),this.container.bind("mousedown.chosen",function(t){e.container_mousedown(t)}),this.container.bind("mouseup.chosen",function(t){e.container_mouseup(t)}),this.container.bind("mouseenter.chosen",function(t){e.mouse_enter(t)}),this.container.bind("mouseleave.chosen",function(t){e.mouse_leave(t)}),this.search_results.bind("mouseup.chosen",function(t){e.search_results_mouseup(t)}),this.search_results.bind("mouseover.chosen",function(t){e.search_results_mouseover(t)}),this.search_results.bind("mouseout.chosen",function(t){e.search_results_mouseout(t)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(t){e.search_results_mousewheel(t)}),this.search_results.bind("touchstart.chosen",function(t){e.search_results_touchstart(t)}),this.search_results.bind("touchmove.chosen",function(t){e.search_results_touchmove(t)}),this.search_results.bind("touchend.chosen",function(t){e.search_results_touchend(t)}),this.form_field_jq.bind("chosen:updated.chosen",function(t){e.results_update_field(t)}),this.form_field_jq.bind("chosen:activate.chosen",function(t){e.activate_field(t)}),this.form_field_jq.bind("chosen:open.chosen",function(t){e.container_mousedown(t)}),this.form_field_jq.bind("chosen:close.chosen",function(t){e.input_blur(t)}),this.search_field.bind("blur.chosen",function(t){e.input_blur(t)}),this.search_field.bind("keyup.chosen",function(t){e.keyup_checker(t)}),this.search_field.bind("keydown.chosen",function(t){e.keydown_checker(t)}),this.search_field.bind("focus.chosen",function(t){e.input_focus(t)}),this.search_field.bind("cut.chosen",function(t){e.clipboard_event_checker(t)}),this.search_field.bind("paste.chosen",function(t){e.clipboard_event_checker(t)}),this.is_multiple?this.search_choices.bind("click.chosen",function(t){e.choices_click(t)}):this.container.bind("click.chosen",function(e){e.preventDefault()})},n.prototype.destroy=function(){return e(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},n.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field()):(this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus.chosen",this.activate_action))},n.prototype.container_mousedown=function(t){return this.is_disabled||(t&&"mousedown"===t.type&&!this.results_showing&&t.preventDefault(),null!=t&&e(t.target).hasClass("search-choice-close"))?void 0:(this.active_field?this.is_multiple||!t||e(t.target)[0]!==this.selected_item[0]&&!e(t.target).parents("a.chosen-single").length||(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},n.prototype.container_mouseup=function(e){return"ABBR"!==e.target.nodeName||this.is_disabled?void 0:this.results_reset(e)},n.prototype.search_results_mousewheel=function(e){var t;return e.originalEvent&&(t=e.originalEvent.deltaY||-e.originalEvent.wheelDelta||e.originalEvent.detail),null!=t?(e.preventDefault(),"DOMMouseScroll"===e.type&&(t=40*t),this.search_results.scrollTop(t+this.search_results.scrollTop())):void 0},n.prototype.blur_test=function(e){return!this.active_field&&this.container.hasClass("chosen-container-active")?this.close_field():void 0},n.prototype.close_field=function(){return e(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},n.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},n.prototype.test_active_click=function(t){var n;return n=e(t.target).closest(".chosen-container"),n.length&&this.container[0]===n[0]?this.active_field=!0:this.close_field()},n.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=r.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},n.prototype.result_do_highlight=function(e){var t,n,r,i,s;if(e.length){if(this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),r=parseInt(this.search_results.css("maxHeight"),10),s=this.search_results.scrollTop(),i=r+s,n=this.result_highlight.position().top+this.search_results.scrollTop(),t=n+this.result_highlight.outerHeight(),t>=i)return this.search_results.scrollTop(t-r>0?t-r:0);if(s>n)return this.search_results.scrollTop(n)}},n.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},n.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},n.prototype.update_results_content=function(e){return this.search_results.html(e)},n.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},n.prototype.set_tab_index=function(e){var t;return this.form_field.tabIndex?(t=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=t):void 0},n.prototype.set_label_behavior=function(){var t=this;return this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=e("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0?this.form_field_label.bind("click.chosen",function(e){return t.is_multiple?t.container_mousedown(e):t.activate_field()}):void 0},n.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},n.prototype.search_results_mouseup=function(t){var n;return n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),n.length?(this.result_highlight=n,this.result_select(t),this.search_field.focus()):void 0},n.prototype.search_results_mouseover=function(t){var n;return n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),n?this.result_do_highlight(n):void 0},n.prototype.search_results_mouseout=function(t){return e(t.target).hasClass("active-result")?this.result_clear_highlight():void 0},n.prototype.choice_build=function(t){var n,r,i=this;return n=e("<li />",{"class":"search-choice"}).html("<span>"+this.choice_label(t)+"</span>"),t.disabled?n.addClass("search-choice-disabled"):(r=e("<a />",{"class":"search-choice-close","data-option-array-index":t.array_index}),r.bind("click.chosen",function(e){return i.choice_destroy_link_click(e)}),n.append(r)),this.search_container.before(n)},n.prototype.choice_destroy_link_click=function(t){return t.preventDefault(),t.stopPropagation(),this.is_disabled?void 0:this.choice_destroy(e(t.target))},n.prototype.choice_destroy=function(e){return this.result_deselect(e[0].getAttribute("data-option-array-index"))?(this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),e.parents("li").first().remove(),this.search_field_scale()):void 0},n.prototype.results_reset=function(){return this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},n.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},n.prototype.result_select=function(e){var t,n;return this.result_highlight?(t=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?t.removeClass("active-result"):this.reset_single_select_options(),t.addClass("result-selected"),n=this.results_data[t[0].getAttribute("data-option-array-index")],n.selected=!0,this.form_field.options[n.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(n):this.single_set_selected_text(this.choice_label(n)),(e.metaKey||e.ctrlKey)&&this.is_multiple||this.results_hide(),this.show_search_field_default(),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[n.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,e.preventDefault(),this.search_field_scale())):void 0},n.prototype.single_set_selected_text=function(e){return null==e&&(e=this.default_text),e===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").html(e)},n.prototype.result_deselect=function(e){var t;return t=this.results_data[e],this.form_field.options[t.options_index].disabled?!1:(t.selected=!1,this.form_field.options[t.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[t.options_index].value}),this.search_field_scale(),!0)},n.prototype.single_deselect_control_build=function(){return this.allow_single_deselect?(this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")):void 0},n.prototype.get_search_text=function(){return e("<div/>").text(e.trim(this.search_field.val())).html()},n.prototype.winnow_results_set_highlight=function(){var e,t;return t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),e=t.length?t.first():this.search_results.find(".active-result").first(),null!=e?this.result_do_highlight(e):void 0},n.prototype.no_results=function(t){var n;return n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),n.find("span").first().html(t),this.search_results.append(n),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},n.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},n.prototype.keydown_arrow=function(){var e;return this.results_showing&&this.result_highlight?(e=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(e):void 0:this.results_show()},n.prototype.keyup_arrow=function(){var e;return this.results_showing||this.is_multiple?this.result_highlight?(e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},n.prototype.keydown_backstroke=function(){var e;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(e=this.search_container.siblings("li.search-choice").last(),e.length&&!e.hasClass("search-choice-disabled")?(this.pending_backstroke=e,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},n.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},n.prototype.keydown_checker=function(e){var t,n;switch(t=null!=(n=e.which)?n:e.keyCode,this.search_field_scale(),8!==t&&this.pending_backstroke&&this.clear_backstroke(),t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:this.results_showing&&e.preventDefault();break;case 32:this.disable_search&&e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:e.preventDefault(),this.keydown_arrow()}},n.prototype.search_field_scale=function(){var t,n,r,i,s,o,u,f,l;if(this.is_multiple){for(r=0,u=0,s="position:absolute; left: -1000px; top: -1000px; display:none;",o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],f=0,l=o.length;l>f;f++)i=o[f],s+=i+":"+this.search_field.css(i)+";";return t=e("<div />",{style:s}),t.text(this.search_field.val()),e("body").append(t),u=t.width()+25,t.remove(),n=this.container.outerWidth(),u>n-10&&(u=n-10),this.search_field.css({width:u+"px"})}},n}(t)}.call(this),define("lib/chosen.jquery",function(){}),define("text!templates/report/ExerciseFilterView.html",[],function(){return'<select class="chosen-select">\n    <option value=""><%= defaultText %></option>\n<% for(var i = 0; i < exercises.length; i++) { %>\n    <option value="<%= exercises[i].exerciseKey %>"><%= exercises[i].exerciseName %></option>\n<% } %>\n</select>'}),define("views/report/ExerciseFilterView",["require","underscore","backbone","localizer","personalizer","lib/chosen.jquery","text!templates/report/ExerciseFilterView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("personalizer"),s=e("lib/chosen.jquery"),o=e("text!templates/report/ExerciseFilterView.html"),u={EXERCISE_FILTER_SELECTED:"EXERCISE_FILTER_SELECTED"},a=n.View.extend({template:t.template(o),events:{"change .chosen-select":"onExerciseSelected"},initialize:function(e){this.metricsList=e.metricsList},render:function(){this.$el.html(this.template({Localizer:r,defaultText:r.localize("all_exercises"),exercises:this.buildExerciseList()})),this.setupChosen()},setExerciseList:function(e){this.metricsList=e},setupChosen:function(){this.$(".chosen-select").chosen({disable_search_threshold:1,search_contains:!0,no_results_text:r.localize("exercise_not_found"),width:"95%"})},buildExerciseList:function(){var e=[],n={UNKNOWN:!0};return t.each(this.metricsList.models,function(i){t.each(i.get("exerciseSummaries"),function(t){var i=t.subCategory||t.category;n[i]||(e.push({exerciseName:t.subCategory?r.localize("exercise_type_"+t.subCategory):r.localize("category_type_"+t.category),exerciseKey:i}),n[i]=!0)})}),e=t.sortBy(e,"exerciseName"),e},onExerciseSelected:function(){var e=this.$(".chosen-select"),t=e.val();this.trigger(u.EXERCISE_FILTER_SELECTED,t)}});return a.Events=u,a}),define("views/report/FloorsClimbedChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i){return i.extend({determineYAxisTitle:function(){return n.localize("label_floors_climbed_unit")},customizeOptions:function(){var e=this;this.options.plotOptions={column:{dataLabels:{enabled:!1,color:"white"}},series:{stacking:"normal",showCheckbox:!1,selected:!0}},this.options.tooltip={formatter:function(){var t=e.goalSeries.goal.data[this.point.x],i=e.chartSeries.complete.data[this.point.x],s=e.chartSeries.descend.data[this.point.x];return i||(i=e.chartSeries.incomplete.data[this.point.x]),"<b>"+this.x+"</b><br/>"+n.localize("floors_ascended")+": "+r.formatDecimalNumber(i,0)+" "+n.localize("label_floors_climbed_unit")+"<br/>"+n.localize("label_floors_climbed_goal")+": "+r.formatDecimalNumber(t,0)+" "+n.localize("label_floors_climbed_unit")+"<br/>"+n.localize("floors_descended")+": "+r.formatDecimalNumber(-s,0)+" "+n.localize("label_floors_climbed_unit")}},this.options.yAxis={min:null,title:null,labels:{formatter:function(){return Math.abs(this.value)}}}},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.remaining={color:"#dddddd",name:n.localize("step.remaining"),data:this.createZeroArray(this.metricPeriod)},this.chartSeries.incomplete={color:"#11a9ed",name:n.localize("floors_ascended"),data:this.createZeroArray(this.metricPeriod)},this.chartSeries.complete={color:"#80ea40",name:n.localize("floors_ascended"),data:this.createZeroArray(this.metricPeriod)},this.chartSeries.descend={color:"#b0e1f7",name:n.localize("floors_descended"),data:this.createZeroArray(this.metricPeriod)},this.goalSeries={},this.goalSeries.goal={name:n.localize("step.goal"),data:this.createZeroArray(this.metricPeriod)}},createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("floors_ascended"),n.localize("step.goal"),n.localize("floors_descended")]}},processMetricList:function(e){this.metricsMap=e.get("metricsMap");var t=this.metricsMap.WELLNESS_FLOORS_ASCENDED;if(t)for(var n=0;n<t.length;n++)this.addMetricToDataset(t[n])},addMetricToDataset:function(e){var t=this.determineDataIndex(e);if(t>=0){var n=this.getGoalValue(t),r=this.getDescendValue(t),i=Math.floor(e.value);this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],i||0,n||0,r||0]},i>=n?(this.chartSeries.remaining.data[t]=0,this.chartSeries.complete.data[t]=i):(this.chartSeries.remaining.data[t]=n-i,this.chartSeries.incomplete.data[t]=i),this.goalSeries.goal.data[t]=n,this.chartSeries.descend.data[t]=-r}},getDescendValue:function(e){var t=0,n=this.metricsMap.WELLNESS_FLOORS_DESCENDED;for(var r=0;r<n.length;r++){var i=n[r],s=this.determineDataIndex(i);if(s==e){t=Math.floor(i.value);break}}return t},getGoalValue:function(e){var t=0,n=this.metricsMap.WELLNESS_USER_FLOORS_ASCENDED_GOAL;for(var r=0;r<n.length;r++){var i=n[r],s=this.determineDataIndex(i);if(s==e){t=Math.round(i.value);break}}return t}})}),define("views/report/FoodChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","utils/ReportTypes","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s){return i.extend({createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",this.yAxisTitle]}},determineYAxisTitle:function(){return n.localize("label_calories")},customizeOptions:function(){this.options.plotOptions={column:{dataLabels:{enabled:!1,color:"white"}},series:{stacking:"normal",showCheckbox:!1,selected:!0}},this.options.yAxis.title={text:this.yAxisTitle},this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+r.formatDecimalNumber(this.y,0)}},this.report.metricName==s.FOOD_CALORIES_REMAINING&&(this.options.yAxis.min=null)},initializeChartSeries:function(){this.chartSeries={},this.chartSeries[0]={color:"#11a9ed",name:this.yAxisTitle,data:this.createZeroArray(this.metricPeriod)}},addMetricToDataset:function(e){var t=this.determineDataIndex(e);t>=0&&this.chartSeries[0]&&(this.chartSeries[0].data[t]=e.value,this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],e.value]})}})}),define("views/report/AllDayStressChartView",["require","underscore","backbone","localizer","views/report/ChartView","highcharts"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("views/report/ChartView"),s=e("highcharts"),o=i.extend({createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",r.localize("WELLNESS_AVERAGE_STRESS")]}},determineYAxisTitle:function(){return r.localize("WELLNESS_AVERAGE_STRESS")},customizeOptions:function(){this.options.plotOptions={series:{showCheckbox:!1,selected:!0,states:{hover:{enabled:!0,halo:null}}}},this.options.yAxis.title={text:this.determineYAxisTitle()},this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+r.localize("stress_level")+": "+this.y}},this.minAvgValue&&(this.options.yAxis.plotLines=[{value:this.minAvgValue,color:"black",dashStyle:"solid",width:2,label:{text:r.localize("average")+" = "+this.minAvgValue},zIndex:5}])},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.stress={type:"line",name:r.localize("label_stress"),data:this.createNullArray(this.metricPeriod),color:"#11a9ed"}},processMetricList:function(e){var t=e.get("metricsMap"),n=t.WELLNESS_AVERAGE_STRESS,r=0,i=0;this.seriesType="stress";if(n)for(var s=0,o=n.length;s<o;s++)n[s].value&&n[s].value>=0&&(this.addMetricToDataset(n[s]),r+=n[s].value,i++);i>0&&(this.minAvgValue=Math.round(r/i))},addMetricToDataset:function(e){var t=this.determineDataIndex(e);t>=0&&e.value!==null&&e.value>=0&&this.chartSeries[this.seriesType]&&(this.chartSeries[this.seriesType].data[t]=e.value,this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],e.value]})}});return o}),define("models/user/LatestUserBiometrics",["backbone"],function(e){var t={LACTATE_THRESHOLD_SPEED:"lactateThresholdSpeed",LACTATE_THRESHOLD_BPM:"lactateThresholdHeartRate",FTP:"functionalThresholdPower"},n=e.Model.extend({url:function(){return"/proxy/userprofile-service/biometric/current/"+this.displayName},initialize:function(e){this.displayName=e.displayName}});return n.BiometricConstants=t,n}),define("collections/user/UserBiometricRanges",["backbone"],function(e){var t={FTP_POWER:"functionalThresholdPower"},n=e.Collection.extend({model:e.Model,initialize:function(e){this.range=e.range},url:function(){return"/proxy/userprofile-service/biometric/bioRanges/"+this.range},filterByGender:function(e){var t=this.filter(function(t){return t.get("gender")==e});return new n(t)}});return n.BiometricRangeConstants=t,n}),define("collections/user/UserBiometricWeights",["underscore","backbone","utils/date/DateFormatter"],function(e,t,n){var r=t.Collection.extend({model:t.Model,initialize:function(t){e.isUndefined(t)||e.isUndefined(t.dates)?this.searchDatesArray=[]:e.isArray(t.dates)?this.searchDatesArray=t.dates:this.searchDatesArray=[t.dates]},url:function(){if(this.searchDatesArray.length==0)throw new Error("Dates must be given.");return"/proxy/biometric-service/biometric/weightByDate?"+this.buildParameterList()},setSearchDates:function(e){this.searchDatesArray=e},addSearchDate:function(e){this.searchDatesArray.push(e)},buildParameterList:function(){var t="";for(var r=0;r<this.searchDatesArray.length;r++){var i=this.searchDatesArray[r];e.isDate(i)&&(i=n.formatISODate(i)),t+="date="+i,r+1<this.searchDatesArray.length&&(t+="&")}return t}});return r}),define("text!templates/report/GaugeChartView.html",[],function(){return'<span class="gauge-chart-placeholder"></span>'}),define("views/highcharts/base/GaugeChartView",["underscore","backbone","text!templates/report/GaugeChartView.html","highcharts","highchartsmore","highchartsexport"],function(e,t,n){var r=t.View.extend({tagName:"span",initialize:function(t){this.template=e.template(n),this._series=[],this.initExportData(),this.currentMax=t.currentMax,this.categories=t.categories,this.useStrictMinMax=t.useStrictMinMax,this.categoriesMapper=t.categoriesMapper,this.categoryExportCallback=t.categoryExportCallback,this._minValue=t.minValue||0,this._maxValue=t.maxValue||100,this.chartOptions=t.chartOptions||{},this.categoryMetadata=t.categoryMetadata,this.containerClass=t.containerClass,this.setAttributes()},setAttributes:function(){this.containerClass&&this.$el.addClass(this.containerClass)},render:function(){this.initializeChartSeries(),this.highChartOptions=jQuery.extend(!0,{},this.getDefaultOptions(),this.chartOptions);var e=this.template({});return this.$el.html(e),this.$el.highcharts(this.highChartOptions),this},getChartOptions:function(){return this.highChartOptions},setExportDataTitle:function(e){this._exportData.title=e},addSeriesData:function(e){this._series.push(e)},addExportData:function(){this._exportData.rows.push({values:arguments})},initExportData:function(){this._exportData={title:"",rows:[]}},getExportData:function(){return this._exportData},initializeChartSeries:function(){this.chartSeries={},this.categories.each(function(e){var t="",n="",r="",i=this.categoriesMapper[e.get(this.categoryMetadata.categoryKey)],s=0,o=0;if(i){t=i.type,n=i.color,r=i.name,s=e.get(this.categoryMetadata.categoryRangeMin),o=e.get(this.categoryMetadata.categoryRangeMax),s==null&&(s=0);if(o==null||o<=s)o=Math.max(this.currentMax==null?0:this.currentMax,s+1);this.useStrictMinMax||(e.get(this.categoryMetadata.categoryKey)===this.categoryMetadata.categoryMin?(this._minValue=s,this.currentMax<this._minValue&&(this._minValue=this.currentMax,s=this._minValue)):e.get(this.categoryMetadata.categoryKey)===this.categoryMetadata.categoryMax&&(this._maxValue=o,this.currentMax>this._maxValue&&(this._maxValue=this.currentMax,o=this._maxValue))),this.chartSeries[t]={color:n,name:r,from:s,to:o,thickness:"40%"},this.addExportData(this.categoryExportCallback(t,e))}},this),this.chartSeries=e.toArray(this.chartSeries),this.chartSeries=e.sortBy(this.chartSeries,function(e){return-e.to},this)},getDefaultOptions:function(){var e={chart:{type:"gauge",backgroundColor:null,spacingTop:0,spacingLeft:0,spacingRight:0,spacingBottom:0,marginTop:22,marginBottom:0,width:231,height:176},credits:{enabled:!1},title:{text:"",verticalAlign:"bottom",x:0,y:-20,style:{fontSize:"10px",color:"#888"}},exporting:{enabled:!1},pane:{startAngle:-105,endAngle:105,background:[{backgroundColor:"transparent",borderWidth:0}]},plotOptions:{gauge:{dataLabels:{color:"#222",borderWidth:0,y:15,x:0,enabled:!0,style:{fontSize:"24px"},formatter:function(){return this.y.toFixed(0)}},dial:{backgroundColor:"#222",baseLength:"0%",baseWidth:15,radius:"25%",topWidth:1,rearLength:"0%",borderWidth:1},pivot:{radius:"5%"}}},yAxis:{min:this._minValue,max:this._maxValue,minorTickInterval:null,lineColor:"#fafafa",tickInterval:1,tickLength:0,tickPixelInterval:30,tickWidth:1,tickPosition:"inside",tickColor:"#fafafa",labels:{step:1,distance:7,rotation:"auto",style:{color:"#AAA",fontSize:"10px"}},title:{enabled:!1},plotBands:this.chartSeries},series:this._series};return e}});return r}),define("text!templates/report/FTPChartView.html",[],function(){return'<div class="data-block xlarge text-center ftp-info top-l bottom-s">\n    <div class="data-bit"><%= ftpValue %></div>\n    <span class="data-label"><%= Localizer.localize(\'ACTIVITY_MAX_FTP\') %></span>\n</div>'}),define("views/report/FTPChartView",["underscore","backbone","localizer","personalizer","utils/ModelSynchronizer","models/user/LatestUserBiometrics","models/user/ViewerUserPreferences","models/user/ViewerUserBiometrics","collections/user/UserBiometricRanges","collections/user/UserBiometricWeights","utils/ReportTypes","utils/date/DateParser","views/highcharts/base/GaugeChartView","text!templates/report/FTPChartView.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d={NO_DATA_AVAILABLE:"NO_DATA_AVAILABLE"},v=t.View.extend({initialize:function(t){this.chartFormat=t.chartFormat,this.report=t.report,this.reportType=t.reportType,this.categories=null,this.modelSynchronizer=new i,this.ftpMaxToggle=t.ftpMaxToggle||"ftp-watts",this.weight=null,this.loaded=!1,this.latestUserBiometrics=new s({displayName:o.get("displayName")}),this.userBiometricRanges=new a({range:a.BiometricRangeConstants.FTP_POWER}),this.template=e.template(p)},getChartOptions:function(){var e={chart:{renderTo:"report-graph",width:231,height:this.chartFormat=="widget"?176:198},title:{text:n.localize("max_avg_power_unit")+"/"+n.localize("weight_unit_metric")},plotOptions:{gauge:{dataLabels:{formatter:function(){return this.y.toFixed(2)}}}}},r=this;return this.chartFormat==="widget"&&(e.chart.events={click:function(e){e.preventDefault();var n="/report/"+r.report.metricId+"/"+r.reportType+"/current/"+r.ftpMaxToggle;t.history.navigate(n,{trigger:!0})}}),e},fetchWeight:function(t){this.userBiometricWeights=new f({dates:c.parseISO(t)});var n=new i;n.addModel({model:this.userBiometricWeights,required:!0}),n.on(i.Events.SYNCHRONIZED,function(){this.loaded=!0,this.userBiometricWeights=this.userBiometricWeights.toJSON(),e.each(this.userBiometricWeights,function(e){e.parsedDate=c.parseISO(e.requestDate)},this),this._render()},this),n.fetchModels()},render:function(){this.modelSynchronizer.addModel({model:u,required:!0}),this.modelSynchronizer.addModel({model:this.latestUserBiometrics,required:!0}),this.modelSynchronizer.addModel({model:this.userBiometricRanges,required:!0}),this.modelSynchronizer.on(i.Events.SYNCHRONIZED,function(){this.ftp=this.latestUserBiometrics.get(s.BiometricConstants.FTP),this.categories=this.userBiometricRanges.filterByGender(u.get("gender")==="MALE"?"Male":"Female"),this.ftp&&this.ftp.bioDate?this.fetchWeight(this.ftp.bioDate):this.trigger(d.NO_DATA_AVAILABLE)},this),this.modelSynchronizer.fetchModels()},_render:function(){if(this.categories===null||this.categories.length===0)return;this.weight=null;if(this.ftp&&this.ftp.value!=null){this.currentMax=this.ftp.value;var t=c.parseISO(this.ftp.bioDate),i=e.find(this.userBiometricWeights,function(e){var n=e.parsedDate;return n.getFullYear()===t.getFullYear()&&n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()},this);i&&i.weight&&(this.weight=r.convertWeightGramsToKg(i.weight))}this.$el.parent().find(".additionalPlaceHolder").children().length>0&&this.$el.parent().find(".additionalPlaceHolder").first().remove();if(this.ftpMaxToggle==="ftp-watts"||!this.weight){this.$el.hide();var s=this.template({ftpValue:this.ftp.value===null?"--":Math.round(this.ftp.value)+" "+n.localize("max_avg_power_unit"),Localizer:n});this.$el.parent().find(".additionalPlaceHolder").length==0&&this.$el.parent().append('<span class="additionalPlaceHolder"></span>'),this.$el.parent().find(".additionalPlaceHolder").html(s)}else this.$el.show(),this.currentMax!=null&&(this.currentMax=this.currentMax/Math.max(this.weight,1)),this.gaugeChartView=new h({chartOptions:this.getChartOptions(),currentMax:this.currentMax,categories:this.categories,useStrictMinMax:!1,categoriesMapper:{Untrained:{color:"#c84b4b",type:"untrained",name:n.localize("ftp.untrained")},Fair:{color:"#e69637",type:"fair",name:n.localize("ftp.fair")},Good:{color:"#64af5a",type:"good",name:n.localize("ftp.good")},Excellent:{color:"#328cb4",type:"excellent",name:n.localize("ftp.excellent")},Superior:{color:"#735596",type:"superior",name:n.localize("ftp.superior")}},categoryMetadata:{categoryKey:"category",categoryMin:"Untrained",categoryMax:"Superior",categoryRangeMin:"minValue",categoryRangeMax:"maxValue"},containerClass:this.chartFormat=="widget"?"reportChartPlaceholder":"js-report-chart-current",categoryExportCallback:function(e,t){return[n.localize("ftp."+e),t.get("minValue")<=0?"":t.get("minValue"),t.get("maxValue")<=0?"":t.get("maxValue")]}}),this.gaugeChartView.setExportDataTitle(n.localize(l.ACTIVITY_MAX_FTP)),this.gaugeChartView.addExportData(n.localize("ftp.my.title"),this.currentMax!=null?this.currentMax.toFixed(2):""),this.gaugeChartView.addExportData(n.localize("ftp.max.category.label"),n.localize("ftp.max.range.min.label"),n.localize("ftp.max.range.max.label")),this.gaugeChartView.addSeriesData({name:n.localize("ftp.my.title"),data:[this.currentMax]}),this.$el.parent().html(this.gaugeChartView.render().el)},getExportData:function(){return this.gaugeChartView?this.gaugeChartView.getExportData():{title:n.localize(l.ACTIVITY_MAX_FTP),rows:[{values:[n.localize("ftp.my.title")+": "+this.ftp.value.toFixed(2)+" "+n.localize("max_avg_power_unit")]}]}},isMetric:function(){return o.getMeasurementSystem()===r.MeasurementSystems.METRIC},displayWeightPrompt:function(e){var t=!1,n=null;return this.loaded&&this.weight===null&&e==="ftp-watts-kg"&&(t=!0,n=this.formatFtpDate(this.ftp.bioDate)),{displayWeightPrompt:t,weightDate:n}},formatFtpDate:function(e){return e.indexOf("T")>-1&&(e=e.substring(0,e.indexOf("T"))),e},log:function(e){typeof console!="undefined"&&typeof console.log!="undefined"&&console.log((new Date).toString()+" - "+e)}});return v.Events=d,v}),define("text!templates/report/FTPLegendView.html",[],function(){return'<table class="table table-bordered vo2-estimates-table">\n    <thead>\n    <tr>\n        <th></th>\n        <th><%= Localizer.localize(\'vo2.males\') %> (<%= Localizer.localize(\'max_avg_power_unit\') %>/<%= weightUnit %>)</th>\n        <th><%= Localizer.localize(\'vo2.females\') %> (<%= Localizer.localize(\'max_avg_power_unit\') %>/<%= weightUnit %>)</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr>\n        <th><span class="vo2-superior"></span><%= Localizer.localize(\'vo2.superior\') %></th>\n        <% var maleRange = getRangeByCategory("Superior", "Male"); %>\n        <% var femaleRange = getRangeByCategory("Superior", "Female"); %>\n        <td><%= Localizer.localize(\'ftp.greater\', Personalizer.formatDistance(maleRange.min)) %></td>\n        <td><%= Localizer.localize(\'ftp.greater\', Personalizer.formatDistance(femaleRange.min)) %></td>\n    </tr>\n\n    <tr>\n        <th><span class="vo2-excellent"></span><%= Localizer.localize(\'vo2.excellent\') %></th>\n        <% var maleRange = getRangeByCategory("Excellent", "Male"); %>\n        <% var femaleRange = getRangeByCategory("Excellent", "Female"); %>\n        <td><%= Localizer.localize(\'ftp.from\', Personalizer.formatDistance(maleRange.min), Personalizer.formatDistance(maleRange.max)) %></td>\n        <td><%= Localizer.localize(\'ftp.from\', Personalizer.formatDistance(femaleRange.min), Personalizer.formatDistance(femaleRange.max)) %></td>\n    </tr>\n\n    <tr>\n        <th><span class="vo2-good"></span><%= Localizer.localize(\'vo2.good\') %></th>\n        <% var maleRange = getRangeByCategory("Good", "Male"); %>\n        <% var femaleRange = getRangeByCategory("Good", "Female"); %>\n        <td><%= Localizer.localize(\'ftp.from\', Personalizer.formatDistance(maleRange.min), Personalizer.formatDistance(maleRange.max)) %></td>\n        <td><%= Localizer.localize(\'ftp.from\', Personalizer.formatDistance(femaleRange.min), Personalizer.formatDistance(femaleRange.max)) %></td>\n    </tr>\n\n    <tr>\n        <th><span class="vo2-fair"></span><%= Localizer.localize(\'vo2.fair\') %></th>\n        <% var maleRange = getRangeByCategory("Fair", "Male"); %>\n        <% var femaleRange = getRangeByCategory("Fair", "Female"); %>\n        <td><%= Localizer.localize(\'ftp.from\', Personalizer.formatDistance(maleRange.min), Personalizer.formatDistance(maleRange.max)) %></td>\n        <td><%= Localizer.localize(\'ftp.from\', Personalizer.formatDistance(femaleRange.min), Personalizer.formatDistance(femaleRange.max)) %></td>\n    </tr>\n\n    <tr>\n        <th><span class="vo2-poor"></span><%= Localizer.localize(\'ftp.untrained\') %></th>\n        <% var maleRange = getRangeByCategory("Untrained", "Male"); %>\n        <% var femaleRange = getRangeByCategory("Untrained", "Female"); %>\n        <td><%= Localizer.localize(\'ftp.less\', Personalizer.formatDistance(maleRange.max)) %></td>\n        <td><%= Localizer.localize(\'ftp.less\', Personalizer.formatDistance(femaleRange.max)) %></td>\n    </tr>\n\n    </tbody>\n</table>'}),define("views/report/FTPLegendView",["underscore","backbone","localizer","personalizer","utils/ModelSynchronizer","models/user/ViewerUserPreferences","collections/user/UserBiometricRanges","text!templates/report/FTPLegendView.html"],function(e,t,n,r,i,s,o,u){var a={LOADED:"LOADED"},f=t.View.extend({initialize:function(t){this.chartFormat=t.chartFormat,this.template=e.template(u),this.modelSynchronizer=new i,this.userBiometricRanges=new o({range:o.BiometricRangeConstants.FTP_POWER})},render:function(){this.modelSynchronizer.addModel({model:this.userBiometricRanges,required:!0}),this.modelSynchronizer.on(i.Events.SYNCHRONIZED,function(){this.categories=this.userBiometricRanges.toJSON(),this._render()},this),this.modelSynchronizer.fetchModels()},_render:function(){var t=this,i=this.template({Localizer:n,weightUnit:n.localize("weight_unit_metric"),Personalizer:r,getRangeByCategory:function(n,r){var i=e.find(t.categories,function(e){return e.category==n&&e.gender==r});return i?{min:i.minValue,max:i.maxValue}:{min:"",max:""}}});jQuery(this.el).html(i),this.chartFormat=="page"&&this.$(".table-bordered").closest(".span8").toggleClass("span8 span10"),this.trigger(a.LOADED)}});return f.Events=a,f}),define("text!templates/report/FTPMaxInfo.html",[],function(){return'<!--FTP Estimates Table-->\n<% if (report.metricName == \'ACTIVITY_MAX_FTP\' && chartFormat == \'widget\'){ %>\n    <span class="help-icon">\n        <a data-toggle="modal" class="colored" data-target="#functional-threshold-power">\n            <i class="icon-help"></i>\n        </a>\n    </span>\n<% }                                             %>\n\n'}),define("views/report/FTPMaxInfoView",["underscore","backbone","localizer","views/main/Modal/ModalPopupView","views/report/FTPLegendView","text!templates/report/FTPMaxInfo.html"],function(e,t,n,r,i,s){var o=t.View.extend({events:{"click .help-icon":"onHelpClicked"},initialize:function(t){this.template=e.template(s),this.report=t.report,this.chartFormat=t.chartFormat},render:function(){var e=this.template({Localizer:n,report:this.report.toJSON(),chartFormat:this.chartFormat});jQuery(this.el).html(e)},onHelpClicked:function(e){e.preventDefault();var t=new i({chartFormat:"widget"}),s=new r({modalTitle:n.localize("ACTIVITY_MAX_FTP"),view:t,showFooter:!1});t.once(i.Events.LOADED,function(){s.render()},this),t.render()}});return o}),define("text!widgets/report/templates/emptyReportChart.html",[],function(){return"<div class=\"h4 top-xl text-center <%= hidden ? 'hidden' : '' %>\"><%~ Localizer.localize('report.empty.msg') %></div>\n\n<div class=\"<%=  hidden ? '' : 'hidden' %>\">\n	<div class=\"center-y-parent empty-state\">\n        <div class=\"center-y-child <%= isWidget ? 'hidden' : '' %>\">\n            <h4><%~ Localizer.localize('stress_report_text3') %></h4>\n            <p><%~ Localizer.localize('stress_report_text7') %></p>\n        </div>\n\n        <div class=\"text-center top-m <%= isWidget ? '' : 'hidden' %>\">\n            <h6><%~ Localizer.localize('stress_report_text3') %></h6>\n            <p><%~ Localizer.localize('stress_report_text7') %></p>\n        </div>\n    </div>\n</div>\n"}),define("views/report/ReportEmptyChartView",["underscore","backbone","localizer","personalizer","text!widgets/report/templates/emptyReportChart.html"],function(e,t,n,r,i){var s=t.View.extend({initialize:function(t){this.template=e.template(i),this.hidden=t.hidden,this.isWidget=t.isWidget},render:function(){this.$el.html(this.template({Localizer:n,hidden:this.hidden,isWidget:this.isWidget}))}});return s}),define("views/report/FTPTrendChartView",["underscore","localizer","personalizer","views/report/ChartView","models/user/ViewerUserBiometrics","collections/user/UserBiometricWeights","utils/ModelSynchronizer","utils/date/DateParser","views/report/ReportEmptyChartView","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s,o,u,a){return r.extend({createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",t.localize("ACTIVITY_MAX_FTP")]}},determineYAxisTitle:function(){return t.localize("max_avg_power_unit")+(this.ftpMaxToggle=="ftp-watts-kg"?"/"+t.localize("weight_unit_metric"):"")},initializeChartSeries:function(){this.chartSeries=[]},customizeOptions:function(){this.options.plotOptions={series:{showCheckbox:!1,selected:!0}},this.options.yAxis.title.text=this.determineYAxisTitle();var e=this;this.options.tooltip={formatter:function(){var n=e.ftpMaxToggle=="ftp-watts-kg"?this.y.toFixed(2):Math.round(this.y);return"<b>"+this.x+"</b><br/>"+this.series.name+": "+n+" "+t.localize("max_avg_power_unit")+(e.ftpMaxToggle=="ftp-watts-kg"?"/"+t.localize("weight_unit_metric"):"")}};if(this.chartFormat=="widget"){var e=this;this.options.chart.events={click:function(t){t.preventDefault();var n="/report/"+e.report.metricId+"/"+e.reportType+"/"+e.activeTab;e.ftpMaxToggle=="ftp-watts-kg"&&(n+="/ftp-watts-kg"),Backbone.history.navigate(n,{trigger:!0})}}}this.options.legend.enabled=!1},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.ftp={name:t.localize("widget_title_ACTIVITY_MAX_FTP"),type:"line",color:"#80ea40",data:this.createNullArray()}},log:function(e){typeof console!="undefined"&&typeof console.log!="undefined"&&console.log((new Date).toString()+" - "+e)},addMetricToDataset:function(r){var i=this.determineDataIndex(r);if(i>=0&&r.value!=null){var s="";e.isUndefined(r.startDateOfWeek)?e.isUndefined(r.calendarDate)?s=[r.month.year+"-"+r.month.monthId+"-1"]:s=r.calendarDate.split(" "):s=r.startDateOfWeek.split(" ");var o=s[0].split("-"),u=new Date(o[0],o[1]-1,o[2],0,0,0),a=null,f=null;this.ftpMaxToggle=="ftp-watts"?(a=r.value,f=t.localize("max_avg_power_unit")):(a=this.convertToWattsPerKg(r.lookupDate,r.value),f=t.localize("max_avg_power_unit")+"/"+t.localize("weight_unit_metric")),this.ftpMaxToggle=="ftp-watts-kg"&&a==r.value?(this.log("Can't find a weight for ftp-watts-kg lookupDate: "+r.lookupDate+", metric.value: "+r.value),a=null):this.exportData.rows[this.exportDataCount++]={values:[n.personalizeMonth(u,t),a.toFixed(2)+" "+f]},this.chartSeries.ftp.data[i]=a}},render:function(){var t=this.getDateRanges();this.weights=new s({dates:t}),this.modelSynchronizer.addModel({model:i,required:!0}),this.modelSynchronizer.addModel({model:this.weights,required:!0}),this.modelSynchronizer.on(o.Events.SYNCHRONIZED,function(){this.weights=this.weights.toJSON(),e.each(this.weights,function(e){e.parsedDate=u.parseISO(e.requestDate)},this),r.prototype.render.call(this),this.checkForSeriesData()},this),this.modelSynchronizer.fetchModels()},getDateRanges:function(){var t=[];return this.metricList.each(function(n){var r=n.get("metricsMap").ACTIVITY_MAX_FTP;e.each(r,function(n){if(n.value>0){var r="";e.isUndefined(n.startDateOfWeek)?e.isUndefined(n.calendarDate)?r=[n.month.year+"-"+n.month.monthId+"-1"]:r=n.calendarDate.split(" "):r=n.startDateOfWeek.split(" ");var i=r[0].split("-"),s=new Date(i[0],i[1]-1,i[2],0,0,0),o=new Date(s.getFullYear(),s.getMonth()+1,0);n.lookupDate=o,t.push(o)}})}),t},initializeChart:function(e){this.ftpMaxToggle=e.ftpMaxToggle,this.modelSynchronizer=new o,this.emptyChartView=null},getWeight:function(t){var r=0;if(this.metricPeriod=="monthly"||this.metricPeriod=="yearly"){var i=new Date(t.getFullYear(),t.getMonth()+1,0);t=i}var s=t,o=e.find(this.weights,function(e){var t=e.parsedDate;return t!=null&&t.getFullYear()==s.getFullYear()&&t.getDate()==s.getDate()&&t.getMonth()==s.getMonth()},this);return o&&(r=n.convertWeightGramsToKg(o.weight)),r},convertToWattsPerKg:function(e,t){var n=this.getWeight(e);return n>0?t/n:t},toggle:function(e){this.ftpMaxToggle=e,r.prototype.initExportData.call(this),r.prototype.render.call(this),this.checkForSeriesData()},checkForSeriesData:function(){if(this.ftpMaxToggle=="ftp-watts-kg"){var t=e.find(this.chartSeries.ftp.data,function(e){return e!=null},this);t||(this.$(".highcharts-container").hide(),this.emptyChartView=new a({el:this.el}),this.emptyChartView.render())}}})}),define("utils/settings/BiometricLimits",["require","personalizer"],function(e){var t=e("personalizer"),n=t.measurementSystem,r={minWeight:n==="metric"?1:2,maxWeight:n==="metric"?453:999,minHeight:n==="metric"?92:36,maxHeight:n==="metric"?254:100,minAge:16,maxAge:120,minVo2max:1,maxVo2max:100,minCyclingTrainingSpeed:0,maxCyclingTrainingSpeed:n==="metric"?160:100,minCyclingAvgPower:0,maxCyclingAvgPower:5e3,MAX_HEART_RATE_MIN:35,MAX_HEART_RATE_MAX:250,MAX_HEART_RATE_DEFAULT:185,MIN_RESTING_HEART_RATE:30,MIN_LACTATE_THRESHOLD_HEART_RATE:60,HR_ZONE_MAX:200,HR_ZONE_MIN:30};return r}),define("text!templates/report/FTPWeightView.html",[],function(){return'<div class="<%= maxView ? \'\' : \'text-center\' %>">\n    <div class="alert alert-error" style="display: none;"><%= Localizer.localize(\'ftp.weight.error\') %></div>\n    <% if (title) {  %>\n        <h6 class="font-thin top-m"><%= title %></h6>\n        <% if (prompt) { %>\n            <p class="font-thin top-s"><%= prompt %></p>\n        <% }             %>\n    <% } else if (prompt) { %>\n        <div class="bottom-m"><%= prompt %></div>\n    <% }        %>\n    <form action="" class="form-horizontal">\n        <div class="row-fluid">\n            <div class="control-group">\n                <label class="control-label weight-label" for="user-weight"><%= Localizer.localize(\'ftp.weight\') %></label>\n                <div class="<%= maxView ? \'controls controls-row\' : \'\' %>">\n                    <span class="input-append">\n                        <input type="text" id="user-weight" placeholder="" class="input-mini" maxlength="<%= maxLength %>" autofocus>\n                        <span class="add-on"><%= weightLabel %></span>\n                    </span>\n                    <% if (displaySaveButton) { %>\n                        <button class="btn btn-form"><%= Localizer.localize(\'save\') %></button>\n                    <% } %>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n'}),define("views/report/FTPWeightView",["underscore","backbone","localizer","personalizer","models/user/ViewerUserPreferences","models/weight/Weight","utils/validators/NumberValidator","utils/extensions/Loadable","utils/reporters/ToolTipErrorReporter","utils/settings/BiometricLimits","utils/parsers/NumberParser","text!templates/report/FTPWeightView.html"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={WEIGHT_SUCCESS:"WEIGHT_SUCCESS",WEIGHT_ERROR:"WEIGHT_ERROR",WEIGHT_LOADED:"WEIGHT_LOADED"},p=t.View.extend(u),d=p.extend({template:e.template(c),events:{"click .btn-form":"onSaveButtonClicked"},propertyFiles:["/main/js/properties/units/units","/main/js/properties/common/common","/main/js/properties/reportswidget/reportswidget","/main/js/properties/userprofile/userprofile"],initialize:function(t){this.displaySaveButton=e.isUndefined(t.displaySaveButton)?!1:t.displaySaveButton,this.displayWeightLabel=e.isUndefined(t.displayWeightLabel)?!0:t.displayWeightLabel,this.maxView=e.isUndefined(t.maxView)?!0:t.maxView,this.prompt=t.prompt,this.title=t.title||null,this.weightDate=t.weightDate||null,this.parser=new l},render:function(){var e=5,t=n.localize("weight_unit_statute");this.isMetric()&&(t=n.localize("weight_unit_metric"));var i=this.template({Localizer:n,Personalizer:r,weightLabel:t,maxLength:e,displaySaveButton:this.displaySaveButton,maxView:this.maxView,prompt:this.prompt,title:this.title});this.$el.html(i),this.displayWeightLabel||this.$(".weight-label").hide(),this.setupWeightValidator(),this.trigger(h.WEIGHT_LOADED)},destroy:function(){this.$(".tooltip-error").remove()},setupWeightValidator:function(){var e=this,t=new a({message:n.localize("invalid_weight_message_short"),element:this.$("input#user-weight"),container:this.$el});this.weightValidator=new o({element:this.$("input#user-weight"),minValue:f.minWeight,maxValue:f.maxWeight,required:!0,reporter:t,parser:{parse:function(t){if(i.getNumberFormat()==="decimal_comma"&&t.includes("."))throw"invalid number";if(i.getNumberFormat()==="decimal_period"&&t.includes(","))throw"invalid number";return e.parser.parse(t)}}})},isMetric:function(){return i.getMeasurementSystem()===r.MeasurementSystems.METRIC},onSaveButtonClicked:function(t){t&&t.preventDefault();if(this.weightValidator.validateInputNow())return!1;var n=this.$("#user-weight").val();if(jQuery.trim(n).length>0){var r=e.isNull(this.weightDate)?jQuery.datepicker.formatDate("yy-mm-dd",new Date):this.weightDate,i="lbs";this.isMetric()&&(i="kg");var o=new s({value:n,unitKey:i,date:r}),u=this;return o.save(o.attributes,{success:function(e,t,n){u.$(".alert-error").hide(),u.trigger(h.WEIGHT_SUCCESS,e.get("value"))},error:function(e,t,n){u.$(".alert-error").show(),u.trigger(h.WEIGHT_ERROR,{model:e,response:t,options:n})}}),!0}return!1}});return d.Events=h,d}),define("views/report/HeartRateTrendChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i){return i.extend({createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("heart_rate_unit")]}},determineYAxisTitle:function(){return n.localize("label_heart_rate_unit")},customizeOptions:function(){this.options.plotOptions={series:{showCheckbox:!1,selected:!0,states:{hover:{enabled:!0,halo:null}}}},this.options.yAxis.title={text:this.determineYAxisTitle()},this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+" "+n.localize("heart_rate_unit")}},this.minAvgValue&&(this.options.yAxis.plotLines=[{value:this.minAvgValue,color:"black",dashStyle:"solid",width:2,label:{text:n.localize("average")+" = "+this.minAvgValue+" "+n.localize("heart_rate_unit")},zIndex:5}])},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.resting={color:"#11a9ed",name:n.localize("label_resting_heart_rate"),type:"line",data:this.createNullArray(this.metricPeriod)}},processMetricList:function(e){var t=e.get("metricsMap"),n=0,r=0;this.hrReportType="resting";var i=t.WELLNESS_RESTING_HEART_RATE;if(i)for(var s=0;s<i.length;s++)i[s].value&&(this.addMetricToDataset(i[s]),n+=i[s].value,r++);r>0&&(this.minAvgValue=Math.round(n/r))},addMetricToDataset:function(e){var t=this.determineDataIndex(e);t>=0&&e.value!=null&&this.chartSeries[this.hrReportType]&&(this.chartSeries[this.hrReportType].data[t]=e.value,this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],e.value]})}})}),define("utils/HRVStressReportUtils",[],function(){return{SCORE_VERY_HIGH_TOP:100,SCORE_VERY_HIGH_BOTTOM:90,SCORE_HIGH_TOP:89,SCORE_HIGH_BOTTOM:70,SCORE_MODERATE_TOP:69,SCORE_MODERATE_BOTTOM:35,SCORE_LOW_TOP:34,SCORE_LOW_BOTTOM:1}}),define("views/charts/TEBarChartView",["require","underscore","backbone","highcharts"],function(e){var t=e("underscore"),n=e("backbone"),r=e("highcharts"),i=n.View.extend({defaultOptions:{chart:{type:this.chartType,padding:0,width:700,height:150,style:{fontFamily:"'Open Sans', sans-serif"},backgroundColor:""},title:{text:""},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{column:{animation:!1}},exporting:{enabled:!1},xAxis:{labels:{rotation:0,style:{textOverflow:"none"}},tickInterval:this.metricPeriod?"":7,categories:this.categories,labels:{enabled:!1}},yAxis:{allowDecimals:!1,alternateGridColor:"rgba(230,230,230,.125)",gridLineColor:"#dadada",tickInterval:1,ceiling:5,min:0,max:5},plotOptions:{series:{borderWidth:0}}},initialize:function(e){e.options?this.options=t.extend({},this.defaultOptions,e.options):this.options=t.extend({},this.defaultOptions)},render:function(){return this.chartObj=new Highcharts.Chart(this.el,this.options),this}});return i}),define("text!templates/report/TrainingEffectFooterView.html",[],function(){return"<div class=\"top-xl\">\n\n    <% if (showAnaerobicTEFooter) {      %>\n\n    <p>\n        <strong> <%= Localizer.localize('ANAEROBIC_TRAINING_EFFECT') %> </strong> <%= Localizer.localize('ANAEROBIC_TE_DESCRIPTION') %>\n\n    </p>\n\n    <% } %>\n\n    <p>\n        <strong> <%= Localizer.localize('AEROBIC_TRAINING_EFFECT') %> </strong> <%= Localizer.localize('AEROBIC_TE_DESCRIPTION') %>\n\n    </p>\n\n\n    <div class=\"fine-print\">\n\n        <%= Localizer.localize('TRAINING_EFFECT_REPORT_FOOTER') %>\n\n    </div>\n\n\n\n\n</div>"}),define("views/report/TrainingEffectFooterView",["require","underscore","backbone","personalizer","localizer","text!templates/report/TrainingEffectFooterView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("personalizer"),i=e("localizer"),s=e("text!templates/report/TrainingEffectFooterView.html"),o=n.View.extend({initialize:function(e){this.showAnaerobicFooter=e.showAnaerobicTEFooter,this.template=t.template(s)},render:function(){this.$el.html(this.template({Localizer:i,showAnaerobicTEFooter:this.showAnaerobicFooter}))}});return o}),define("text!templates/report/HRVStressReport.html",[],function(){return'<div id="week" class="tab-pane hrv-stress-table">\n    <div id="hrv-7d-container">\n        <div id="hrv-7d"></div>\n    </div>\n</div>'}),define("views/report/HRVStressReportView",["require","backbone","personalizer","localizer","utils/ReportChartUtil","utils/HRVStressReportUtils","pages/activity_details_2/views/charts/ChartColorMapper","views/charts/TEBarChartView","views/report/TrainingEffectFooterView","text!templates/report/HRVStressReport.html"],function(e){var t=e("backbone"),n=e("personalizer"),r=e("localizer"),i=e("utils/ReportChartUtil"),s=e("utils/HRVStressReportUtils"),o=e("pages/activity_details_2/views/charts/ChartColorMapper"),u=e("views/charts/TEBarChartView"),a=e("views/report/TrainingEffectFooterView"),f=e("text!templates/report/HRVStressReport.html"),l=t.View.extend({initialize:function(e){this.reportType=e.reportType,this.chartFormat=e.chartFormat,this.metricList=e.metricList,this.displayName=e.displayName,this.chartType=e.chartType,this.metricPeriod=e.hrvStressReportMetricPeriod,this.currentDateOffset=e.currentDateOffset,this.userPreferences=e.userPreferences,this.daysInMonth=e.daysInMonth,this.template=_.template(f),this.chartOptions={}},render:function(){this.$el.html(this.template({Localizer:r})),this.getXAxisCategories(),this.getTooltips();var e=this.metricList.at(0),t=e.get("metricsMap"),n=t.ACTIVITY_HRV_STRESS_TEST;this.getChartOptions(),this.processMetricList(n),this.renderChart()},createZeroArray:function(){var e=[],t;if(this.metricPeriod)for(t=-7;t<0;t++)e.push(0);else for(t=-this.daysInMonth;t<0;t++)e.push(0);return e},processMetricList:function(e){var t,n,r,i;for(r=0,i=e.length;r<i;r++)t=this.addMetricToDataset(e[r]),t>=0&&this.chartOptions.series&&(this.chartOptions.series[0].data[t]!==0?(n=this.chartOptions.series[0].data[t],n<=e[r].value?this.chartOptions.series[0].data[t]=e[r].value:this.chartOptions.series[0].data[t]=n):this.chartOptions.series[0].data[t]=e[r].value)},addMetricToDataset:function(e){return this.metricPeriod?this.calculateDailyDataIndex(e.calendarDate,7):this.calculateWeeklyDataIndex(e.calendarDate)},calculateDailyDataIndex:function(e,t){var n=i.formatDate(this.currentDateOffset),r=i.determineNumberOfDays(e,n),s=t-r;return s<0||s>7?-1:s},calculateWeeklyDataIndex:function(e){var t=e.split("-"),n=new Date(t[0],t[1]-1,t[2],0,0,0),i=n.getMonth()+1,s=n.getDate(),o=this.userPreferences.get("dateFormat"),u="";o.formatKey==="mmddyyyy"||o.formatKey==="yyyymmdd"?u=r.localize("month.abbr."+(i>9?i:"0"+i))+" "+s:u=s+" "+r.localize("month.abbr."+(i>9?i:"0"+i));var a=this.categories.indexOf(u);return a<0?-1:a},getChartOptions:function(){var e=this,t=0;this.chartOptions={chart:{type:this.chartType,padding:0,width:this.chartFormat==="widget"?290:700,height:this.chartFormat==="widget"?210:200,spacingLeft:10,style:{fontFamily:"'Open Sans', sans-serif"},backgroundColor:""},title:{text:""},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{column:{animation:!1}},exporting:{enabled:!1},xAxis:{labels:{rotation:0,style:{textOverflow:"none"}},tickInterval:this.metricPeriod?"":7,categories:this.categories,labels:{enabled:!0}},yAxis:{title:{text:""},allowDecimals:!1,alternateGridColor:"rgba(230,230,230,.125)",gridLineColor:"#dadada",tickPositions:[0,20,40,60,80,100]},tooltip:{useHTML:!0,formatter:function(){return"<strong>"+e.tooltips[this.point.index]+"</strong></br>"+r.localize("trainingEffect.help.score")+": <strong>"+n.formatDecimalNumber(this.y,0)+" "+e.getLowMediumHigh(this.y)+" </strong><br>"}},plotOptions:{series:{borderWidth:0}},series:[{name:"",data:this.buildSeriesData(),color:o.Colors.blue}]}},getLowMediumHigh:function(e){return e>s.SCORE_LOW_BOTTOM&&e<=s.SCORE_LOW_TOP?"("+r.localize("wellness_sleep_movement_low")+")":e>s.SCORE_MODERATE_BOTTOM&&e<=s.SCORE_MODERATE_TOP?"("+r.localize("moderate")+")":e>s.SCORE_HIGH_BOTTOM&&e<=s.SCORE_HIGH_TOP?"("+r.localize("wellness_sleep_movement_high")+")":e>s.SCORE_VERY_HIGH_BOTTOM&&e<=s.SCORE_VERY_HIGH_TOP?"("+r.localize("very_high")+")":""},renderChart:function(){var e=new u({options:this.chartOptions,el:this.$("#hrv-7d")});this.$("#hrv-7d-container").html(e.render().el)},buildSeriesData:function(){var e=[];return e=this.createZeroArray(this.metricPeriod),e},getXAxisCategories:function(){this.metricPeriod?this.getDailyCategories():this.getOneMonthCategories()},getDailyCategories:function(){this.categories=[];for(var e=-6;e<=0;e++){var t=new Date;t.setHours(12),t.setMinutes(0),t.setMilliseconds(0),t.setDate(t.getDate()+this.currentDateOffset),t.setDate(t.getDate()+e);var n="",i=t.getDay().toString();n=r.localize("day."+i+".short"),this.categories.push(n)}},getTooltips:function(){var e=this.metricPeriod?-6:-this.daysInMonth;this.tooltips=[];for(var t=e;t<=0;t++){var n=new Date;n.setHours(12),n.setMinutes(0),n.setMilliseconds(0),n.setDate(n.getDate()+this.currentDateOffset),n.setDate(n.getDate()+t);var i="",s=n.getDay().toString(),o=n.getDate().toString(),u=n.getMonth()+1,a=n.getFullYear();i=r.localize("day."+s+".short")+", "+r.localize("month.abbr."+(u>9?u:"0"+u))+" "+o+", "+a,this.tooltips.push(i)}},getOneMonthCategories:function(){this.categories=[];for(var e=-this.daysInMonth;e<0;e++){var t=new Date;t.setHours(12),t.setMinutes(0),t.setMilliseconds(0),t.setDate(t.getDate()+this.currentDateOffset),t.setDate(t.getDate()+e);var n=t.getDate().toString(),i=(t.getMonth()+1).toString(),s=this.userPreferences.get("dateFormat"),o="";s.formatKey==="mmddyyyy"||s.formatKey==="yyyymmdd"?o=r.localize("month.abbr."+(i>9?i:"0"+i))+" "+n:o=n+" "+r.localize("month.abbr."+(i>9?i:"0"+i)),this.categories.push(o)}}});return l}),define("text!templates/report/HRVStressReportInfo.html",[],function(){return'<!--HRV Info Table-->\n<a href="#modal-hrv-stress" data-toggle="modal" class="help-icon modal-hrv-stress" title="<%= Localizer.localize(\'learn_more_about_hrv_stress\') %>">\n    <span class="icon-help"></span>\n</a>'}),define("views/report/HRVStressReportInfoView",["require","underscore","backbone","localizer","text!templates/report/HRVStressReportInfo.html","jquerymenus"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("text!templates/report/HRVStressReportInfo.html");e("jquerymenus");var s=n.View.extend({initialize:function(e){this.template=t.template(i)},render:function(){var e=this.template({Localizer:r});this.$el.html(e),this.$(".popbox").garminMenus()}});return s}),define("text!templates/report/HRVInfoPopUpView.html",[],function(){return"<p><%= Localizer.localize('stress_report_text5') %></p>\n<p><%= Localizer.localize('stress_report_text6') %></p>\n<table class=\"table\">\n<tbody>\n	<tr>\n		<td><%= Localizer.localize('low') %></td>\n        <td><%= HRV_SCORE.SCORE_LOW_BOTTOM %> &#45; <%= HRV_SCORE.SCORE_LOW_TOP %></td>\n    </tr>\n    <tr>\n    	<td><%= Localizer.localize('moderate') %></td>\n    	<td><%= HRV_SCORE.SCORE_MODERATE_BOTTOM %> &#45; <%= HRV_SCORE.SCORE_MODERATE_TOP %></td>\n    </tr>\n    <tr>\n    	<td><%= Localizer.localize('high') %></td>\n        <td><%= HRV_SCORE.SCORE_HIGH_BOTTOM %> &#45; <%= HRV_SCORE.SCORE_HIGH_TOP %></td>\n    </tr>\n    <tr>\n    	<td><%= Localizer.localize('very_high') %> </td>\n        <td><%= HRV_SCORE.SCORE_VERY_HIGH_BOTTOM %> &#45; <%= HRV_SCORE.SCORE_VERY_HIGH_TOP %></td>\n    </tr>\n</tbody>\n</table>\n<div class=\"fine-print top-s\"><%= Localizer.localize('stress_report_text2') %></div>"}),define("views/report/HRVInfoPopUpView",["require","underscore","backbone","localizer","utils/HRVStressReportUtils","text!templates/report/HRVInfoPopUpView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/HRVStressReportUtils"),s=e("text!templates/report/HRVInfoPopUpView.html"),o=n.View.extend({initialize:function(e){this.template=t.template(s)},render:function(){var e=this.template({Localizer:r,HRV_SCORE:i});this.$el.html(e)}});return o}),define("views/report/IntensityMinutesChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","moment","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s){return i.extend({determineYAxisTitle:function(){return n.localize("label_intensity_minutes_unit")},customizeOptions:function(){var e=this;this.options.plotOptions={column:{dataLabels:{enabled:!1,color:"white"}},series:{stacking:"normal",showCheckbox:!1,selected:!0}},this.options.tooltip={formatter:function(){var t=e.goalSeries.goal.data[this.point.x],i="<b>"+this.x+"</b><br/>"+this.series.name+": "+r.formatDecimalNumber(this.y,0)+" "+n.localize("label_intensity_minutes_unit");return e.metricPeriod!=="daily"&&(i+="<br/>"+n.localize("label_intensity_minutes_goal")+": "+r.formatDecimalNumber(t,0)+" "+n.localize("label_intensity_minutes_unit")),i}}},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.remaining={color:"#dddddd",name:n.localize("step.remaining"),data:this.createZeroArray(this.metricPeriod)},this.chartSeries.incomplete={color:"#11a9ed",name:n.localize("step.actual"),data:this.createZeroArray(this.metricPeriod)},this.chartSeries.complete={color:"#80ea40",name:n.localize("step.actual"),data:this.createZeroArray(this.metricPeriod)},this.goalSeries={},this.goalSeries.goal={name:n.localize("step.goal"),data:this.createZeroArray(this.metricPeriod)}},createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("step.actual"),n.localize("step.goal")]}},processMetricList:function(e){this.vigorousMultiplier=2;var t=0;this.metricsMap=e.get("metricsMap");var n=this.metricsMap.WELLNESS_MODERATE_INTENSITY_MINUTES||[],r=this.metricsMap.WELLNESS_VIGOROUS_INTENSITY_MINUTES||[],i=Math.max(n.length,r.length);for(var s=0;s<i;s++){var o=null;n[s]&&(o=n[s]),r[s]&&(o?o.value+=r[s].value*this.vigorousMultiplier:(o=r[s],o.value*=this.vigorousMultiplier)),o&&(t+=o.value),this.addMetricToDataset(o,t)}},addMetricToDataset:function(e,t){var n=this.determineDataIndex(e);if(n>=0){var r=this.getGoalValue(n);this.exportData.rows[this.exportDataCount++]={values:[this.categories[n],e.value||0,r||0]},this.metricPeriod!=="daily"&&e.value>=r||this.metricPeriod==="daily"&&t>=r?(this.metricPeriod!=="daily"&&(this.chartSeries.remaining.data[n]=0),this.chartSeries.complete.data[n]=e.value):(this.metricPeriod!=="daily"&&(this.chartSeries.remaining.data[n]=r-e.value),this.chartSeries.incomplete.data[n]=e.value),this.metricPeriod!=="daily"&&(this.goalSeries.goal.data[n]=r)}},getGoalValue:function(e){var t=0,n=this.metricsMap.WELLNESS_USER_INTENSITY_MINUTES_GOAL;for(var r=0;r<n.length;r++){var i=n[r],s=this.determineDataIndex(i);s==e&&(t=i.value)}return t},getWeeklyCategories:function(){this.categories=[];var e="1";for(var t=this.daysInMonth;t<=0;t++){var r=new Date;r.setHours(12),r.setMinutes(0),r.setMilliseconds(0),r.setDate(r.getDate()+this.currentDateOffset),r.setDate(r.getDate()+t);var i=r.getDay().toString();if(i===e){var s=r.getDate().toString(),o=(r.getMonth()+1).toString(),u=this.userPreferences.get("dateFormat"),a="";u.formatKey==="mmddyyyy"||u.formatKey==="yyyymmdd"?a=n.localize("month.abbr."+(o.length>1?o:"0"+o))+" "+s:a=s+" "+n.localize("month.abbr."+(o.length>1?o:"0"+o)),this.categories.push(a)}}},getDailyCategories:function(){this.categories=[];var e=new Date,t=1-e.getDay();t>0&&(t=-6);var r=t+6;for(var i=t;i<=r;i++){var o=s().add(i,"days"),u=o.isoWeekday();u>6&&(u-=7),category=n.localize("day."+u+".short"),this.categories.push(category)}}})}),define("text!templates/report/LactateThresholdInfoView.html",[],function(){return'<% if (chartFormat == \'page\') { %>\n<div class="span3 lt-page">\n    <div class="h6"><%= Localizer.localize(\'lactate.threshold.most.recent\') %></div>\n    <% if (exists(bpm)) {  %>\n    <div class="data-block xsmall">\n        <div class="data-bit"><%= bpm.value %> <%= Localizer.localize(\'heart_rate_unit\') %></div>\n        <div class="data-label"><%= Localizer.localize(\'label_heart_rate\') %></div>\n    </div>\n    <% } %>\n    <% if (exists(speed)) {  %>\n    <div class="data-block xsmall">\n        <div class="data-bit"><%=  Personalizer.personalizeLactateThresholdPace(toMeters(speed.value)) %></div>\n        <div class="data-label"><%= Localizer.localize(\'label_pace\') %> (<%= Localizer.localize(Personalizer.getPaceUnitKey()) %>)</div>\n    </div>\n    <% } %>\n</div>\n<div class="row-fluid lt-page">\n    <div class="span12 top-s"><%= Localizer.localize(\'adjust.hr.zones.label\') %></div>\n</div>\n<% } else if (activeTab == \'current\') { %>\n<% if (exists(bpm)) {  %>\n<div class="data-block xlarge text-center top-xs bottom-s">\n    <div class="data-bit"><%= bpm.value %> <%= Localizer.localize(\'heart_rate_unit\') %></div>\n    <span class="data-label"><%= Localizer.localize(\'label_heart_rate\') %></span>\n</div>\n<% } %>\n<% if (exists(speed)) {  %>\n<div class="data-block xlarge text-center bottom-s">\n    <div class="data-bit"><%=  Personalizer.personalizeLactateThresholdPace(toMeters(speed.value)) %></div>\n    <span class="data-label"><%= Localizer.localize(\'label_pace\') %> (<%= Localizer.localize(Personalizer.getPaceUnitKey()) %>)</span>\n</div>\n<% } %>\n<div class="text-center"><%= Localizer.localize(\'adjust.hr.zones.label\') %></div>\n<% } else { %>\n<div class="row-fluid">\n    <% if (exists(bpm)) {  %>\n    <div class="span6">\n        <div class="data-block small">\n            <div class="data-bit"><%= bpm.value %> <%= Localizer.localize(\'heart_rate_unit\') %></div>\n            <div class="data-label"><%= Localizer.localize(\'lactate.threshold.most.recent\') %></div>\n        </div>\n    </div>\n    <% } %>\n    <% if (exists(speed)) {  %>\n    <div class="span6">\n        <div class="data-block small pull-right text-right">\n            <div class="data-bit"><%=  Personalizer.personalizeLactateThresholdPace(toMeters(speed.value)) %></div>\n            <div class="data-label"><%= Localizer.localize(\'label_pace\') %> (<%= Localizer.localize(Personalizer.getPaceUnitKey()) %>)</div>\n        </div>\n    </div>\n    <% } %>\n</div>\n<% }  %>'}),define("views/report/LactateThresholdChartView",["underscore","backbone","localizer","personalizer","models/user/LatestUserBiometrics","utils/ModelSynchronizer","utils/ReportTypes","views/report/ChartView","views/report/ReportEmptyChartView","text!templates/report/LactateThresholdInfoView.html","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s,o,u,a,f){var l=u.extend({initializeChart:function(t){this.metricList.each(function(e){var t=e.get("metricsMap"),n=t[o.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM];this.bpmData=n?n:[],n=t[o.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC],this.speedData=n?n:[]},this),this.template=e.template(f),this.modelSynchronizer=new s,this.latestUserBiometrics=new i({displayName:t.userPreferences.get("displayName")}),this.emptyChartView=null,this.minBpm=0},customizeOptions:function(){this.options.xAxis={categories:this.categories},this.options.yAxis=[{title:{text:null},labels:{formatter:function(){return Math.round(this.value)}},min:this.minBpm-1},{title:{text:null},labels:{formatter:function(){var e=r.personalizeLactateThresholdPace(this.value);return e}},opposite:!0,reversed:!0,tickInterval:2}],this.options.legend={enabled:!0,verticalAlign:"bottom"},this.options.tooltip={shared:!0,formatter:function(){var e="";return this.points.length>1?(e=n.localize("label_heart_rate")+": "+Math.round(this.points[0].y)+" "+n.localize("heart_rate_unit")+"<br>",e=e+n.localize("label_pace")+": "+r.personalizeLactateThresholdPace(this.points[1].y)+" "+n.localize(r.getPaceUnitKey())):this.points[0].series.name.indexOf(n.localize("label_heart_rate"))>-1?e=n.localize("label_heart_rate")+": "+Math.round(this.points[0].y)+" "+n.localize("heart_rate_unit"):e=n.localize("label_pace")+": "+r.personalizeLactateThresholdPace(this.points[0].y)+" "+n.localize(r.getPaceUnitKey()),"<b>"+this.points[0].x+"</b><br>"+e}}},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.bpm={name:n.localize("label_heart_rate")+" ("+n.localize("heart_rate_unit")+")",type:"line",color:"#ff0035",data:this.createNullArray()},this.chartSeries.pace={type:"spline",color:"#11a9ed",yAxis:1,name:n.localize("label_pace")+" ("+n.localize(r.getPaceUnitKey())+")",data:this.createNullArray()};var t=this.getPaceData(),i=this.getHRData();e.each(i,function(e){var t=this.determineDataIndex(e.metric);t>=0&&(this.chartSeries.bpm.data[t]=e.y)},this),e.each(t,function(e){var t=this.determineDataIndex(e.metric);t>=0&&(this.chartSeries.pace.data[t]=e.y)},this)},addMetricToDataset:function(e){},getPaceData:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("value.label"),n.localize("label_pace")]};var t=[];return e.each(this.speedData,function(i){if(i.value>0){var s="";e.isUndefined(i.startDateOfWeek)?e.isUndefined(i.calendarDate)?s=[i.month.year+"-"+i.month.monthId+"-1"]:s=i.calendarDate.split(" "):s=i.startDateOfWeek.split(" ");var o=s[0].split("-"),u=new Date(o[0],o[1]-1,o[2],0,0,0),a=u.getFullYear(),f=u.getMonth(),l=u.getDate(),c=i.value,h={x:Date.UTC(a,f,l,12,0,0),y:c,metric:i},p=r.personalizeLactateThresholdPace(c)+" "+n.localize(r.getPaceUnitKey());this.exportData.rows[this.exportDataCount++]={values:[s.toString(),c,p]},t.push(h)}},this),t},getHRData:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("value.label"),n.localize("heart_rate_unit")]};var t=[];return e.each(this.bpmData,function(r){if(r.value>0){var i="";e.isUndefined(r.startDateOfWeek)?e.isUndefined(r.calendarDate)?i=[r.month.year+"-"+r.month.monthId+"-1"]:i=r.calendarDate.split(" "):i=r.startDateOfWeek.split(" ");var s=i[0].split("-"),o=new Date(s[0],s[1]-1,s[2],0,0,0),u=o.getFullYear(),a=o.getMonth(),f=o.getDate(),l={x:Date.UTC(u,a,f,12,0,0),y:r.value,metric:r};this.minBpm===0&&(this.minBpm=r.value),this.minBpm=Math.min(this.minBpm,r.value),t.push(l);var c=Math.round(r.value)+" "+n.localize("heart_rate_unit");this.exportData.rows[this.exportDataCount++]={values:[i.toString(),r.value,c]}}},this),t},determineYAxisTitle:function(){return""},render:function(){this.modelSynchronizer.addModel({model:this.latestUserBiometrics,required:!0}),this.modelSynchronizer.on(s.Events.SYNCHRONIZED,function(){this.bpm=this.latestUserBiometrics.get(i.BiometricConstants.LACTATE_THRESHOLD_BPM),this.speed=this.latestUserBiometrics.get(i.BiometricConstants.LACTATE_THRESHOLD_SPEED),this._render()},this),this.modelSynchronizer.fetchModels()},exists:function(t){return e.isUndefined(t)===!1&&e.isNull(t)===!1},_render:function(){var e=!1;this.activeTab==="current"&&this.chartFormat==="widget"?(this.$el.find(".top-l").hide(),this.$el.find(".highcharts-container").hide().next().hide(),this.exists(this.bpm)===!1&&this.exists(this.speed)===!1&&(this.emptyChartView=new a({el:this.el}))):(e=!jQuery(".chart-container .chart").hasClass("span9"),jQuery(".chart-container .chart").removeClass("span9"),u.prototype.render.call(this));if(this.emptyChartView)this.emptyChartView.render();else{var t=this.template({Localizer:n,Personalizer:r,bpm:this.bpm,speed:this.speed,chartFormat:this.chartFormat,activeTab:this.activeTab,url:"/modern/report/"+this.report.metricId+"/running/last_four_weeks",exists:this.exists,toMeters:function(e){return e*10}});this.chartFormat==="page"?(jQuery(".chart-container .chart").addClass("span9"),e&&jQuery(".chart-container").append(t)):this.activeTab==="current"&&this.chartFormat==="widget"?this.$el.html(t):this.$el.append(t)}this.chartObj&&this.chartObj.reflow()},getWeeklyCategories:function(){u.prototype.getWeeklyCategories.call(this),this.categories.length>4&&(this.categories=this.categories.splice(1))}});return l}),define("views/report/PowerChartView",["underscore","backbone","localizer","personalizer","utils/ActivityTypeMapper","views/report/ChartView","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s){return s.extend({determineYAxisTitle:function(){return""},createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("ACTIVITY_TRAINING_STRESS_SCORE"),n.localize("label_power")]}},customizeOptions:function(){this.options.yAxis=[{labels:{format:"{value}",style:{color:"#11a9ed"}},title:{text:n.localize("label_training_stress_score"),style:{color:"#11a9ed"}}},{title:{text:n.localize("label_intensity_factor"),style:{color:"#ff0035"}},labels:{format:"{value}",style:{color:"#ff0035"}},opposite:!0}],this.options.tooltip={shared:!0}},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.tss={color:"#11a9ed",name:n.localize("label_tss"),type:"column",data:this.createZeroArray(this.metricPeriod)},this.chartSeries["if"]={color:"#ff0035",name:n.localize("label_if"),type:"spline",yAxis:1,data:this.createZeroArray(this.metricPeriod)}},processMetricList:function(e){var t=e.get("metricsMap");this.powerType="tss";var n=t.ACTIVITY_TRAINING_STRESS_SCORE;if(n)for(var r=0;r<n.length;r++)this.addMetricToDataset(n[r]);this.powerType="if";var i=t.ACTIVITY_INTENSITY_FACTOR;if(i)for(var r=0;r<i.length;r++)this.addMetricToDataset(i[r])},addMetricToDataset:function(e){var t=this.determineDataIndex(e);t>=0&&this.chartSeries[this.powerType]&&(this.value=this.powerType=="tss"?Math.round(e.value):Math.round(e.value*1e3)/1e3,this.chartSeries[this.powerType].data[t]=this.value,this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],this.powerType,this.value]})}})}),define("views/report/RepCountingChartView",["require","underscore","backbone","localizer","personalizer","moment","utils/ActivityTypeMapper","utils/ReportTypes","utils/date/DateParser","views/report/ChartView","highcharts","highchartsmore","highchartsexport"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("personalizer"),s=e("moment"),o=e("utils/ActivityTypeMapper"),u=e("utils/ReportTypes"),a=e("utils/date/DateParser"),f=e("views/report/ChartView"),l=e("highcharts"),c=e("highchartsmore"),h=e("highchartsexport");return f.extend({initializeChart:function(e){this.exerciseFilter=""},determineYAxisTitle:function(){return r.localize("label_reps")},createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",r.localize("activity.type.label"),r.localize("value.label")]}},customizeOptions:function(){this.options.plotOptions={series:{showCheckbox:!1,selected:!0,states:{hover:{enabled:!0,halo:null}}}},this.options.tooltip={formatter:function(){var e=this.series.index===0?this.series.name:r.localize(i.getWeightUnitKey());return"<b>"+this.x+"</b><br/>"+this.y+" "+e}},this.options.legend.enabled=!0,this.options.yAxis=[{min:0,title:{text:"",style:{color:"#222"}},showEmpty:!1,labels:{enabled:!0},plotLines:[{value:0,width:1,color:"#808080"}],allowDecimals:!1,id:"reps",title:{text:r.localize("label_reps")}},{min:0,title:{text:"",style:{color:"#222"}},showEmpty:!1,labels:{enabled:!0},plotLines:[{value:0,width:1,color:"#808080"}],allowDecimals:!1,id:"volume",opposite:!0,title:{text:r.localize(i.getWeightUnitKey())}}]},processMetricList:function(e){var t=e.get("exerciseSummaries"),n=0,r=0,s=0;if(t){this.metricAvailable=t.length;for(var o=0;o<t.length;o++)if(!this.exerciseFilter||this.exerciseFilter===t[o].subCategory||this.exerciseFilter===t[o].category)n+=t[o].reps,s=i.convertWeight(t[o].volume*1e3),r+=s;this.addMetricToDataset({date:e.get("date"),reps:n,volume:r})}},createZeroArray:function(){switch(this.metricPeriod){case"weekly":return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];case"monthly":return[0,0,0,0,0,0];case"yearly":return[0,0,0,0,0,0,0,0,0,0,0,0];case"daily":default:return[0,0,0,0,0,0,0]}},getWeeklyCategories:function(){this.categories=[];var e=new Date,t=i.getShortDateFormatKey();e.setHours(12),e.setMinutes(0),e.setMilliseconds(0),e.setDate(e.getDate()+this.currentDateOffset-27),this.categories.push(s(e).format(t));for(var n=0;n<28;n++)e.setDate(e.getDate()+1),this.categories.push(s(e).format(t))},calculateWeeklyDataIndex:function(e){var t=s(e).format(i.getShortDateFormatKey()),n=this.categories.indexOf(t);return n},addMetricToDataset:function(e){var t=this.determineDataIndex(e);t>=0&&(this.chartSeries.reps||(this.chartSeries.reps={name:r.localize("label_reps"),data:this.createZeroArray(),index:0,yAxis:"reps"}),this.chartSeries.volume||(this.chartSeries.volume={name:r.localize("label_volume"),data:this.createZeroArray(),index:1,yAxis:"volume"}),this.chartSeries.reps.data[t]=e.reps,this.chartSeries.volume.data[t]=e.volume)},determineDataIndex:function(e){var t="",n="";switch(this.metricPeriod){case"monthly":dateObj=a.parseISO(e.date),t=this.calculateMonthlyDataIndex(dateObj.getMonth()+1);break;case"yearly":dateObj=a.parseISO(e.date),t=this.calculateYearlyDataIndex(dateObj.getMonth()+1);break;case"weekly":t=this.calculateWeeklyDataIndex(e.date);break;case"daily":default:t=this.calculateDailyDataIndex(e.date)}return t},calculateYearlyDataIndex:function(e){var t=r.localize("month.abbr."+(e>9?e:"0"+e)),n=this.categories.indexOf(t);return n<0||n>11?-1:n},setFilter:function(e){this.exerciseFilter=e}})}),define("text!templates/report/ReportActivityListRowView.html",[],function(){return'<td title="<%= Localizer.localize(\'manualActivity.name\') %>" class="activity-name">\n    <a href="<%= activityLink %>" class="colored"><%= activityName %></a>\n</td>\n<td title="<%= Localizer.localize(\'manualActivity.date\') %>">\n    <%= date %>\n</td>\n<td title="<%= Localizer.localize(\'label.time\') %>">\n    <%= duration %>\n</td>'}),define("views/report/ReportActivityListRowView",["require","underscore","backbone","localizer","utils/NavigationUtil","personalizer","utils/date/DateFormatter","utils/date/DateParser","text!templates/report/ReportActivityListRowView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/NavigationUtil"),s=e("personalizer"),o=e("utils/date/DateFormatter"),u=e("utils/date/DateParser"),a=e("text!templates/report/ReportActivityListRowView.html");return n.View.extend({template:t.template(a),tagName:"tr",className:"animated-fast fadeInDown",initialize:function(e){this.activity=e.activity},render:function(){this.$el.html(this.template({Localizer:r,activityName:this.activity.get("activityName")||r.localize("untitled"),activityLink:i.url("/activity/"+this.activity.get("activityId")),date:o.formatFriendlyDate(u.parseISO(this.activity.get("startTimeLocal")),!0),duration:s.personalizeDuration(this.activity.get("duration"))}))}})}),define("text!templates/report/ReportActivityListView.html",[],function(){return'<thead>\n<tr>\n    <th class="data-label"><%= Localizer.localize(\'manualActivity.name\') %></th>\n    <th class="data-label"><%= Localizer.localize(\'manualActivity.date\') %></th>\n    <th class="data-label"><%= Localizer.localize(\'label.time\') %></th>\n</tr>\n</thead>\n<tbody id="activityList" class="report-activity-list">\n</tbody>\n<tfoot>\n    <tr>\n        <td colspan="3">\n            <div class="centered">\n                <button class="btn btn-secondary btn-small show-more-btn top-s"><%= Localizer.localize(\'show_previous_comments\') %></button>\n            </div>\n        </td>\n    </tr>\n</tfoot>\n'}),define("text!templates/report/ReportActivityListTimeRow.html",[],function(){return'<tr class="table-subhead animated-fast fadeInDown">\n    <td colspan="3">\n        <%= timeBucket %>\n    </td>\n</tr>\n'}),define("views/report/ReportActivityListView",["require","underscore","backbone","localizer","utils/date/DateParser","moment","views/report/ReportActivityListRowView","text!templates/report/ReportActivityListView.html","text!templates/report/ReportActivityListTimeRow.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/date/DateParser"),s=e("moment"),o=e("views/report/ReportActivityListRowView"),u=e("text!templates/report/ReportActivityListView.html"),a=e("text!templates/report/ReportActivityListTimeRow.html"),f={SHOW_MORE_CLICKED:"SHOW_MORE_CLICKED"},l=n.View.extend({template:t.template(u),tagName:"table",className:"table top-s",events:{"click .show-more-btn":"onShowMoreClicked"},initialize:function(e){this.activityList=e.activityList,this.aggregation=e.aggregation,this.startDate=e.startDate,this.timeRowHtml=t.template(a),this.weekOrMonth=this.aggregation==="monthly"?"month":"week",this.lastTimeBucket=(new s(this.startDate)).add(1,this.weekOrMonth).startOf(this.weekOrMonth),this.lastIndex=0},setActivityList:function(e,t){this.activityList=e,typeof t!="undefined"&&(this.aggregation=t,this.weekOrMonth=this.aggregation==="monthly"?"month":"week",this.lastTimeBucket=this.aggregation==="monthly"?(new s(this.startDate)).endOf("month"):(new s(this.startDate)).endOf("week"))},render:function(){this.$el.html(this.template({Localizer:r})),this.renderRows(),this.activityList.mayHaveMoreModels||this.hideShowMore()},renderRows:function(){var e=this.activityList.length,t=this.$("#activityList"),n={};if(e>0){for(var r=this.lastIndex;r<e;r+=1){var u=this.activityList.at(r),a=i.parseISO(u.get("startTimeLocal")),f=this.checkTimeBucket(new s(a));f&&t.append(this.timeRowHtml({timeBucket:f,isAdditionalRender:this.lastIndex!==0})),n=new o({activity:u,isAdditionalRender:this.lastIndex!==0}),n.render(),t.append(n.el)}this.lastIndex=r}},checkTimeBucket:function(e){var t=!1;if(e.diff(this.lastTimeBucket,this.weekOrMonth,!0)<0){var n=(new s).add(1,this.weekOrMonth).startOf(this.weekOrMonth).diff(e,this.weekOrMonth,!0);n<=1?t=r.localize("this_"+this.weekOrMonth):n<=2?t=r.localize("last_"+this.weekOrMonth+"_title"):t=r.localize("x_"+this.weekOrMonth+"s_ago",Math.floor(n)),this.lastTimeBucket=e.startOf(this.weekOrMonth)}return t},drawAdditionalRows:function(){this.renderRows()},hideShowMore:function(){this.$(".show-more-btn").hide()},onShowMoreClicked:function(){this.trigger(f.SHOW_MORE_CLICKED)},clearLastIndex:function(){this.lastIndex=0}});return l.Events=f,l}),define("text!templates/report/reportComparison.html",[],function(){return'<h6 class="top-l">Comparison</h6>\n\n<div class="row-fluid">\n    <div class="dropdown dropdown-extended bravo span4">\n        <button class="color-2 btn-block text-left" data-toggle="dropdown">\n            <span class="dropdown-label"><%= Localizer.localize(\'select.one\') %></span>\n            <i class="icon-arrow-down pull-right"></i>\n        </button>\n        <ul class="dropdown-menu pull-left" role="menu">\n            <% for(var i=0; i < report.comparableMetrics.length; i++) { %>\n            <li><a tabindex="-1" href="#" class="js-select-compare dropdown-tier js-compare-1-<%= report.comparableMetrics[i].metricName %>"><%= Localizer.localize(report.comparableMetrics[i].metricName) %></a></li>\n            <% } %>\n        </ul>\n    </div>\n\n    <% if (report.comparableMetrics.length > 1) { %>\n    <div class="dropdown dropdown-extended charlie span4">\n        <button class="color-2 btn-block text-left" data-toggle="dropdown">\n            <span class="dropdown-label"><%= Localizer.localize(\'select.one\') %></span>\n            <i class="icon-arrow-down pull-right"></i>\n        </button>\n        <ul class="dropdown-menu pull-left" role="menu">\n            <% for(var i=0; i < report.comparableMetrics.length; i++) { %>\n            <li><a tabindex="-1" href="#" class="js-select-compare dropdown-tier js-compare-2-<%= report.comparableMetrics[i].metricName %>"><%= Localizer.localize(report.comparableMetrics[i].metricName) %></a></li>\n            <% } %>\n        </ul>\n    </div>\n    <% } %>\n\n    <% if (report.comparableMetrics.length > 2) { %>\n    <div class="dropdown dropdown-extended delta span4">\n        <button class="color-2 btn-block text-left" data-toggle="dropdown">\n            <span class="dropdown-label"><%= Localizer.localize(\'select.one\') %></span>\n            <i class="icon-arrow-down pull-right"></i>\n        </button>\n        <ul class="dropdown-menu pull-left" role="menu">\n            <% for(var i=0; i < report.comparableMetrics.length; i++) { %>\n            <li><a tabindex="-1" href="#" class="js-select-compare dropdown-tier js-compare-3-<%= report.comparableMetrics[i].metricName %>"><%= Localizer.localize(report.comparableMetrics[i].metricName) %></a></li>\n            <% } %>\n        </ul>\n    </div>\n    <% } %>\n\n</div>\n'}),define("views/report/ReportComparisonView",["underscore","backbone","localizer","views/report/ReportComparisonView","text!templates/report/reportComparison.html"],function(e,t,n,r,i){var r=t.View.extend({events:{"click .js-select-compare":"onCompareSelectionClicked"},initialize:function(t){this.template=e.template(i),this.report=t.report},render:function(){var e=this.template({Localizer:n,report:this.report});jQuery(this.el).html(e)},onCompareSelectionClicked:function(e){e.preventDefault();var n=e.toElement,r=n.id,i=n.className;reportType?t.history.navigate("/report/"+r+"/"+reportType,{trigger:!0}):t.history.navigate("/reports",{trigger:!0})}});return r}),define("views/report/ScatterChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","utils/ReportTypes","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s){return i.extend({initializeChart:function(e){this.metricColorRanges=e.metricColorRanges,this.metricAvg=e.metricAvg,this.metricCount=0},createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("value.label"),this.yAxisTitle]}},determineYAxisTitle:function(){switch(this.report.metricName){case s.ACTIVITY_AVERAGE_SPEED:return n.localize("label_speed");case s.ACTIVITY_AVERAGE_PACE:return n.localize("label_pace");case s.ACTIVITY_AVERAGE_SWIM_PACE:return n.localize("label_swim_pace");case s.ACTIVITY_AVERAGE_HEART_RATE:case s.ACTIVITY_MAX_HEART_RATE:return n.localize("label_heart_rate");case s.ACTIVITY_AVERAGE_POWER:return n.localize("label_power");case s.ACTIVITY_AVERAGE_BIKE_CADENCE:return n.localize("label_bike_cadence");case s.ACTIVITY_AVERAGE_RUN_CADENCE:return n.localize("label_run_cadence");case s.ACTIVITY_NORMALIZED_POWER:return n.localize("label_norm_power");case s.ACTIVITY_MAX_20_MIN_AVERAGE_POWER:return n.localize("label_max_20_min_avg_power");case s.ACTIVITY_VERTICAL_OSCILLATION:return n.localize("label_vert_oscillation");case s.ACTIVITY_GROUND_CONTACT_TIME:return n.localize("label_ground_contact_time");case s.ACTIVITY_AVG_STRIDE_LENGTH:return n.localize("distance.meter");case s.ACTIVITY_AVG_VERTICAL_RATIO:return n.localize("ACTIVITY_AVG_VERTICAL_RATIO");case s.ACTIVITY_AVG_GROUND_CONTACT_BALANCE:return""}},setCategories:function(){},setSeries:function(){this.options.series=[{showInLegend:!1,name:null,data:this.chartSeries}]},customizeOptions:function(){Highcharts.setOptions({lang:{shortMonths:[n.localize("month.abbr.01"),n.localize("month.abbr.02"),n.localize("month.abbr.03"),n.localize("month.abbr.04"),n.localize("month.abbr.05"),n.localize("month.abbr.06"),n.localize("month.abbr.07"),n.localize("month.abbr.08"),n.localize("month.abbr.09"),n.localize("month.abbr.10"),n.localize("month.abbr.11"),n.localize("month.abbr.12")]}}),this.options.xAxis={type:"datetime",tickInterval:26784e5,dateTimeLabelFormats:{month:"%b",millisecond:"%b"},labels:{style:{color:"#666"}},title:{enabled:!1}},this.options.plotOptions={scatter:{marker:{radius:5,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},states:{hover:{marker:{enabled:!1},halo:null}}}};var e="";switch(this.report.metricName){case s.ACTIVITY_AVERAGE_SPEED:e=this.userPreferences.get("measurementSystem")=="metric"?n.localize("speed_unit_metric"):n.localize("speed_unit_statute");var t=this.userPreferences.get("measurementSystem")=="metric"?n.localize("label_speed_unit_metric"):n.localize("label_speed_unit_statute");this.options.yAxis.title.text=t;break;case s.ACTIVITY_AVERAGE_PACE:e=this.userPreferences.get("measurementSystem")=="metric"?n.localize("pace_unit_metric"):n.localize("pace_unit_statute");var t=this.userPreferences.get("measurementSystem")=="metric"?n.localize("label_pace_unit_metric"):n.localize("label_pace_unit_statute");this.options.yAxis.title.text=t;break;case s.ACTIVITY_AVERAGE_RUN_CADENCE:e=n.localize("run_cadence_unit");var t=n.localize("label_run_cadence_unit");this.options.yAxis.title.text=t;break;case s.ACTIVITY_AVERAGE_BIKE_CADENCE:e=n.localize("bike_cadence_unit");var t=n.localize("label_bike_cadence_unit");this.options.yAxis.title.text=t;break;case s.ACTIVITY_AVERAGE_HEART_RATE:case s.ACTIVITY_MAX_HEART_RATE:e=n.localize("heart_rate_unit");var t=n.localize("label_heart_rate_unit");this.options.yAxis.title.text=t;break;case s.ACTIVITY_AVERAGE_POWER:case s.ACTIVITY_NORMALIZED_POWER:case s.ACTIVITY_MAX_20_MIN_AVERAGE_POWER:e=n.localize("max_avg_power_unit");var t=n.localize("label_power_unit");this.options.yAxis.title.text=t;break;case s.ACTIVITY_VERTICAL_OSCILLATION:e=n.localize("vert_oscillation_unit");var t=n.localize("label_vert_oscillation_unit");this.options.yAxis.title.text=t;break;case s.ACTIVITY_GROUND_CONTACT_TIME:e=n.localize("ground_contact_time_unit");var t=n.localize("label_ground_contact_time_unit");this.options.yAxis.title.text=t;break;case s.ACTIVITY_AVG_STRIDE_LENGTH:e=n.localize("stride_length_unit");var t=n.localize("stride_length_unit");this.options.yAxis.title.text=t;break;case s.ACTIVITY_AVG_GROUND_CONTACT_BALANCE:e=""}var i=this.determineAverageValue(),o=i;switch(this.report.metricName){case s.ACTIVITY_AVERAGE_PACE:case s.ACTIVITY_AVERAGE_SWIM_PACE:o=r.personalizePace(1/this.metricAvg,!0);break;case s.ACTIVITY_AVG_GROUND_CONTACT_BALANCE:var u=r.getGroundContactBalance(this.metricAvg);o=n.localize(r.getPowerBalanceUnitKey(),u.left,u.right);break;case s.ACTIVITY_AVG_VERTICAL_RATIO:o=r.personalizeVerticalRatio(this.metricAvg)+" "+n.localize(r.getVerticalRatioUnitKey())}this.chartFormat=="page"&&(this.options.yAxis.plotLines=[{value:i,color:"black",dashStyle:"solid",width:2,label:{text:n.localize("average")+" = "+o+" "+e},zIndex:5}]);if(this.report.metricName==s.ACTIVITY_AVG_GROUND_CONTACT_BALANCE){var a=this.calculateGCTMinMax();this.options.yAxis.max=a.max,this.options.yAxis.min=a.min,this.options.yAxis.labels={formatter:function(){return this.value<50?n.localize("power_balance_right_format",100-this.value):this.value>50?n.localize("power_balance_left_format",this.value):"50/50"}},this.options.tooltip={formatter:function(){var e=r.getGroundContactBalance(this.y);return n.localize(r.getPowerBalanceUnitKey(),e.left,e.right)}}}else this.options.tooltip={formatter:function(){return"<b>"+r.personalizeDateWithShortMonth(new Date(this.x),n)+"</b><br>"+this.point.name}}},calculateGCTMinMax:function(){var t=0,n=100;return e.each(this.options.series[0].data,function(e){e.y>t&&(t=e.y),e.y<n&&(n=e.y)}),100-n>=t?t=100-n:n=100-t,n=Math.max(0,n),t=Math.min(100,t),{min:n,max:t}},initializeChartSeries:function(){this.chartSeries=[]},addMetricToDataset:function(t){var n="";this.chartFormat!="widget"||!!e.isUndefined(t.startDateOfWeek)||this.metricPeriod!="monthly"&&this.metricPeriod!="yearly"?e.isUndefined(t.calendarDate)?n=[t.month.year+"-"+t.month.monthId+"-1"]:n=t.calendarDate.split(" "):n=t.startDateOfWeek.split(" ");var r=n[0].split("-"),i=new Date(r[0],r[1]-1,r[2],0,0,0),s=i.getFullYear().toString(),o=i.getMonth().toString(),u=i.getDate().toString();if(t.value>0){var a=this.determineSeriesName(t),f=this.determineSeriesValue(t),l=this.getPointColor(f),c=5;if(this.chartFormat=="widget")var c=3;var h={name:a,x:Date.UTC(s,o,u,12,0,0),y:f,color:l,marker:{fillColor:l,radius:c,states:{hover:{fillColor:l}}}};this.chartSeries.push(h),this.exportData.rows[this.exportDataCount++]={values:[n.toString(),f,a]}}},getPointColor:function(e){var t="#11a9ed";switch(this.report.metricName){case s.ACTIVITY_GROUND_CONTACT_TIME:case s.ACTIVITY_AVERAGE_RUN_CADENCE:this.metricColorRanges.each(function(n){e>=n.get("rangeMin")&&e<n.get("rangeMax")&&(t=n.get("rangeColor"))});break;case s.ACTIVITY_AVG_GROUND_CONTACT_BALANCE:t=this.getGCTBalanceColor(e);break;case s.ACTIVITY_VERTICAL_OSCILLATION:case s.ACTIVITY_AVG_VERTICAL_RATIO:return"#cf23b8"}return t},getGCTBalanceColor:function(e){if(e<47.6)return"#ff0035";if(e>=47.6&&e<=49.4)return"#ed7e00";if(e>=49.3&&e<=50.7)return"#50b012";if(e>=50.6&&e<=52.2)return"#ed7e00";if(e>52.2)return"#ff0035"},determineSeriesName:function(e){var t=e.value;switch(this.report.metricName){case s.ACTIVITY_AVERAGE_SPEED:var i=this.userPreferences.get("measurementSystem")=="metric"?n.localize("speed_unit_metric"):n.localize("speed_unit_statute");t=Math.round(r.convertSpeed(e.value,this.userPreferences.get("measurementSystem"))*100)/100+" "+i;break;case s.ACTIVITY_AVERAGE_PACE:case s.ACTIVITY_AVERAGE_SWIM_PACE:var i=this.userPreferences.get("measurementSystem")=="metric"?n.localize("pace_unit_metric"):n.localize("pace_unit_statute");t=r.personalizePace(1/e.value,!0)+" "+i;break;case s.ACTIVITY_AVERAGE_HEART_RATE:case s.ACTIVITY_MAX_HEART_RATE:t=Math.round(e.value)+" "+n.localize("heart_rate_unit");break;case s.ACTIVITY_AVERAGE_POWER:t=e.value+" "+n.localize("max_avg_power_unit");break;case s.ACTIVITY_AVERAGE_BIKE_CADENCE:t=Math.round(e.value)+" "+n.localize("bike_cadence_unit");break;case s.ACTIVITY_AVERAGE_RUN_CADENCE:t=Math.round(e.value)+" "+n.localize("run_cadence_unit");break;case s.ACTIVITY_NORMALIZED_POWER:t=Math.round(e.value)+" "+n.localize("max_avg_power_unit");break;case s.ACTIVITY_MAX_20_MIN_AVERAGE_POWER:t=Math.round(e.value)+" "+n.localize("max_avg_power_unit");break;case s.ACTIVITY_VERTICAL_OSCILLATION:t=Math.round(e.value*10)/10+" "+n.localize("vert_oscillation_unit");break;case s.ACTIVITY_GROUND_CONTACT_TIME:t=Math.round(e.value)+" "+n.localize("ground_contact_time_unit");break;case s.ACTIVITY_AVG_STRIDE_LENGTH:t=Math.round(r.convertStrideLength(e.value)*100)/100+" "+n.localize("stride_length_unit");break;case s.ACTIVITY_AVG_VERTICAL_RATIO:t=r.personalizeVerticalRatio(e.value)+" "+n.localize(r.getVerticalRatioUnitKey());break;case s.ACTIVITY_AVG_GROUND_CONTACT_BALANCE:t=Math.round(e.value)}return t},determineSeriesValue:function(e){var t=e.value;switch(this.report.metricName){case s.ACTIVITY_AVERAGE_SPEED:t=Math.round(r.convertSpeed(e.value,this.userPreferences.get("measurementSystem"))*100)/100;break;case s.ACTIVITY_AVERAGE_PACE:case s.ACTIVITY_AVERAGE_SWIM_PACE:this.userPreferences.get("measurementSystem")=="metric"?t=Math.round(e.value*16.66667*100)/100:t=Math.round(e.value*26.8224*100)/100;break;case s.ACTIVITY_AVERAGE_HEART_RATE:case s.ACTIVITY_MAX_HEART_RATE:case s.ACTIVITY_AVERAGE_POWER:case s.ACTIVITY_AVERAGE_BIKE_CADENCE:case s.ACTIVITY_AVERAGE_RUN_CADENCE:case s.ACTIVITY_NORMALIZED_POWER:case s.ACTIVITY_MAX_20_MIN_AVERAGE_POWER:case s.ACTIVITY_GROUND_CONTACT_TIME:t=Math.round(e.value);break;case s.ACTIVITY_AVG_STRIDE_LENGTH:t=Math.round(r.convertStrideLength(e.value)*100)/100;break;case s.ACTIVITY_VERTICAL_OSCILLATION:t=Math.round(e.value*10)/10}return t},determineAverageValue:function(){var e=this.metricAvg;switch(this.report.metricName){case s.ACTIVITY_AVERAGE_SPEED:e=Math.round(r.convertSpeed(this.metricAvg,this.userPreferences.get("measurementSystem"))*100)/100;break;case s.ACTIVITY_AVERAGE_PACE:case s.ACTIVITY_AVERAGE_SWIM_PACE:this.userPreferences.get("measurementSystem")=="metric"?e=Math.round(this.metricAvg*16.66667*100)/100:e=Math.round(this.metricAvg*26.8224*100)/100;break;case s.ACTIVITY_AVERAGE_HEART_RATE:case s.ACTIVITY_MAX_HEART_RATE:case s.ACTIVITY_AVERAGE_POWER:case s.ACTIVITY_AVERAGE_BIKE_CADENCE:case s.ACTIVITY_AVERAGE_RUN_CADENCE:case s.ACTIVITY_NORMALIZED_POWER:case s.ACTIVITY_MAX_20_MIN_AVERAGE_POWER:case s.ACTIVITY_GROUND_CONTACT_TIME:e=Math.round(this.metricAvg);break;case s.ACTIVITY_AVG_STRIDE_LENGTH:e=Math.round(r.convertStrideLength(this.metricAvg)*100)/100;break;case s.ACTIVITY_VERTICAL_OSCILLATION:e=Math.round(this.metricAvg*10)/10}return e}})}),define("views/report/SleepChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","utils/ReportChartUtil","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s){return i.extend({determineYAxisTitle:function(){return n.localize("sleep.label")},createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("sleep_duration_unit"),n.localize("sleep_duration_unit")]}},customizeOptions:function(){var e=this;this.options.yAxis={min:0,labels:{formatter:function(){return r.formatDecimalNumber(this.value,0)}},title:{text:n.localize("label_sleep_duration")}};switch(this.metricPeriod){case"weekly":this.options.xAxis.tickInterval=8,this.options.xAxis.showFirstLabel=!0,this.options.xAxis.showLastLabel=!0,this.options.xAxis.labels={align:"left",formatter:function(){return this.value}};break;case"monthly":this.options.xAxis.showFirstLabel=!0,this.options.xAxis.tickInterval=4,this.options.xAxis.labels={formatter:function(){var t=e.userPreferences.get("dateFormat");return t.formatKey=="mmddyyyy"||t.formatKey=="yyyymmdd"?this.value.substr(0,this.value.indexOf(" ")):this.value.substr(this.value.indexOf(" ")+1)}};break;case"yearly":this.options.xAxis.showFirstLabel=!0,this.options.xAxis.tickInterval=this.chartFormat=="widget"?8:5,this.options.xAxis.labels={formatter:function(){var t=e.userPreferences.get("dateFormat");return t.formatKey=="mmddyyyy"||t.formatKey=="yyyymmdd"?this.value.substr(0,this.value.indexOf(" ")):this.value.substr(this.value.indexOf(" ")+1)}}}this.options.plotOptions={series:{marker:{radius:this.chartFormat=="widget"?1:3},states:{hover:{enabled:!0,halo:null}}}};switch(this.metricPeriod){case"daily":case"weekly":this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+n.localize("sleep")+": "+this.point.name}};break;case"weekly":case"monthly":case"yearly":this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+n.localize("sleep.label.avg")+": "+this.point.name}}}},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.sleep={color:"#daf200",fillOpacity:.5,name:n.localize("sleep"),type:"area",data:this.createZeroArray(this.metricPeriod)}},createZeroArray:function(){switch(this.metricPeriod){case"daily":return[{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)}];case"weekly":return[{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)}];case"monthly":return[{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)}];case"yearly":return[{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)},{y:0,name:n.localize("sleep.duration.label.2",0)}]}},getXAxisCategories:function(){switch(this.metricPeriod){case"daily":this.getDailyCategories();break;case"weekly":this.getOneMonthCategories();break;case"monthly":case"yearly":this.getWeeklyCategories()}},getDailyCategories:function(){this.categories=[];for(var e=-6;e<=0;e++){var t=new Date;t.setHours(12),t.setMinutes(0),t.setMilliseconds(0),t.setDate(t.getDate()+this.currentDateOffset),t.setDate(t.getDate()+e);var r="",i=t.getDay().toString();r=n.localize("day."+i+".short"),this.categories.push(r)}},getOneMonthCategories:function(){this.categories=[];for(var e=-29;e<=0;e++){var t=new Date;t.setHours(12),t.setMinutes(0),t.setMilliseconds(0),t.setDate(t.getDate()+this.currentDateOffset),t.setDate(t.getDate()+e);var r=t.getDate().toString(),i=(t.getMonth()+1).toString(),s=this.userPreferences.get("dateFormat"),o="";s.formatKey=="mmddyyyy"||s.formatKey=="yyyymmdd"?o=n.localize("month.abbr."+(i>9?i:"0"+i))+" "+r:o=r+" "+n.localize("month.abbr."+(i>9?i:"0"+i)),this.categories.push(o)}},determineDataIndex:function(e){var t="";switch(this.metricPeriod){case"daily":t=this.calculateDailyDataIndex(e.calendarDate,7);break;case"weekly":t=this.calculateWeeklyDataIndex(e.calendarDate);break;case"weekly":case"monthly":case"yearly":t=this.calculateWeeklyDataIndex(e.startDateOfWeek)}return t},calculateDailyDataIndex:function(e,t){var n=s.formatDate(this.currentDateOffset),r=s.determineNumberOfDays(e,n),i=t-r;return i<0||i>6?-1:i},calculateWeeklyDataIndex:function(e){var t=e.split("-"),r=new Date(t[0],t[1]-1,t[2],0,0,0),i=r.getMonth()+1,s=r.getDate(),o=this.userPreferences.get("dateFormat"),u="";o.formatKey=="mmddyyyy"||o.formatKey=="yyyymmdd"?u=n.localize("month.abbr."+(i>9?i:"0"+i))+" "+s:u=s+" "+n.localize("month.abbr."+(i>9?i:"0"+i));var a=this.categories.indexOf(u);return a<0?-1:a},addMetricToDataset:function(e){var t=this.determineDataIndex(e);if(t>=0&&this.chartSeries.sleep){var r=3600;this.value=Math.round(e.value/r*10)/10;var i=Math.floor(e.value/r),s=Math.round((e.value-i*r)/60);this.label=i+":"+(s>9?s:"0"+s)+" "+n.localize("sleep_duration_unit").toLowerCase(),this.chartSeries.sleep.data[t]={y:this.value,name:this.label},this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],this.value,this.label]}}}})}),define("views/report/StepChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i){return i.extend({determineYAxisTitle:function(){return n.localize("steps.label")},customizeOptions:function(){var e=this;this.options.plotOptions={column:{dataLabels:{enabled:!1,color:"white"}},series:{stacking:"normal",showCheckbox:!1,selected:!0}},this.options.tooltip={formatter:function(){var t=e.goalSeries.goal.data[this.point.x];return"<b>"+this.x+"</b><br/>"+this.series.name+": "+r.formatDecimalNumber(this.y,0)+" "+n.localize("steps.label")+"<br/>"+n.localize("step.goal")+": "+r.formatDecimalNumber(t,0)+" "+n.localize("steps.label")}}},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.remaining={color:"#dddddd",name:n.localize("step.remaining"),data:this.createZeroArray(this.metricPeriod)},this.chartSeries.incomplete={color:"#11a9ed",name:n.localize("step.actual"),data:this.createZeroArray(this.metricPeriod)},this.chartSeries.complete={color:"#80ea40",name:n.localize("step.actual"),data:this.createZeroArray(this.metricPeriod)},this.goalSeries={},this.goalSeries.goal={name:n.localize("step.goal"),data:this.createZeroArray(this.metricPeriod)}},createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("step.actual"),n.localize("step.goal")]}},processMetricList:function(e){this.metricsMap=e.get("metricsMap");var t=this.metricsMap.WELLNESS_TOTAL_STEPS;if(t)for(var n=0;n<t.length;n++)this.addMetricToDataset(t[n])},addMetricToDataset:function(e){var t=this.determineDataIndex(e);if(t>=0){var n=this.getGoalValue(t);this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],e.value||0,n||0]},e.value>=n?(this.chartSeries.remaining.data[t]=0,this.chartSeries.complete.data[t]=e.value):(this.chartSeries.remaining.data[t]=n-e.value,this.chartSeries.incomplete.data[t]=e.value),this.goalSeries.goal.data[t]=n}},getGoalValue:function(e){var t=0,n=this.metricsMap.WELLNESS_TOTAL_STEP_GOAL;for(var r=0;r<n.length;r++){var i=n[r],s=this.determineDataIndex(i);s==e&&(t=i.value)}return t}})}),define("views/report/SwimChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","utils/ReportTypes","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s){return i.extend({createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",this.yAxisTitle]}},determineYAxisTitle:function(){switch(this.report.metricName){case s.ACTIVITY_AVERAGE_STROKES:return n.localize("label_strokes");case s.ACTIVITY_AVERAGE_SWOLF:case s.ACTIVITY_MINIMUM_SWOLF:return n.localize("label_swolf")}},customizeOptions:function(){this.options.plotOptions={column:{dataLabels:{enabled:!1,color:"white"}},series:{stacking:"normal",showCheckbox:!1,selected:!0}},this.options.yAxis.title={text:this.yAxisTitle},this.options.tooltip={formatter:function(){return"<b>"+this.series.name+"</b><br/>"+this.x+": "+r.formatDecimalNumber(this.y,0)}}},initializeChartSeries:function(){this.chartSeries={},this.chartSeries[0]={color:"#11a9ed",name:this.yAxisTitle,data:this.createZeroArray(this.metricPeriod)}},addMetricToDataset:function(e){var t=this.determineDataIndex(e);t>=0&&this.chartSeries[0]&&(this.chartSeries[0].data[t]=e.value,this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],e.value]})}})}),define("views/report/TotalCaloriesChartView",["underscore","backbone","localizer","personalizer","utils/ActivityTypeMapper","views/report/ChartView","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i,s){return s.extend({createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("calorie.type.label"),n.localize("value.label")]}},determineYAxisTitle:function(){return n.localize("label_calories")},customizeOptions:function(){this.options.plotOptions={column:{stacking:"normal",dataLabels:{enabled:!1,color:"white"}},series:{stacking:"normal",showCheckbox:!1,selected:!0}},this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+r.formatDecimalNumber(this.y,0)+" "+n.localize("label_calories_abbr")+"<br/>"+n.localize("total")+": "+r.formatDecimalNumber(this.point.stackTotal,0)+" "+n.localize("label_calories_abbr")}}},initializeChartSeries:function(){this.chartSeries={},this.chartSeries.active={color:"#ff0035",name:n.localize("active"),data:this.createZeroArray(this.metricPeriod)},this.chartSeries.bmr={color:"#11a9ed",name:n.localize("bmr"),data:this.createZeroArray(this.metricPeriod)}},processMetricList:function(e){var t=e.get("metricsMap");this.calorieType="bmr";var n=t.WELLNESS_BMR_CALORIES;if(n)for(var r=0;r<n.length;r++)this.addMetricToDataset(n[r]);this.calorieType="active";var i=t.COMMON_ACTIVE_CALORIES;if(i)for(var r=0;r<i.length;r++)this.addMetricToDataset(i[r])},addMetricToDataset:function(e){var t=this.determineDataIndex(e);t>=0&&this.chartSeries[this.calorieType]&&(this.chartSeries[this.calorieType].data[t]=Math.round(e.value*10)/10,this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],n.localize(this.calorieType),Math.round(e.value*10)/10]})}})}),define("models/vo2max/Vo2MaxMetrics",["require","backbone","moment"],function(e){var t=e("backbone"),n=e("moment"),r=t.Model.extend({urlRoot:"/proxy/metrics-service/metrics/maxmet/latest/",initialize:function(e){this.calendarDate=e.calendarDate||n().format("YYYY-MM-DD"),this.maxMetCategory=e.maxMetCategory||null},url:function(){return this.maxMetCategory!==null?this.urlRoot+this.calendarDate+"?maxMetCategory="+this.maxMetCategory:this.urlRoot+this.calendarDate}});return r}),define("text!templates/report/TrainingStatusDevicePickerView.html",[],function(){return'<div>\n    <div class="controls controls-row">\n        <select class="input-medium" id="ts-device-filter">\n            <optgroup label="<%= Localizer.localize(\'agent.select.device\') %>">\n                <% for (var i = 0; i < deviceList.length; i++) {         %>\n                    <% if (deviceList[i].deviceId === selectedDevice) { %>\n                        <option data-value="<%= deviceList[i].deviceId %>" selected><%= deviceList[i].deviceName === "other.device" ? Localizer.localize(\'other.device\') + \' \' + (i+1) : deviceList[i].deviceName %></option>\n                    <% } else { %>\n                        <option data-value="<%= deviceList[i].deviceId %>"><%= deviceList[i].deviceName === "other.device" ? Localizer.localize(\'other.device\') + \' \' + (i+1) : deviceList[i].deviceName %></option>\n                    <% } %>\n                <% } %>\n            </optgroup>\n        </select>\n    </div>\n</div>'}),define("views/report/TrainingStatusDevicePickerView",["require","underscore","backbone","localizer","text!templates/report/TrainingStatusDevicePickerView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("text!templates/report/TrainingStatusDevicePickerView.html"),s={CHANGE:"CHANGE"},o=n.View.extend({className:"control-group",template:t.template(i),events:{"change #ts-device-filter":"onSelectionChanged"},initialize:function(e){return this.deviceList=e.deviceList,this.selectedDevice=e.selectedDevice,this},render:function(){return this.$el.html(this.template({Localizer:r,deviceList:this.deviceList,selectedDevice:this.selectedDevice})),this},onSelectionChanged:function(e){var t=$(e.currentTarget).find(":selected").attr("data-value");this.trigger(s.CHANGE,t)}});return o.Events=s,o}),define("text!templates/report/TrainingLoadModalView.html",[],function(){return"<h5><%= Localizer.localize('TRAINING_LOAD_DESCRIPTION') %></h5>\n\n<table class=\"table\">\n    <tbody><tr>\n        <th><span class=\"training-load-indicator training-load-high\"></span><%= Localizer.localize('TRAINING_LOAD_HIGH') %></th>\n        <td><%= Localizer.localize('TRAINING_LOAD_DESCRIPTION_HIGH') %></td>\n    </tr>\n    <tr>\n        <th><span class=\"training-load-indicator training-load-optimal\"></span><%= Localizer.localize('TRAINING_LOAD_OPTIMAL') %></th>\n        <td><%= Localizer.localize('TRAINING_LOAD_DESCRIPTION_OPTIMAL') %></td>\n    </tr>\n    <tr>\n        <th><span class=\"training-load-indicator training-load-low\"></span><%= Localizer.localize('TRAINING_LOAD_LOW') %></th>\n        <td><%= Localizer.localize('TRAINING_LOAD_DESCRIPTION_LOW') %></td>\n    </tr>\n    </tbody>\n</table>\n"}),define("views/report/TrainingLoadModalView",["require","underscore","backbone","localizer","text!templates/report/TrainingLoadModalView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("text!templates/report/TrainingLoadModalView.html"),s=n.View.extend({template:t.template(i),initialize:function(e){},render:function(){this.$el.html(this.template({Localizer:r}))}});return s}),define("text!templates/report/VO2HelpModalView.html",[],function(){return"<p><%=Localizer.localize('VO2_HELP') %></p>\n<p><%=Localizer.localize('VO2_DESCRIPTION') %></p>\n"}),define("views/report/VO2HelpModalView",["require","underscore","backbone","localizer","text!templates/report/VO2HelpModalView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("text!templates/report/VO2HelpModalView.html"),s=n.View.extend({template:t.template(i),initialize:function(e){},render:function(){this.$el.html(this.template({Localizer:r}))}});return s}),define("utils/TrainingStatusUtil",["require","underscore","localizer"],function(e){var t=e("underscore"),n=e("localizer"),r={Statuses:{No_Status:0,Detraining:1,Unproductive:2,Overreaching:3,Maintaining:4,Recovery:5,Peaking:6,Productive:7},isTrainingStatusAvailable:function(e){return e&&e.get("deviceBasedIndicators").hasTrainingStatusCapableDevice===!0},determineIfNoData:function(e){var n=!0;if(!t.isEmpty(e))for(var r=0;r<e.length;r++)if(e[r].trainingStatus!==this.Statuses.No_Status&&e[r].trainingStatus!==255){n=!1;break}return n},getStatusClass:function(e){var t;return e===this.Statuses.Productive?t="training-status-productive":e===this.Statuses.Peaking?t="training-status-peaking":e===this.Statuses.Recovery?t="training-status-recovery":e===this.Statuses.Maintaining?t="training-status-maintaining":e===this.Statuses.Overreaching?t="training-status-overreaching":e===this.Statuses.Unproductive?t="training-status-unproductive":e===this.Statuses.Detraining?t="training-status-detraining":t="training-status-no-status",t},getStatusName:function(e){var t;return e===this.Statuses.Productive?t=n.localize("TRAINING_STATUS_PRODUCTIVE"):e===this.Statuses.Peaking?t=n.localize("TRAINING_STATUS_PEAKING"):e===this.Statuses.Recovery?t=n.localize("TRAINING_STATUS_RECOVERY"):e===this.Statuses.Maintaining?t=n.localize("TRAINING_STATUS_MAINTAINING"):e===this.Statuses.Overreaching?t=n.localize("TRAINING_STATUS_OVERREACHING"):e===this.Statuses.Unproductive?t=n.localize("TRAINING_STATUS_UNPRODUCTIVE"):e===this.Statuses.Detraining?t=n.localize("TRAINING_STATUS_DETRAINING"):t=n.localize("TRAINING_STATUS_NO_STATUS"),t},getStatusDescription:function(e){var t;return e===this.Statuses.Productive?t=n.localize("TRAINING_STATUS_PRODUCTIVE_DESCRIPTION"):e===this.Statuses.Peaking?t=n.localize("TRAINING_STATUS_PEAKING_DESCRIPTION"):e===this.Statuses.Recovery?t=n.localize("TRAINING_STATUS_RECOVERY_DESCRIPTION"):e===this.Statuses.Maintaining?t=n.localize("TRAINING_STATUS_MAINTAINING_DESCRIPTION"):e===this.Statuses.Overreaching?t=n.localize("TRAINING_STATUS_OVERREACHING_DESCRIPTION"):e===this.Statuses.Unproductive?t=n.localize("TRAINING_STATUS_UNPRODUCTIVE_DESCRIPTION"):e===this.Statuses.Detraining?t=n.localize("TRAINING_STATUS_DETRAINING_DESCRIPTION"):t=n.localize("TRAINING_STATUS_NO_STATUS_DESCRIPTION"),t},getLoadStatus:function(e,t,r){var i={"class":null,tooltip:null};return r>t?(i.class="training-load-high",i.tooltip=n.localize("TRAINING_LOAD_HIGH")):r<e?(i.class="training-load-low",i.tooltip=n.localize("TRAINING_LOAD_LOW")):(i.class="training-load-optimal",i.tooltip=n.localize("TRAINING_LOAD_OPTIMAL")),i},shouldShowDevicePicker:function(e){return e>1},addMetricToDataset:function(e,t,n){var r=this.calculateWeeklyDataIndex(e,t,n);return r},calculateWeeklyDataIndex:function(e,t,r){var i=e.split("-"),s=new Date(i[0],i[1]-1,i[2],0,0,0),o=s.getMonth()+1,u=s.getDate(),a=r.get("dateFormat"),f="";a.formatKey==="mmddyyyy"||a.formatKey==="yyyymmdd"?f=n.localize("month.abbr."+(o>9?o:"0"+o))+" "+u:f=u+" "+n.localize("month.abbr."+(o>9?o:"0"+o));var l=t.indexOf(f);if(l<0){for(var c=0;c<t.length;c++)if(Date.parse(f)-Date.parse(t[c])<0){l=c-1;break}l<0&&(l=t.length-1)}return l},getStatusDataForDevice:function(e,t){var n;return t.latestTrainingStatusData?(n=t.latestTrainingStatusData[e],n):null}};return r}),define("text!templates/report/TrainingStatusWidgetCurrentView.html",[],function(){return'<% if (displayNoStatus) { %>\n    <div class="h6 text-center top-l bottom-s">\n        <%= Localizer.localize(\'TRAINING_STATUS_NO_STATUS_DESCRIPTION\') %>\n    </div>\n    <% if (displayDevicePicker) { %>\n    <div id="device-picker-container" class="text-center"></div>\n    <% } %>\n<% } else { %>\n    <div class="text-center <%= displayDevicePicker ? \'top-s\' : \'top-l\' %>" >\n        <div class="training-status <%=statusClass%>">\n            <div class="training-status-symbol"></div>\n        </div>\n        <div class="data-block medium bottom-s">\n            <div class="data-bit"><%=statusName%></div>\n            <div class="data-label"><%=Localizer.localize(\'TRAINING_STATUS_CURRENT_STATUS\') %>  <%= calendarDate %></div>\n        </div>\n    </div>\n    <% if (displayDevicePicker) { %>\n        <div id="device-picker-container" class="text-center"></div>\n    <% } %>\n    <div class="row-fluid">\n        <div class="absolute-bottom absolute-left">\n            <div class="data-block small bottom-none">\n                <div class="data-bit"><%= trainingLoad %> <span data-placement="right" class="training-load-indicator has-tooltip <%= loadStatus.class %>" title="<%= loadStatus.tooltip %>"></span></div>\n                <div class="data-label"><%=Localizer.localize(\'TRAINING_LOAD\') %> <a title="<%=Localizer.localize(\'learn_more\')%>" href="#modal-training-load" data-toggle="modal" class="help-icon tl-help"><span class="icon-help"></span></a></div>\n            </div>\n        </div>\n        <div class="absolute-bottom absolute-right text-right">\n            <div class="data-block small bottom-none">\n                <div class="data-bit"><%= vo2Max %></div>\n                <div class="data-label"><%=useCycling ? Localizer.localize(\'ACTIVITY_VO2_MAX_CYCLING_LABEL\') : Localizer.localize(\'ACTIVITY_VO2_MAX\') %><a title="<%=Localizer.localize(\'learn_more\')%>" href="#modal-ts-vo2-max" data-toggle="modal" class="help-icon vo2-help"><span class="icon-help"></span></a></div>\n            </div>\n        </div>\n    </div>\n<% } %>'}),define("views/report/TrainingStatusCurrentView",["require","underscore","backbone","localizer","models/user/UserPreference","models/vo2max/Vo2MaxMetrics","views/report/TrainingStatusDevicePickerView","views/report/TrainingLoadModalView","views/report/VO2HelpModalView","views/main/Modal/ModalPopupView","utils/ModelSynchronizer","utils/TrainingStatusUtil","utils/date/DateParser","utils/date/DateFormatter","utils/ToolTipUtil","text!templates/report/TrainingStatusWidgetCurrentView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("models/user/UserPreference"),s=e("models/vo2max/Vo2MaxMetrics"),o=e("views/report/TrainingStatusDevicePickerView"),u=e("views/report/TrainingLoadModalView"),a=e("views/report/VO2HelpModalView"),f=e("views/main/Modal/ModalPopupView"),l=e("utils/ModelSynchronizer"),c=e("utils/TrainingStatusUtil"),h=e("utils/date/DateParser"),p=e("utils/date/DateFormatter"),d=e("utils/ToolTipUtil"),v=e("text!templates/report/TrainingStatusWidgetCurrentView.html"),m=n.View.extend({events:{"click .tl-help":"onTLHelpClicked","click .vo2-help":"onVO2HelpClicked"},initialize:function(e){this.trainingStatusData=e.metricList,this.template=t.template(v),this.displayDevicePicker=!1,this.deviceList=[],this.selectedDevice=null},render:function(){return this.getData(),this},getData:function(){this.vo2MaxData=new s({}),this.lastDisplayedDevice=new i({key:"TrainingStatus.last.device"});var e=new l;e.addModel({model:this.vo2MaxData,required:!0}),e.addModel({model:this.lastDisplayedDevice,required:!0}),e.on(l.Events.SYNCHRONIZED,this.onDataFetched,this),e.on(l.Events.SYNCHRONIZE_FAILED,this.onDataFail,this),e.fetchModels()},onDataFetched:function(){var e={};this.trainingStatusData&&!t.isEmpty(this.trainingStatusData.get("recordedDevices"))?(this.statusData=this.trainingStatusData.attributes,this.selectDeviceToDisplay(),this.displayData()):(e.displayNoStatus=!0,this.renderCurrentView(e))},displayData:function(){var e={};e=this.getTemplateOptions(),this.renderCurrentView(e),this.displayDevicePicker&&this.renderDevicePicker()},getTemplateOptions:function(){var e,t={};return t.displayNoStatus=!1,e=c.getStatusDataForDevice(this.selectedDevice,this.statusData),this.trainingStatus=e.trainingStatus,!this.trainingStatus||this.trainingStatus===c.Statuses.No_Status||this.trainingStatus>7?t.displayNoStatus=!0:(this.statusDate=p.formatMonthDayYear(h.parseISO(e.calendarDate)),e.sport==="CYCLING"?(t.vo2Max=this.vo2MaxData.get("cycling").vo2MaxValue,t.useCycling=!0):(t.vo2Max=this.vo2MaxData.get("generic").vo2MaxValue,t.useCycling=!1),t.trainingLoad=e.weeklyTrainingLoad,t.loadMin=e.loadTunnelMin,t.loadMax=e.loadTunnelMax,t.statusClass=c.getStatusClass(this.trainingStatus),t.statusName=c.getStatusName(this.trainingStatus),t.statusDescription=c.getStatusDescription(this.trainingStatus),t.loadStatus=c.getLoadStatus(t.loadMin,t.loadMax,t.trainingLoad)),t},renderCurrentView:function(e){this.$el.html(this.template({Localizer:r,displayNoStatus:e.displayNoStatus,displayDevicePicker:this.displayDevicePicker,statusClass:e.statusClass,statusName:e.statusName,statusDescription:e.statusDescription,calendarDate:this.statusDate,loadStatus:e.loadStatus,trainingLoad:e.trainingLoad,useCycling:e.useCycling,vo2Max:e.vo2Max})),d.renderTooltips.call(this)},renderDevicePicker:function(){this.devicePicker=new o({deviceList:this.deviceList,selectedDevice:this.selectedDevice}),this.$("#device-picker-container").html(this.devicePicker.render().el),this.listenTo(this.devicePicker,o.Events.CHANGE,this.onDeviceChanged)},renderTrainingLoadModal:function(){var e=new u({}),t=new f({view:e,showFooter:!1,customClasses:"modal-training-load",modalTitle:r.localize("TRAINING_LOAD")});t.render()},renderVO2Modal:function(){var e=new a({}),t=new f({view:e,showFooter:!1,customClasses:"modal-ts-vo2-max",modalTitle:r.localize("ACTIVITY_VO2_MAX")});t.render()},onDeviceChanged:function(e){this.lastDisplayedDevice.set("value",e),this.lastDisplayedDevice.save(),this.selectedDevice=+e,this.displayData()},onTLHelpClicked:function(){this.renderTrainingLoadModal()},onVO2HelpClicked:function(){this.renderVO2Modal()},onDataFail:function(){var e={};e.displayNoStatus=!0,this.renderCurrentView(e)},selectDeviceToDisplay:function(){this.displayDevicePicker=c.shouldShowDevicePicker(this.statusData.recordedDevices.length),this.lastDisplayedDeviceId=+this.lastDisplayedDevice.get("value");if(this.displayDevicePicker){for(var e=0;e<this.statusData.recordedDevices.length;e++)this.lastDisplayedDeviceId===this.statusData.recordedDevices[e].deviceId&&(this.selectedDevice=this.statusData.recordedDevices[e].deviceId),this.deviceList.push(this.statusData.recordedDevices[e]);this.selectedDevice===null&&(this.selectedDevice=this.statusData.recordedDevices[0].deviceId)}else{for(var e=0;e<this.statusData.recordedDevices.length;e++)this.lastDisplayedDeviceId===this.statusData.recordedDevices[e].deviceId&&(this.selectedDevice=this.statusData.recordedDevices[e].deviceId),this.deviceList.push(this.statusData.recordedDevices[e]);this.selectedDevice===null&&(this.selectedDevice=this.statusData.recordedDevices[0].deviceId)}}});return m}),define("text!templates/report/TrainingStatusModalView.html",[],function(){return'\n<h5><%= Localizer.localize(\'TRAINING_STATUS_DESCRIPTION\') %></h5>\n\n\n<table class="table table-striped">\n    <tbody>\n    <tr>\n        <td>\n            <div class="training-status training-status-peaking">\n                <div class="training-status-symbol"></div>\n            </div>\n        </td>\n        <td><h6 class="bottom-none"><%= Localizer.localize(\'TRAINING_STATUS_PEAKING\') %></h6>\n            <%= Localizer.localize(\'TRAINING_STATUS_PEAKING_DESCRIPTION\') %>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div class="training-status training-status-productive">\n                <div class="training-status-symbol"></div>\n            </div>\n        </td>\n        <td><h6 class="bottom-none"><%= Localizer.localize(\'TRAINING_STATUS_PRODUCTIVE\') %></h6>\n            <%= Localizer.localize(\'TRAINING_STATUS_PRODUCTIVE_DESCRIPTION\') %>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div class="training-status training-status-maintaining">\n                <div class="training-status-symbol"></div>\n            </div>\n        </td>\n        <td><h6 class="bottom-none"><%= Localizer.localize(\'TRAINING_STATUS_MAINTAINING\') %></h6>\n            <%= Localizer.localize(\'TRAINING_STATUS_MAINTAINING_DESCRIPTION\') %>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div class="training-status training-status-recovery">\n                <div class="training-status-symbol"></div>\n            </div>\n        </td>\n        <td><h6 class="bottom-none"><%= Localizer.localize(\'TRAINING_STATUS_RECOVERY\') %></h6>\n            <%= Localizer.localize(\'TRAINING_STATUS_RECOVERY_DESCRIPTION\') %>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div class="training-status training-status-unproductive">\n                <div class="training-status-symbol"></div>\n            </div>\n        </td>\n        <td><h6 class="bottom-none"><%= Localizer.localize(\'TRAINING_STATUS_UNPRODUCTIVE\') %></h6>\n            <%= Localizer.localize(\'TRAINING_STATUS_UNPRODUCTIVE_DESCRIPTION\') %>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div class="training-status training-status-detraining">\n                <div class="training-status-symbol"></div>\n            </div>\n        </td>\n        <td><h6 class="bottom-none"><%= Localizer.localize(\'TRAINING_STATUS_DETRAINING\') %></h6>\n            <%= Localizer.localize(\'TRAINING_STATUS_DETRAINING_DESCRIPTION\') %>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div class="training-status training-status-overreaching">\n                <div class="training-status-symbol"></div>\n            </div>\n        </td>\n        <td><h6 class="bottom-none"><%= Localizer.localize(\'TRAINING_STATUS_OVERREACHING\') %></h6>\n            <%= Localizer.localize(\'TRAINING_STATUS_OVERREACHING_DESCRIPTION\') %>\n        </td>\n    </tr>\n    </tbody>\n</table>\n<% if (isWidget) { %>\n    <div class="fine-print">\n        <%= Localizer.localize(\'TRAINING_STATUS_LEGAL\') %>\n    </div>\n<% } %>\n'}),define("views/report/TrainingStatusModalView",["require","underscore","backbone","localizer","text!templates/report/TrainingStatusModalView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("text!templates/report/TrainingStatusModalView.html"),s=n.View.extend({template:t.template(i),initialize:function(e){this.isWidget=e.isWidget},render:function(){this.$el.html(this.template({Localizer:r,isWidget:this.isWidget}))}});return s}),define("text!templates/report/TrainingStatusReportCurrentView.html",[],function(){return'<% if (displayNone) { %>\n\n<% } else if (displayNoStatus) { %>\n    <div class="row-fluid bottom-s">\n        <div class="span12">\n            <h5><%= Localizer.localize(\'TRAINING_STATUS_NO_STATUS_DESCRIPTION\') %></h5>\n        </div>\n    </div>\n<% } else { %>\n    <div class="row-fluid">\n        <div class="span6">\n            <div class="training-status <%=statusClass%> pull-left">\n                <div class="training-status-symbol"></div>\n            </div>\n            <div class="data-block medium pull-left">\n                <div class="data-bit"><%=statusName%></div>\n                <div class="data-label"><%=Localizer.localize(\'TRAINING_STATUS_CURRENT_STATUS\') %> <a title="<%=Localizer.localize(\'learn_more\')%>" href="#modal-training-status-page" data-toggle="modal" id="ts-help-icon" class="help-icon ts-modal-help"><span class="icon-help"></span></a></div>\n            </div>\n        </div>\n        <div class="span3">\n            <div class="data-block medium">\n                <div class="data-bit"><%= trainingLoad %> <span data-placement="right" class="training-load-indicator has-tooltip <%= loadStatus.class %>" title="<%= loadStatus.tooltip %>"></span></div>\n                <div class="data-label"><%=Localizer.localize(\'TRAINING_LOAD\') %> <a title="<%=Localizer.localize(\'learn_more\')%>" href="#modal-training-load" data-toggle="modal" class="help-icon tl-help"><span class="icon-help"></span></a></div>\n            </div>\n        </div>\n        <div class="span3">\n            <div class="data-block medium">\n                <div class="data-bit"><%= vo2Max %></div>\n                <div class="data-label"><%=useCycling ? Localizer.localize(\'ACTIVITY_VO2_MAX_CYCLING_LABEL\') : Localizer.localize(\'ACTIVITY_VO2_MAX\') %> <a title="<%=Localizer.localize(\'learn_more\')%>" href="#modal-ts-vo2-max" data-toggle="modal" class="help-icon vo2-help"><span class="icon-help"></span></a></div>\n            </div>\n        </div>\n    </div>\n    <div class="row bottom-s">\n        <div class="span12">\n            <h5><%= statusDescription %></h5>\n        </div>\n    </div>\n<% } %>'}),define("views/report/TrainingStatusReportHeaderView",["require","underscore","backbone","localizer","models/user/UserPreference","models/vo2max/Vo2MaxMetrics","views/report/TrainingStatusDevicePickerView","views/report/TrainingStatusModalView","views/report/TrainingLoadModalView","views/report/VO2HelpModalView","views/main/Modal/ModalPopupView","utils/ModelSynchronizer","utils/TrainingStatusUtil","utils/date/DateParser","utils/date/DateFormatter","utils/ToolTipUtil","text!templates/report/TrainingStatusReportCurrentView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("models/user/UserPreference"),s=e("models/vo2max/Vo2MaxMetrics"),o=e("views/report/TrainingStatusDevicePickerView"),u=e("views/report/TrainingStatusModalView"),a=e("views/report/TrainingLoadModalView"),f=e("views/report/VO2HelpModalView"),l=e("views/main/Modal/ModalPopupView"),c=e("utils/ModelSynchronizer"),h=e("utils/TrainingStatusUtil"),p=e("utils/date/DateParser"),d=e("utils/date/DateFormatter"),v=e("utils/ToolTipUtil"),m=e("text!templates/report/TrainingStatusReportCurrentView.html"),g=n.View.extend({events:{"click #ts-help-icon":"onTSHelpClicked","click .tl-help":"onTLHelpClicked","click .vo2-help":"onVO2HelpClicked"},initialize:function(e){return this.trainingStatusData=e.metricList,this.template=t.template(m),this.selectedDevice=null,this.mostRecentStatus=null,this},render:function(){return this.getData(),this},getData:function(){this.vo2MaxData=new s({}),this.lastDisplayedDevice=new i({key:"TrainingStatus.last.device"});var e=new c;e.addModel({model:this.vo2MaxData,required:!0}),e.addModel({model:this.lastDisplayedDevice,required:!0}),e.on(c.Events.SYNCHRONIZED,this.onDataFetched,this),e.on(c.Events.SYNCHRONIZE_FAILED,this.onDataFail,this),e.fetchModels()},onDataFetched:function(){var e={};t.isEmpty(this.trainingStatusData.attributes.recordedDevices)?(e.displayNone=!0,this.renderCurrentView(e)):(this.statusData=this.trainingStatusData.attributes,this.selectDeviceToDisplay(),this.displayData())},displayData:function(){var e=this.getTemplateOptions();this.renderCurrentView(e)},getTemplateOptions:function(){var e={};return e.displayNoStatus=!1,e.displayNone=!1,this.mostRecentStatus=h.getStatusDataForDevice(this.selectedDevice,this.statusData),!this.mostRecentStatus&&!this.statusData.reportData[this.selectedDevice]?(e.displayNone=!0,e):!this.mostRecentStatus&&h.determineIfNoData(this.statusData.reportData[this.selectedDevice])?(e.displayNone=!0,e):this.mostRecentStatus?(this.trainingStatus=this.mostRecentStatus.trainingStatus,(this.trainingStatus===h.Statuses.No_Status||this.trainingStatus>7)&&!this.statusData.reportData[this.selectedDevice]?(e.displayNone=!0,e):(this.trainingStatus===h.Statuses.No_Status||this.trainingStatus>7)&&h.determineIfNoData(this.statusData.reportData[this.selectedDevice])?(e.displayNone=!0,e):(this.trainingStatus===h.Statuses.No_Status||this.trainingStatus>7?e.displayNoStatus=!0:(this.mostRecentStatus.sport==="CYCLING"?(e.vo2Max=this.vo2MaxData.get("cycling").vo2MaxValue,e.useCycling=!0):(e.vo2Max=this.vo2MaxData.get("generic").vo2MaxValue,e.useCycling=!1),e.trainingLoad=this.mostRecentStatus.weeklyTrainingLoad,e.loadMin=this.mostRecentStatus.loadTunnelMin,e.loadMax=this.mostRecentStatus.loadTunnelMax,e.statusClass=h.getStatusClass(this.trainingStatus),e.statusName=h.getStatusName(this.trainingStatus),e.statusDescription=h.getStatusDescription(this.trainingStatus),e.loadStatus=h.getLoadStatus(e.loadMin,e.loadMax,e.trainingLoad)),e)):(e.displayNoStatus=!0,e)},renderCurrentView:function(e){this.$el.html(this.template({Localizer:r,displayNone:e.displayNone,displayNoStatus:e.displayNoStatus,statusClass:e.statusClass,statusName:e.statusName,statusDescription:e.statusDescription,loadStatus:e.loadStatus,trainingLoad:e.trainingLoad,useCycling:e.useCycling,vo2Max:e.vo2Max})),v.renderTooltips.call(this)},renderTrainingStatusModal:function(){var e=new u({}),t=new l({view:e,showFooter:!1,customClasses:"modal-training-status",modalTitle:r.localize("TRAINING_STATUS")});t.render()},renderTrainingLoadModal:function(){var e=new a({}),t=new l({view:e,showFooter:!1,customClasses:"modal-training-load",modalTitle:r.localize("TRAINING_LOAD")});t.render()},renderVO2Modal:function(){var e=new f({}),t=new l({view:e,showFooter:!1,customClasses:"modal-ts-vo2-max",modalTitle:r.localize("ACTIVITY_VO2_MAX")});t.render()},onDeviceChanged:function(e){this.lastDisplayedDevice.set("value",e),this.lastDisplayedDevice.save(),this.selectedDevice=+e,this.displayData()},onTSHelpClicked:function(){this.renderTrainingStatusModal()},onTLHelpClicked:function(){this.renderTrainingLoadModal()},onVO2HelpClicked:function(){this.renderVO2Modal()},onDataFail:function(){this.$el.html(this.template({Localizer:r,displayNoStatus:!0}));return},selectDeviceToDisplay:function(){this.displayDevicePicker=h.shouldShowDevicePicker(this.statusData.recordedDevices.length,this.chartFormat),this.lastDisplayedDeviceId=+this.lastDisplayedDevice.get("value");for(var e=0;e<this.statusData.recordedDevices.length;e++)this.lastDisplayedDeviceId===this.statusData.recordedDevices[e].deviceId&&(this.selectedDevice=this.statusData.recordedDevices[e].deviceId);this.selectedDevice===null&&(this.selectedDevice=this.statusData.recordedDevices[0].deviceId)}});return g}),define("models/reports/TrainingStatuses",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({url:function(){return"/proxy/metrics-service/metrics/trainingstatus/"+this.metricPeriod+"/"+this.displayName+"?fromCalendarDate="+this.startDate+"&toCalendarDate="+this.endDate},initialize:function(e){this.metricPeriod=e.metricPeriod,this.displayName=e.displayName,this.startDate=e.startDate,this.endDate=e.endDate},setDisplayName:function(e){this.displayName=e}});return n}),define("views/report/TrainingStatusChartView",["require","underscore","backbone","localizer","utils/TrainingStatusUtil","utils/MainNavUtil","pages/activity_details_2/views/charts/ChartColorMapper"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/TrainingStatusUtil"),s=e("utils/MainNavUtil"),o=e("pages/activity_details_2/views/charts/ChartColorMapper"),u={ShowPlotLine:"ShowPlotLine"},a=n.View.extend({className:"ts-chart",events:{mousemove:"onMouseMove"},initialize:function(e){this.data=e.data,this.userPreferences=e.userPreferences,this.metricPeriod=e.metricPeriod,this.categories=e.categories,this.plotLineId="ts-plotline",this.plotLineVisible=!1,e.options?this.options=t.extend({},this.getDefaultOptions(),e.options):this.options=t.extend({},this.getDefaultOptions()),s.setExpandCollapseHandler(this.expandCollapseHandler.bind(this),20);var n;return $(window).resize(function(){clearTimeout(n),n=setTimeout(function(){this.resizeTrainingStatusChart()},500)}),this},render:function(){return this.highChartObj=new Highcharts.Chart(this.options),this},destroy:function(){this.unbindResizeTrainingStatusChart(),this.remove()},getDefaultOptions:function(){var e,t;this.metricPeriod==="weekly"?(e=7,t=1):this.metricPeriod==="monthly"?(e=4,t=7):(e=2,t=14);var n={chart:{type:"line",height:115,width:$("#training-status-container").outerWidth()-42,renderTo:this.$el.get(0)},title:{text:null},xAxis:{alternateGridColor:"#F6F6F6",labels:{enabled:!0,step:e},tickInterval:t,lineColor:"#969696",tickLength:0,categories:this.categories,opposite:!0},yAxis:{categories:[""],labels:{enabled:!0},title:{text:r.localize("trainingEffect.help.status")},gridLineColor:"#969696",gridLineWidth:1,offset:41},plotOptions:{series:{states:{hover:{enabled:!1}}}},tooltip:{headerFormat:'<b style="color:white; font-size: 12px;">{point.x}</b><br>',pointFormat:'<span style="color:{point.color};"></span> {series.name}',backgroundColor:"rgba(0,0,0,0.85)",shape:"square",borderWidth:0,style:{color:"white"},positioner:function(e,t,n){var r={x:n.plotX,y:n.plotY};return r.x-=e/2,r.x<0&&(r.x=n.plotX+(e+80)/2),r}},legend:{enabled:!1},series:[{name:r.localize("TRAINING_STATUS_DETRAINING"),color:o.Colors.grey,data:this.buildSeriesData(1),lineWidth:22,marker:{enabled:!0,symbol:"square",radius:11},linecap:"square"},{name:r.localize("TRAINING_STATUS_UNPRODUCTIVE"),color:o.Colors.orange,data:this.buildSeriesData(2),lineWidth:22,marker:{enabled:!0,symbol:"square",radius:11},linecap:"square"},{name:r.localize("TRAINING_STATUS_OVERREACHING"),color:o.Colors.red,data:this.buildSeriesData(3),lineWidth:22,marker:{enabled:!0,symbol:"square",radius:11},linecap:"square"},{name:r.localize("TRAINING_STATUS_MAINTAINING"),color:o.Colors.hatorade,data:this.buildSeriesData(4),lineWidth:22,marker:{enabled:!0,symbol:"square",radius:11},linecap:"square"},{name:r.localize("TRAINING_STATUS_RECOVERY"),color:o.Colors.skyBlue,data:this.buildSeriesData(5),lineWidth:22,marker:{enabled:!0,symbol:"square",radius:11},linecap:"square"},{name:r.localize("TRAINING_STATUS_PEAKING"),color:o.Colors.purple,data:this.buildSeriesData(6),lineWidth:22,marker:{enabled:!0,symbol:"square",radius:11},linecap:"square"},{name:r.localize("TRAINING_STATUS_PRODUCTIVE"),color:o.Colors.green,data:this.buildSeriesData(7),lineWidth:22,marker:{enabled:!0,symbol:"square",radius:11},linecap:"square"}],credits:{enabled:!1},exporting:{enabled:!1}};return n},buildSeriesData:function(e){var t,n=[],r,s=0;n.push([0,null]);for(t=0;t<this.data.length;t++)r=i.addMetricToDataset(this.data[t].calendarDate,this.categories,this.userPreferences),this.data[t].trainingStatus===e?(t!==0&&r-s!==1&&n.push([s+1,null]),n.push([r,0])):n.push([r,null]),s=r;return n.push([this.categories.length-1,null]),n},onMouseMove:function(e){e=this.highChartObj.pointer.normalize(e);var t=Math.round(this.highChartObj.xAxis[0].toValue(e.chartX)),n=t;this.xAxisAddPlotLine(n),this.trigger(u.ShowPlotLine,n)},xAxisAddPlotLine:function(e){this.plotLineVisible&&this.highChartObj.xAxis[0].removePlotLine(this.plotLineId),this.highChartObj.xAxis[0].addPlotLine({color:o.Colors.grey,value:e,width:1,id:"ts-plotline",zIndex:1}),this.plotLineVisible=!0},expandCollapseHandler:function(){this.resizeTrainingStatusChart(),this.reflowTrainingStatusChart()},reflowTrainingStatusChart:function(){this.highChartObj&&this.highChartObj.reflow()},resizeTrainingStatusChart:function(){$(".highcharts-container").css("width",$("#training-status-container").outerWidth()-12)},unbindResizeTrainingStatusChart:function(){$(window).off("resize:resizeTrainingStatusChart")}});return a.Events=u,a}),define("text!templates/report/TrainingStatusReportView.html",[],function(){return'<% if (noData) { %>\n    <div class="center-y-parent empty-state">\n        <div class="h4 center-y-child bottom-none"><%= Localizer.localize(\'TRAINING_STATUS_NO_STATUS_DESCRIPTION\') %></div>\n    </div>\n<% } else { %>\n    <div id="training-status-container"></div>\n    <div id="training-load-container"></div>\n    <div id="vo2-max-container"></div>\n<% } %>\n\n<div class="top-m clearfix">\n\n<% if (displayDevicePicker) { %>\n    <div class="pull-left">\n\n        <div id="device-picker-container" class="text-center"></div>\n\n    </div>\n<% } %>\n<% if (!noData) { %>\n    <div class="pull-right fine-print report-disclaimer"><%= metricPeriod === \'weekly\' ? Localizer.localize(\'TRAINING_STATUS_REPORT_DAILY_DISCLOSURE\') : Localizer.localize(\'TRAINING_STATUS_REPORT_WEEKLY_DISCLOSURE\') %></div>\n<% } %>\n</div>\n<% if (!noData) { %>\n    <div class="top-m fine-print">\n        <%= Localizer.localize(\'TRAINING_STATUS_LEGAL\') %>\n    </div>\n<% } %>'}),define("views/report/TrainingLoadChartView",["require","underscore","backbone","localizer","utils/TrainingStatusUtil","utils/MainNavUtil","pages/activity_details_2/views/charts/ChartColorMapper","text!templates/report/TrainingStatusReportView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/TrainingStatusUtil"),s=e("utils/MainNavUtil"),o=e("pages/activity_details_2/views/charts/ChartColorMapper"),u=e("text!templates/report/TrainingStatusReportView.html"),a={ShowPlotLine:"ShowPlotLine"},f=n.View.extend({className:"training-load-chart",events:{mousemove:"onMouseMove"},initialize:function(e){this.data=e.data,this.userPreferences=e.userPreferences,this.metricPeriod=e.metricPeriod,this.categories=e.categories,this.plotLineId="tl-plotline",this.plotLineVisible=!1,e.options?this.options=t.extend({},this.getDefaultOptions(),e.options):this.options=t.extend({},this.getDefaultOptions()),s.setExpandCollapseHandler(this.expandCollapseHandler.bind(this),20);var n;return $(window).resize(function(){clearTimeout(n),n=setTimeout(function(){this.resizeTrainingLoadChart()},500)}),this},render:function(){return this.highChartObj=new Highcharts.Chart(this.options),this},destroy:function(){this.unbindResizeTrainingLoadChart(),this.remove()},getDefaultOptions:function(){var e,n;this.metricPeriod==="weekly"?(e=7,n=1):this.metricPeriod==="monthly"?(e=4,n=7):(e=2,n=14);var i={chart:{height:200,width:$("#training-load-container").outerWidth(),renderTo:this.$el.get(0)},title:{text:null},xAxis:{alternateGridColor:"#F6F6F6",labels:{enabled:!1,step:e},tickInterval:n,lineColor:"#969696",tickLength:0,categories:this.categories},yAxis:[{title:{text:r.localize("TRAINING_LOAD")},tickInterval:200,minorTickInterval:100,min:0,minRange:1e3,showFirstLabel:!1},{title:{text:null},tickInterval:200,minorTickInterval:100,min:0,minRange:1e3,showFirstLabel:!1,opposite:!0,linkedTo:0}],tooltip:{shared:!0,formatter:t.partial(this.tooltipFormatter,this),backgroundColor:"rgba(0,0,0,0.85)",borderWidth:0,style:{color:"white"},positioner:function(e,t,n){var r={x:n.plotX,y:n.plotY};return r.x-=e/2+5,r.x<0&&(r.x=n.plotX+(e+80)/2),r.y=35,r}},legend:{enabled:!1},series:[{name:r.localize("TRAINING_LOAD"),data:this.buildSeries(0),type:"spline",zIndex:1,color:"#000",marker:{enabled:this.enableMarkers(this.data)},states:{hover:{lineWidth:2}}},{name:r.localize("TRAINING_LOAD_OPTIMAL"),data:this.buildSeries(1),type:"arearange",lineWidth:0,linkedTo:":previous",color:"rgba(114,234,36,0.9)",fillOpacity:.3,zIndex:0,states:{hover:{enabled:!1}}}],credits:{enabled:!1},exporting:{enabled:!1}};return i},buildSeries:function(e){var t,n=[],r;n.push([0,null]);if(e)for(t=0;t<this.data.length;t++)r=i.addMetricToDataset(this.data[t].calendarDate,this.categories,this.userPreferences),n.push([r,this.data[t].loadTunnelMin,this.data[t].loadTunnelMax]);else for(t=0;t<this.data.length;t++)r=i.addMetricToDataset(this.data[t].calendarDate,this.categories,this.userPreferences),n.push([r,this.data[t].weeklyTrainingLoad]);return n.push([this.categories.length-1,null]),n},enableMarkers:function(e){return e&&e.length===1},onMouseMove:function(e){e=this.highChartObj.pointer.normalize(e);var t=Math.round(this.highChartObj.xAxis[0].toValue(e.chartX)),n=t;this.xAxisAddPlotLine(n),this.trigger(a.ShowPlotLine,n)},xAxisAddPlotLine:function(e){this.plotLineVisible&&this.highChartObj.xAxis[0].removePlotLine(this.plotLineId),this.highChartObj.xAxis[0].addPlotLine({color:o.Colors.grey,value:e,width:1,id:this.plotLineId,zIndex:1}),this.plotLineVisible=!0},tooltipFormatter:function(){var e="<b>"+this.points[0].series.name+"</b><br>",t,n,i;return t=this.y,n=this.points[1].point.low,i=this.points[1].point.high,t>i?e+='<span style="color:#ff0035;"></span> '+r.localize("TRAINING_LOAD_HIGH")+": "+t:t<n?e+='<span style="color:#11a9ed;"></span> '+r.localize("TRAINING_LOAD_LOW")+": "+t:e+='<span style="color:#72ea24;"></span> '+r.localize("TRAINING_LOAD_OPTIMAL")+": "+t,e},expandCollapseHandler:function(){this.resizeTrainingLoadChart(),this.reflowTrainingLoadChart()},reflowTrainingLoadChart:function(){this.highChartObj&&this.highChartObj.reflow()},resizeTrainingLoadChart:function(){$(".highcharts-container").css("width",$("#training-load-container").outerWidth()-12)},unbindResizeTrainingLoadChart:function(){$(window).off("resize:resizeTrainingLoadChart")}});return f.Events=a,f}),define("utils/Vo2MaxCategoryTypes",["require","localizer"],function(e){var t=e("localizer"),n={categoriesMapper:function(){return{2:{color:"#c84b4b",type:"poor",name:t.localize("poor")},3:{color:"#e69637",type:"fair",name:t.localize("fair")},4:{color:"#64af5a",type:"good",name:t.localize("good")},5:{color:"#328cb4",type:"excellent",name:t.localize("excellent")},6:{color:"#735596",type:"superior",name:t.localize("superior")}}}};return n}),define("utils/Vo2MaxPercentileScore",["require"],function(e){var t={MALE:{"Under 20":[55.4,51.1,45.4,41.7],"20-29":[55.4,51.1,45.4,41.7],"30-39":[54,48.3,44,40.5],"40-49":[52.5,46.4,42.4,38.5],"50-59":[48.9,43.4,39.2,35.6],"60-69":[45.7,39.5,35.5,32.3],"70-79":[42.1,36.7,32.3,29.4],"80+":[42.1,36.7,32.3,29.4]},FEMALE:{"Under 20":[49.6,43.9,39.5,36.1],"20-29":[49.6,43.9,39.5,36.1],"30-39":[47.4,42.4,37.8,34.4],"40-49":[45.3,39.7,36.3,33],"50-59":[41.1,36.7,33,30.1],"60-69":[37.8,33,30,27.5],"70-79":[36.7,30.9,28.1,25.9],"80+":[36.7,30.9,28.1,25.9]}},n=["superior","excellent","good","fair","poor"],r=["95","80","60","40","0-40"],i={getScoreData:function(e,n,r){return this.mapToScore(t[e][n],r)},mapToScore:function(e,t){var n=e.length,r={group:e};t>=e[0]&&(r.scoreIndex=0),t<e[n-1]&&(r.scoreIndex=n);for(var i=0;i<n;i++)t<e[i]&&t>=e[i+1]&&(r.scoreIndex=i+1);return r},getScoreNames:function(){return n},getScorePercentiles:function(){return r}};return i}),define("utils/Vo2MaxAgeRangeMapper",["require"],function(e){var t={getAgeRange:function(e){return e<20?"Under 20":e<30?"20-29":e<40?"30-39":e<50?"40-49":e<60?"50-59":e<70?"60-69":e<80?"70-79":"80+"}};return t}),define("views/report/Vo2MaxTrainingStatusView",["require","underscore","backbone","localizer","personalizer","moment","models/user/ViewerUserBiometrics","utils/TrainingStatusUtil","utils/Vo2MaxCategoryTypes","utils/Vo2MaxPercentileScore","utils/Vo2MaxAgeRangeMapper","utils/MainNavUtil","pages/activity_details_2/views/charts/ChartColorMapper","text!templates/report/TrainingStatusReportView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("personalizer"),s=e("moment"),o=e("models/user/ViewerUserBiometrics"),u=e("utils/TrainingStatusUtil"),a=e("utils/Vo2MaxCategoryTypes"),f=e("utils/Vo2MaxPercentileScore"),l=e("utils/Vo2MaxAgeRangeMapper"),c=e("utils/MainNavUtil"),h=e("pages/activity_details_2/views/charts/ChartColorMapper"),p=e("text!templates/report/TrainingStatusReportView.html"),d={ShowPlotLine:"ShowPlotLine"},v=n.View.extend({className:"vo2-max-chart",events:{mousemove:"onMouseMove"},initialize:function(e){this.data=e.data,this.reportType=e.reportType,this.userPreferences=e.userPreferences,this.metricPeriod=e.metricPeriod,this.startDate=e.startDate,this.untilDate=e.untilDate,this.categories=e.categories,this.plotLineId="vo2-max-plotline",this.plotLineVisible=!1,e.options?this.options=t.extend({},this.getDefaultOptions(),e.options):this.options=t.extend({},this.getDefaultOptions()),c.setExpandCollapseHandler(this.expandCollapseHandler.bind(this),20);var n;return $(window).resize(function(){clearTimeout(n),n=setTimeout(function(){this.resizeVO2TrainingStatusChart()},500)}),this},render:function(){return this.highChartObj=new Highcharts.Chart(this.options),this},destroy:function(){this.unbindResizeVO2TrainingStatusChart(),this.remove()},getDefaultOptions:function(){var e,n;this.metricPeriod==="weekly"?(e=7,n=1):this.metricPeriod==="monthly"?(e=4,n=7):(e=2,n=14);var i={chart:{type:"spline",height:200,width:$("#vo2-max-container").outerWidth()-12,renderTo:this.$el.get(0)},title:!1,xAxis:{alternateGridColor:"#F6F6F6",labels:{enabled:!0,step:e},tickInterval:n,lineColor:"#969696",tickLength:0,categories:this.categories},yAxis:[{title:{text:r.localize("ACTIVITY_VO2_MAX"),margin:22},tickInterval:5,minRange:15},{title:{text:null},tickInterval:5,minRange:15,opposite:!0,linkedTo:0}],tooltip:{headerFormat:"<b>{series.name}</b><br>",formatter:t.partial(this.tooltipFormatter,this),backgroundColor:"rgba(0,0,0,0.85)",borderWidth:0,shape:"square",style:{color:"white"},positioner:function(e,t,n){var r={x:n.plotX,y:n.plotY};return r.x-=e/2+30,r.x<0&&(r.x=n.plotX+(e+60)/2),r.y=35,r}},legend:{enabled:!1},series:[{name:r.localize("label_vo2_max_running"),color:"#80ea40",data:this.buildSeries(this.data.ACTIVITY_VO2_MAX),marker:{enabled:this.enableMarkers(this.data.ACTIVITY_VO2_MAX)}},{name:r.localize("label_vo2_max_cycling"),color:h.Colors.blue,data:this.buildSeries(this.data.ACTIVITY_VO2_MAX_CYCLING),marker:{enabled:this.enableMarkers(this.data.ACTIVITY_VO2_MAX_CYCLING)}}],credits:{enabled:!1},exporting:{enabled:!1}};return i},buildSeries:function(e){var t,n=[],r;n.push([0,null]);if(!e)return null;for(t=0;t<e.length;t++)this.metricPeriod==="weekly"?r=u.addMetricToDataset(e[t].calendarDate,this.categories,this.userPreferences):!s(e[t].startDateOfWeek).isBefore(this.startDate)&&!s(e[t].startDateOfWeek).isAfter(this.untilDate)?r=u.addMetricToDataset(e[t].startDateOfWeek,this.categories,this.userPreferences):r=null,r&&n.push([r,e[t].value]);return n.push([this.categories.length-1,null]),n},enableMarkers:function(e){return e&&e.length===1},onMouseMove:function(e){e=this.highChartObj.pointer.normalize(e);var t=Math.round(this.highChartObj.xAxis[0].toValue(e.chartX)),n=t;this.xAxisAddPlotLine(n),this.trigger(d.ShowPlotLine,n)},xAxisAddPlotLine:function(e){this.plotLineVisible&&this.highChartObj.xAxis[0].removePlotLine(this.plotLineId),this.highChartObj.xAxis[0].addPlotLine({color:h.Colors.grey,value:e,width:1,id:this.plotLineId,zIndex:1}),this.plotLineVisible=!0},tooltipFormatter:function(){var e=i.calculateAge(o.get("birthDate")),t="<b>"+this.series.name+"</b><br>",n=this.y,s={};s.gender=o.get("gender")||"MALE",s.ageRange=o.get("birthDate")?l.getAgeRange(e):"40-49";var u=f.getScoreData(s.gender,s.ageRange,n);return n>u.group[0]?t+=r.localize("superior")+": "+n+" "+r.localize("vo2Max_unit"):n>=u.group[1]&&n<u.group[0]?t+=r.localize("excellent")+": "+n+" "+r.localize("vo2Max_unit"):n>=u.group[2]&&n<u.group[1]?t+=r.localize("good")+": "+n+" "+r.localize("vo2Max_unit"):n>=u.group[3]&&n<u.group[2]?t+=r.localize("fair")+": "+n+" "+r.localize("vo2Max_unit"):t+=r.localize("poor")+": "+n+" "+r.localize("vo2Max_unit"),t},expandCollapseHandler:function(){this.resizeVO2TrainingStatusChart(),this.reflowVO2TrainingStatusChart()},reflowVO2TrainingStatusChart:function(){this.highChartObj&&this.highChartObj.reflow()},resizeVO2TrainingStatusChart:function(){$(".highcharts-container").css("width",$("#vo2-max-container").outerWidth()-12)},unbindResizeVO2TrainingStatusChart:function(){$(window).off("resize:resizeVO2TrainingStatusChart")}});return v.Events=d,v}),define("views/report/TrainingStatusReportView",["require","underscore","backbone","personalizer","localizer","models/user/UserPreference","utils/ModelSynchronizer","models/reports/TrainingStatuses","views/report/TrainingStatusChartView","views/report/TrainingLoadChartView","views/report/Vo2MaxTrainingStatusView","views/report/TrainingStatusDevicePickerView","utils/TrainingStatusUtil","utils/ReportChartUtil","pages/activity_details_2/views/charts/ChartColorMapper","text!templates/report/TrainingStatusReportView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("personalizer"),i=e("localizer"),s=e("models/user/UserPreference"),o=e("utils/ModelSynchronizer"),u=e("models/reports/TrainingStatuses"),a=e("views/report/TrainingStatusChartView"),f=e("views/report/TrainingLoadChartView"),l=e("views/report/Vo2MaxTrainingStatusView"),c=e("views/report/TrainingStatusDevicePickerView"),h=e("utils/TrainingStatusUtil"),p=e("utils/ReportChartUtil"),d=e("pages/activity_details_2/views/charts/ChartColorMapper"),v=e("text!templates/report/TrainingStatusReportView.html"),m={SELECTED_DEVICE_CHANGE:"SELECTED_DEVICE_CHANGE"},g=n.View.extend({className:"block-repeat",initialize:function(e){this.template=t.template(v),this.report=e.report,this.reportType=e.reportType,this.metricList=e.metricList,this.vo2MaxData=e.vo2MaxData,this.metricPeriod=e.metricPeriod,this.userPreferences=e.userPreferences,this.startDate=e.startDate,this.untilDate=e.untilDate,this.daysInRange=-28,this.displayDevicePicker=!1,this.deviceList=[],this.lastDisplayedDevice=null,this.selectedDevice=null,this.noData=null},render:function(){return this.getData(),this},getData:function(){this.lastDisplayedDevice=new s({key:"TrainingStatus.last.device"});var e=new o;e.addModel({model:this.lastDisplayedDevice,required:!0}),e.on(o.Events.SYNCHRONIZED,this.onDataFetched,this),e.on(o.Events.SYNCHRONIZE_FAILED,this.onDataFail,this),e.fetchModels()},onDataFetched:function(){this.statusData=this.metricList.attributes,this.getXAxisCategories(),this.selectDeviceToDisplay(),this.displayReport()},onDataFail:function(){this.statusData=this.metricList.attributes,this.getXAxisCategories(),this.selectDeviceToDisplay(),this.displayReport()},getXAxisCategories:function(){var e=Math.ceil((Date.parse(this.untilDate)-Date.parse(this.startDate))/864e5);this.daysInRange=0-e;switch(this.metricPeriod){case"weekly":this.getRangeCategories();break;case"monthly":e>180?(this.metricPeriod="yearly",this.getRangeCategories()):this.getRangeCategories()}},selectDeviceToDisplay:function(){if(t.isEmpty(this.statusData.recordedDevices)){this.noData=!0,this.displayDevicePicker=!1;return}this.displayDevicePicker=this.statusData.recordedDevices.length>1;if(this.displayDevicePicker){this.lastDisplayedDevice&&(this.lastDisplayedDeviceId=+this.lastDisplayedDevice.get("value"));for(var e=0;e<this.statusData.recordedDevices.length;e++)this.lastDisplayedDeviceId===this.statusData.recordedDevices[e].deviceId&&(this.selectedDevice=this.statusData.recordedDevices[e].deviceId),this.deviceList.push(this.statusData.recordedDevices[e]);t.isNull(this.selectedDevice)&&(this.selectedDevice=this.statusData.recordedDevices[0].deviceId)}else this.selectedDevice=this.statusData.recordedDevices[0].deviceId},displayReport:function(){t.isNull(this.selectedDevice)||(this.noData=h.determineIfNoData(this.statusData.reportData[this.selectedDevice])),this.$el.html(this.template({Localizer:i,displayDevicePicker:this.displayDevicePicker,metricPeriod:this.metricPeriod,noData:this.noData})),this.displayDevicePicker&&this.renderDevicePicker(),this.noData||this.renderCharts()},renderDevicePicker:function(){this.devicePicker=new c({deviceList:this.deviceList,selectedDevice:this.selectedDevice}),this.$("#device-picker-container").html(this.devicePicker.render().el),this.listenTo(this.devicePicker,c.Events.CHANGE,this.onDeviceChanged)},renderCharts:function(){this.deviceStatusData=this.statusData.reportData[this.selectedDevice],this.trainingStatusChartView=new a({data:this.deviceStatusData,metricPeriod:this.metricPeriod,categories:this.categories,userPreferences:this.userPreferences}),this.$("#training-status-container").html(this.trainingStatusChartView.render().el),this.trainingLoadChartView=new f({data:this.deviceStatusData,metricPeriod:this.metricPeriod,categories:this.categories,userPreferences:this.userPreferences}),this.$("#training-load-container").html(this.trainingLoadChartView.render().el),this.vo2MaxTrainingStatusView=new l({data:this.vo2MaxData,reportType:this.reportType,metricPeriod:this.metricPeriod,startDate:this.startDate,untilDate:this.untilDate,categories:this.categories,userPreferences:this.userPreferences}),this.$("#vo2-max-container").html(this.vo2MaxTrainingStatusView.render().el),this.listenTo(this.trainingStatusChartView,a.Events.ShowPlotLine,this.onShowPlotLine),this.listenTo(this.trainingLoadChartView,f.Events.ShowPlotLine,this.onShowPlotLine),this.listenTo(this.vo2MaxTrainingStatusView,l.Events.ShowPlotLine,this.onShowPlotLine)},onShowPlotLine:function(e){this.trainingStatusChartView.xAxisAddPlotLine(e),this.trainingLoadChartView.xAxisAddPlotLine(e),this.vo2MaxTrainingStatusView.xAxisAddPlotLine(e)},onDeviceChanged:function(e){this.lastDisplayedDevice.set("value",e),this.lastDisplayedDevice.save(),this.selectedDevice=+e,this.displayReport(),this.trigger(m.SELECTED_DEVICE_CHANGE,e)},getRangeCategories:function(){var e=this.untilDate.split("-");this.categories=[];for(var t=this.daysInRange;t<=0;t++){var n=new Date(e[0],e[1]-1,e[2],0,0,0);n.setHours(12),n.setMinutes(0),n.setMilliseconds(0),n.setDate(n.getDate()+t);var r=n.getDate().toString(),s=(n.getMonth()+1).toString(),o=this.userPreferences.get("dateFormat"),u="";o.formatKey==="mmddyyyy"||o.formatKey==="yyyymmdd"?u=i.localize("month.abbr."+(s>9?s:"0"+s))+" "+r:u=r+" "+i.localize("month.abbr."+(s>9?s:"0"+s)),this.categories.push(u)}}});return g.Events=m,g}),define("utils/Vo2MaxPercentileGroup",["require","localizer"],function(e){var t=e("localizer"),n={MALE:{"Under 20":[59.8,55.4,53.5,51.8,51.1,48.4,47.5,46.7,45.4,44.6,43.9,42.5,41.7,41,39.9,38.8,37.7,36.7,34.5,31.3,26.1],"20-29":[59.8,55.4,53.5,51.8,51.1,48.4,47.5,46.7,45.4,44.6,43.9,42.5,41.7,41,39.9,38.8,37.7,36.7,34.5,31.3,26.1],"30-39":[58.3,54,51.6,49.9,48.3,47,46,45.3,44,43.9,42.4,41.1,40.5,39.5,38.6,37.6,36.7,35.2,33.8,31.1,26.5],"40-49":[56.1,52.5,49.6,48.2,46.4,44.9,43.9,43.1,42.4,41,40.1,39.5,38.5,37.7,36.7,35.9,34.9,33.8,32.3,29.5,25.1],"50-59":[54,48.9,46.7,44.6,43.4,41.8,41,39.9,39.2,38.1,37.3,36.7,35.6,35,33.8,33,32.3,30.9,29.4,27,22.8],"60-69":[51.1,45.7,42.6,41,39.5,38.3,37.1,36.7,35.5,34.8,33.8,33,32.3,31.6,30.9,29.5,28.7,27.4,25.7,23.7,19.4],"70-79":[49.6,42.1,39.5,38.1,36.7,35.2,33.9,33.1,32.3,31.5,30.7,29.9,29.4,28.1,27.8,26.7,25.7,24.6,22.9,20.8,18.2],"80+":[49.6,42.1,39.5,38.1,36.7,35.2,33.9,33.1,32.3,31.5,30.7,29.9,29.4,28.1,27.8,26.7,25.7,24.6,22.9,20.8,18.2]},FEMALE:{"Under 20":[54.4,49.6,46.7,45.3,43.9,42.4,41,40.9,39.5,38.5,37.7,36.7,36.1,35.2,33.9,32.9,32.3,30.9,29.5,27,23.7],"20-29":[54.4,49.6,46.7,45.3,43.9,42.4,41,40.9,39.5,38.5,37.7,36.7,36.1,35.2,33.9,32.9,32.3,30.9,29.5,27,23.7],"30-39":[52.5,47.4,45.3,43.9,42.4,41,39.6,38.6,37.8,37.1,36.7,35.2,34.4,33.8,32.5,32.3,30.9,29.5,28,25.9,22.9],"40-49":[51.1,45.3,43.9,41.1,39.7,39.2,38.1,36.7,36.3,35.2,34.9,33.8,33,32.3,31.3,30.4,29.4,28.2,26.7,25.1,22.2],"50-59":[46,41.1,39.5,37.3,36.7,35.3,34.5,33.7,33,32.3,31.6,30.9,30.1,29.5,29,28,27,25.9,24.8,23,20.4],"60-69":[43.9,37.8,35.9,34.5,33,32.3,31.3,30.9,30,29.4,29.1,28.4,27.5,26.8,26.1,25.2,24.7,24,23,21.8,19.5],"70-79":[43.9,36.7,33,31.8,30.9,30,29.5,29.4,28.1,28,27.4,26.6,25.9,25.1,24.8,24.3,23.8,22.6,21.5,19.7,16.8],"80+":[43.9,36.7,33,31.8,30.9,30,29.5,29.4,28.1,28,27.4,26.6,25.9,25.1,24.8,24.3,23.8,22.6,21.5,19.7,16.8]}},r={getPercentileGroup:function(e,t,r){return this.mapToGroup(n[e][t],r)},mapToGroup:function(e,t){var n=e.length,r=5,i=10,s=11,o;if(t>=e[0])return o=1,this.getPercentileString(o,!0);if(t<e[n-1])return o=1,this.getPercentileString(o,!1);for(var u=0;u<n;u++)if(t<e[u]&&t>=e[u+1])return u+1===i?(o=50,this.getPercentileString(o,!0)):u+1===s?(o=50,this.getPercentileString(o,!1)):u+1>s?(o=50-(u+1-s)*r,this.getPercentileString(o,!1)):(o=(u+1)*r,this.getPercentileString(o,!0))},getPercentileString:function(e,n){return n?t.localize("vo2_max_top",e):t.localize("vo2_max_bottom",e)}};return r}),define("text!templates/report/vo2MaxDynamicTextView.html",[],function(){return"<!-- VO2 max modal -->\n<% if(modalText) { %>\n    <% if(reportType === 'cycling' || (reportType === 'all' && vo2MaxToggle === 'cycling')) { %>\n    <h1 class=\"h5\"><%~ Localizer.localize('vo2_max_compare_text_cycling', currentVo2Max, scoreName, pluralGender, ageRange) %></h1>\n    <% } else { %>\n    <h1 class=\"h5\"><%~ Localizer.localize('vo2_max_compare_text', currentVo2Max, scoreName, pluralGender, ageRange) %></h1>\n    <% } %>\n\n<!-- VO2 max reports widget -->\n<% } else if(chartFormat === 'widget') { %>\n    <% if(fitnessAge) { %>\n        <% if(reportType === 'running' || isOnlyCycling) { %>\n            <% if(fitnessAgeDescription === 'aboveNormal') { %>\n            <!--<p class=\"data-label\"><%~ Localizer.localize('vo2_max_fitness_age_above_normal_with_link', percentileGroup, url) %></p>-->\n            <p class=\"data-label\"><%~ Localizer.localize('vo2_max_fitness_age_above_normal', percentileGroup) %></p>\n            <% } else if(fitnessAgeDescription === 'belowNormal') { %>\n            <!--<p class=\"data-label\"><%~ Localizer.localize('vo2_max_fitness_age_below_normal_with_link', percentileGroup, url) %></p>-->\n            <p class=\"data-label\"><%~ Localizer.localize('vo2_max_fitness_age_below_normal', percentileGroup) %></p>\n            <% } else { %>\n            <!--<p class=\"data-label\"><%~ Localizer.localize('vo2_max_fitness_age_normal_with_link', fitnessAge, percentileGroup, url) %></p>-->\n            <p class=\"data-label\"><%~ Localizer.localize('vo2_max_fitness_age_normal', fitnessAge, percentileGroup) %></p>\n            <% } %>\n        <% } else { %>\n        <!--<p class=\"data-label\"><%~ Localizer.localize('vo2_max_percentile_group_with_link', percentileGroup, url) %></p>-->\n        <p class=\"data-label\"><%~ Localizer.localize('vo2_max_percentile_group', percentileGroup) %></p>\n        <% } %>\n    <% } else { %>\n    <!--<p class=\"data-label\"><%~ Localizer.localize('vo2_max_percentile_group_with_link', percentileGroup, url) %></p>-->\n    <p class=\"data-label\"><%~ Localizer.localize('vo2_max_percentile_group', percentileGroup) %></p>\n    <% } %>\n\n<!-- VO2 max reports page -->\n<% } else if(chartFormat === 'page') { %>\n\n    <% if(reportType === 'cycling' || (reportType === 'all' && vo2MaxToggle === 'cycling')) { %>\n    <p><%~ Localizer.localize('vo2_max_compare_text_cycling', currentVo2Max, scoreName, pluralGender, ageRange) %>\n    <% } else { %>\n    <p><%~ Localizer.localize('vo2_max_compare_text', currentVo2Max, scoreName, pluralGender, ageRange) %>\n    <% } %>\n\n    <% if(fitnessAge) { %>\n        <% if(reportType === 'running' || isOnlyCycling || (reportType === 'all' && vo2MaxToggle !== 'cycling')) { %>\n            <% if(fitnessAgeDescription === 'aboveNormal') { %>\n            <%~ Localizer.localize('vo2_max_fitness_age_above_normal', percentileGroup) %>\n            <% } else if(fitnessAgeDescription === 'belowNormal') { %>\n            <%~ Localizer.localize('vo2_max_fitness_age_below_normal', percentileGroup) %>\n            <% } else { %>\n            <%~ Localizer.localize('vo2_max_fitness_age_normal', fitnessAge, percentileGroup) %>\n            <% } %>\n        <% } else { %>\n        <%~ Localizer.localize('vo2_max_percentile_group', percentileGroup) %>\n        <% } %>\n    <% } else { %>\n    <%~ Localizer.localize('vo2_max_percentile_group', percentileGroup) %></p>\n    <% } %>\n\n    <!--<div class=\"text-center\">-->\n        <!--<a href=\"<%= url %>\" class=\"btn btn-small\"><%= Localizer.localize('vo2_max_compare_yourself') %></a>-->\n    <!--</div>-->\n<% } %>"}),define("views/report/Vo2MaxDynamicTextView",["require","underscore","backbone","localizer","utils/NavigationUtil","utils/Vo2MaxPercentileGroup","utils/Vo2MaxPercentileScore","text!templates/report/vo2MaxDynamicTextView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/NavigationUtil"),s=e("utils/Vo2MaxPercentileGroup"),o=e("utils/Vo2MaxPercentileScore"),u=e("text!templates/report/vo2MaxDynamicTextView.html"),a=n.View.extend({initialize:function(e){this.template=t.template(u),this.chartFormat=e.chartFormat,this.reportType=e.reportType,this.vo2MaxMetrics=e.vo2MaxMetrics,this.gender=e.gender,this.ageRange=e.ageRange,this.vo2MaxToggle=e.vo2MaxToggle,this.modalText=e.modalText||!1,this.setCurrentVo2Max(),this.setHasFitnessAge()},setCurrentVo2Max:function(){var e=this.vo2MaxMetrics.get("generic")?this.vo2MaxMetrics.get("generic").vo2MaxValue:null,t=this.vo2MaxMetrics.get("cycling")?this.vo2MaxMetrics.get("cycling").vo2MaxValue:null;this.currentVo2Max=e;if(this.reportType==="cycling"||this.reportType==="all"&&this.vo2MaxToggle==="cycling")this.currentVo2Max=t,e===null&&(this.isOnlyCycling=!0)},setHasFitnessAge:function(){var e=this.vo2MaxMetrics.get("generic")?this.vo2MaxMetrics.get("generic").fitnessAge:null,t=this.vo2MaxMetrics.get("cycling")?this.vo2MaxMetrics.get("cycling").fitnessAge:null;this.hasFitnessAge=!!e,this.reportType==="cycling"&&(this.hasFitnessAge=!!t)},render:function(){this.$el.html(this.template({Localizer:r,url:i.url("/insights"),chartFormat:this.chartFormat,reportType:this.reportType,modalText:this.modalText,isOnlyCycling:this.isOnlyCycling,ageRange:this.ageRange,vo2MaxToggle:this.vo2MaxToggle,currentVo2Max:Math.round(this.currentVo2Max),fitnessAge:this.hasFitnessAge?this.getFitnessAge():null,fitnessAgeDescription:this.hasFitnessAge?this.getFitnessAgeDescription():null,percentileGroup:this.getPercentileGroup(),scoreName:this.getScoreName(),pluralGender:this.getPluralGender()}))},getFitnessAgeDescription:function(){var e="normal",t=this.getFitnessAge();return t<=19&&(e="aboveNormal"),t>=80&&(e="belowNormal"),e},getFitnessAge:function(){var e=this.vo2MaxMetrics.get("generic")?this.vo2MaxMetrics.get("generic").fitnessAge:null,t=this.vo2MaxMetrics.get("cycling")?this.vo2MaxMetrics.get("cycling").fitnessAge:null,n,r;if(e&&!t)n=e,r=this.vo2MaxMetrics.get("generic").fitnessAgeDescription;else if(!e&&t)n=t,r=this.vo2MaxMetrics.get("cycling").fitnessAgeDescription;else{if(!e||!t)return;e<=t?(n=e,r=this.vo2MaxMetrics.get("generic").fitnessAgeDescription):(n=t,r=this.vo2MaxMetrics.get("cycling").fitnessAgeDescription)}return n-r},getPercentileGroup:function(){return s.getPercentileGroup(this.gender,this.ageRange,this.currentVo2Max)},getScoreName:function(){var e=o.getScoreData(this.gender,this.ageRange,this.currentVo2Max),t=o.getScoreNames(),n=r.localize(t[e.scoreIndex]).toLowerCase();return n},getPluralGender:function(){var e=this.gender==="MALE"?r.localize("men").toLowerCase():r.localize("women").toLowerCase();return e}});return a}),define("views/report/Vo2MaxGaugeChartView",["require","underscore","backbone","localizer","utils/Vo2MaxCategoryTypes","utils/ReportTypes","highcharts"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/Vo2MaxCategoryTypes"),s=e("utils/ReportTypes"),o=e("highcharts"),u=n.View.extend({initialize:function(e){if(!e.vo2MaxMetrics)throw"Current VO2 Max values are required for chart.";if(!e.gender)throw"Gender value required for chart.";if(!e.ageRange)throw"Age range value required for chart.";if(!e.vo2MaxCategories)throw"Category list required for chart";this.chartFormat=e.chartFormat,this.reportType=e.reportType,this.vo2MaxMetrics=e.vo2MaxMetrics,this.gender=e.gender,this.ageRange=e.ageRange,this.vo2MaxCategories=e.vo2MaxCategories,this.useStrictMinMax=e.useStrictMinMax,this.vo2MaxToggle=e.vo2MaxToggle,this.minValue=e.minValue||0,this.maxValue=e.maxValue||100,this.containerClass=this.chartFormat==="widget"?"reportChartPlaceholder":"js-report-chart-current",this.categoriesMapper=i.categoriesMapper(),this.setCurrentVo2Max(),this.setAttributes(),this.setChartRanges(),this.initExportData()},setCurrentVo2Max:function(){this.currentVo2Max=this.vo2MaxMetrics.get("generic").vo2MaxValue;if(this.reportType==="cycling"||this.reportType==="all"&&this.vo2MaxToggle==="cycling")this.currentVo2Max=this.vo2MaxMetrics.get("cycling").vo2MaxValue},setAttributes:function(){this.containerClass&&this.$el.addClass(this.containerClass)},setChartRanges:function(){this.useStrictMinMax||(this.minValue=this.vo2MaxCategories.getRangeMin(),this.maxValue=this.vo2MaxCategories.getRangeMax(),this.minValue>this.currentVo2Max&&(this.minValue=this.currentVo2Max),this.maxValue<this.currentVo2Max&&(this.maxValue=this.currentVo2Max))},initExportData:function(){this.exportData={title:r.localize(s.ACTIVITY_VO2_MAX),rows:[]}},addExportData:function(){this.exportData.rows.push({values:arguments})},getExportData:function(){return this.exportData},render:function(){this.addExportData(r.localize("vo2.max.my.title"),this.currentVo2Max),this.addExportData(r.localize("vo2.max.category.label"),r.localize("vo2.max.range.min.label"),r.localize("vo2.max.range.max.label")),this.buildSeries(),this.initializeChartSeries(),this.$el.highcharts(this.getChartOptions())},buildSeries:function(){this.series=[{name:r.localize("vo2.max.my.title"),data:[Math.round(this.currentVo2Max)]}]},initializeChartSeries:function(){var e=this.vo2MaxCategories.length,n,i,s,o,u,a,f;this.chartSeries={};for(var l=0;l<e;l++)n=this.vo2MaxCategories.models[l],i=this.categoriesMapper[n.get("categoryPk")],s=i.type,o=i.color,u=i.name,a=n.get("categoryRangeMin"),f=n.get("categoryRangeMax"),l===0&&a>this.currentVo2Max&&(a=this.currentVo2Max-3,this.minValue-=3),l===e-1&&f<this.currentVo2Max&&(f=this.currentVo2Max+3,this.maxValue+=3),this.chartSeries[s]={color:o,name:u,from:a,to:f,thickness:"30%"},this.addExportData([r.localize("vo2."+s),n.get("categoryRangeMin"),n.get("categoryRangeMax")]);this.chartSeries=t.toArray(this.chartSeries),this.chartSeries=t.sortBy(this.chartSeries,function(e){return-e.to},this)},getChartOptions:function(){var e={chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:!1,backgroundColor:"transparent",width:231,height:this.chartFormat==="widget"?170:198,marginTop:15,spacingTop:25,spacingBottom:5},credits:{enabled:!1},title:{text:Math.round(this.currentVo2Max)+"<br/><span class='data-label'>"+r.localize("vo2Max_unit")+"</span>",useHTML:!0,verticalAlign:"bottom",y:this.chartFormat==="widget"?-60:-77,style:{color:"#555",fontSize:"30px",lineHeight:"18px",textAlign:"center"}},exporting:{enabled:!1},tooltip:{enabled:!1},pane:{size:"100%",startAngle:-130,endAngle:130,background:{borderWidth:20,backgroundColor:"transparent",shape:"arc",borderColor:"transparent",outerRadius:"90%",innerRadius:"90%"}},plotOptions:{gauge:{borderWidth:20,radius:90,innerRadius:"90%",dataLabels:{borderWidth:0,useHTML:!0,color:"#222",y:70,x:0,enabled:!0,style:{fontSize:"18px"},formatter:function(){var e=this.series.chart.axes[1].plotLinesAndBands;for(var t=0;t<e.length;t++)if(e[t].options.name&&e[t].options.from<=this.y&&this.y<=e[t].options.to)return e[t].options.name}},dial:{baseLength:"20%",baseWidth:50,radius:"75%",rearLength:"0%",topWidth:0,backgroundColor:"#000",borderWidth:"1px",borderColor:"#fff"},pivot:{radius:this.chartFormat==="widget"?"22%":"24%",backgroundColor:"#fff"}}},yAxis:{min:this.minValue,max:this.maxValue,minorTickInterval:null,lineColor:"#fafafa",tickInterval:5,tickLength:0,tickPixelInterval:30,tickWidth:1,tickPosition:"inside",tickColor:"#fafafa",labels:{step:1,distance:7,rotation:"auto",style:{color:"#AAA",fontSize:"9px"}},plotBands:this.chartSeries},series:this.series};return e}});return u}),define("text!templates/report/vo2MaxChartView.html",[],function(){return'<div id="vo2MaxGaugeChartPlaceholder"></div>\n<div id="vo2MaxDynamicTextPlaceholder"></div>'}),define("views/report/Vo2MaxChartView",["require","underscore","backbone","views/report/Vo2MaxDynamicTextView","views/report/Vo2MaxGaugeChartView","text!templates/report/vo2MaxChartView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("views/report/Vo2MaxDynamicTextView"),i=e("views/report/Vo2MaxGaugeChartView"),s=e("text!templates/report/vo2MaxChartView.html"),o=n.View.extend({initialize:function(e){this.template=t.template(s),this.report=e.report,this.reportType=e.reportType,this.chartFormat=e.chartFormat,this.vo2MaxMetrics=e.vo2MaxMetrics,this.gender=e.gender,this.ageRange=e.ageRange,this.vo2MaxCategories=e.vo2MaxCategories,this.vo2MaxToggle=e.vo2MaxToggle,this.useStrictMinMax=!1},render:function(){this.$el.html(this.template({})),this.initGaugeChart(),this.chartFormat==="widget"&&this.initDynamicText()},initGaugeChart:function(){this.vo2MaxGaugeChartView=new i({el:this.$("#vo2MaxGaugeChartPlaceholder"),reportType:this.reportType,chartFormat:this.chartFormat,vo2MaxMetrics:this.vo2MaxMetrics,gender:this.gender,ageRange:this.ageRange,vo2MaxCategories:this.vo2MaxCategories,useStrictMinMax:this.useStrictMinMax,vo2MaxToggle:this.vo2MaxToggle}),this.vo2MaxGaugeChartView.render()},initDynamicText:function(){this.vo2MaxDynamicTextView=new r({el:this.$("#vo2MaxDynamicTextPlaceholder"),chartFormat:this.chartFormat,reportType:this.reportType,vo2MaxMetrics:this.vo2MaxMetrics,gender:this.gender,ageRange:this.ageRange,vo2MaxToggle:this.vo2MaxToggle}),this.vo2MaxDynamicTextView.render()},getExportData:function(){return this.vo2MaxGaugeChartView.getExportData()}});return o}),define("text!templates/report/vo2MaxModalView.html",[],function(){return"<div id=\"vo2MaxDynamicTextPlaceholder\"></div>\n\n<table class=\"vo2-estimates-table table table-bordered\">\n    <tbody>\n    <tr>\n        <th><% gender === 'MALE' ? print(Localizer.localize('vo2.males')) : print(Localizer.localize('vo2.females')); %></th>\n        <th><%= Localizer.localize('vo2.percentile') %></th>\n        <th><%= Localizer.localize('vo2Max_unit') %></th>\n    </tr>\n\n    <% for(var i = 0, length = scoreNames.length; i < length; i++) { %>\n    <tr>\n        <% if(i === 0) { %>\n        <td><span class=\"vo2-<%= scoreNames[i] %>\"></span><%= Localizer.localize(scoreNames[i]) %></td>\n        <td><%= scorePercentiles[i] %></td>\n        <td class=\"<% scoreData.scoreIndex === i ? print('highlight') : '' %>\"><%= scoreData.group[i] %> <%= Localizer.localize('vo2_max_and_up') %></td>\n\n        <% } else if(i === (length - 1)) { %>\n        <td><span class=\"vo2-<%= scoreNames[i] %>\"></span><%= Localizer.localize('vo2.poor') %></td>\n        <td><%= scorePercentiles[i] %></td>\n        <td class=\"<% scoreData.scoreIndex === i ? print('highlight') : '' %>\"><%= scoreData.group[i - 1] %> <%= Localizer.localize('vo2_max_and_below') %></td>\n\n        <% } else { %>\n        <td><span class=\"vo2-<%= scoreNames[i] %>\"></span><%= Localizer.localize(scoreNames[i]) %></td>\n        <td><%= scorePercentiles[i] %></td>\n        <td class=\"<% scoreData.scoreIndex === i ? print('highlight') : '' %>\"><%= scoreData.group[i] %> - <%= scoreData.group[i - 1] %></td>\n        <% } %>\n    </tr>\n    <% } %>\n    </tbody>\n</table>\n\n<p><%= Localizer.localize('vo2_max_modal_text_1') %></p>\n\n<% if(hasBoth) { %>\n<p><%= Localizer.localize('vo2_max_modal_text_2') %></p>\n<% } %>\n\n<p class=\"fine-print\"><%= Localizer.localize('vo2_max_modal_text_3') %> <a href=\"http://www.cooperinstitute.org\" target=\"_blank\">www.cooperinstitute.org</a></p>"}),define("views/report/Vo2MaxModalView",["require","underscore","backbone","localizer","utils/Vo2MaxPercentileScore","views/report/Vo2MaxDynamicTextView","text!templates/report/vo2MaxModalView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/Vo2MaxPercentileScore"),s=e("views/report/Vo2MaxDynamicTextView"),o=e("text!templates/report/vo2MaxModalView.html"),u=n.View.extend({initialize:function(e){this.template=t.template(o),this.chartFormat=e.chartFormat,this.reportType=e.reportType,this.vo2MaxMetrics=e.vo2MaxMetrics,this.gender=e.gender,this.ageRange=e.ageRange,this.vo2MaxToggle=e.vo2MaxToggle,this.setCurrentVo2Max()},setCurrentVo2Max:function(){var e=this.vo2MaxMetrics.get("generic")?this.vo2MaxMetrics.get("generic").vo2MaxValue:null,t=this.vo2MaxMetrics.get("cycling")?this.vo2MaxMetrics.get("cycling").vo2MaxValue:null;this.currentVo2Max=e;if(this.reportType==="cycling"||this.reportType==="all"&&this.vo2MaxToggle==="cycling")this.currentVo2Max=t;e!==null&&t!==null&&(this.hasBoth=!0)},render:function(){var e=i.getScorePercentiles(),t=i.getScoreData(this.gender,this.ageRange,this.currentVo2Max),n=i.getScoreNames();this.$el.html(this.template({Localizer:r,hasBoth:this.hasBoth,gender:this.gender,scorePercentiles:e,scoreData:t,scoreNames:n})),this.initDynamicText()},initDynamicText:function(){this.vo2MaxDynamicTextView=new s({el:this.$("#vo2MaxDynamicTextPlaceholder"),chartFormat:this.chartFormat,reportType:this.reportType,vo2MaxMetrics:this.vo2MaxMetrics,gender:this.gender,ageRange:this.ageRange,vo2MaxToggle:this.vo2MaxToggle,modalText:!0}),this.vo2MaxDynamicTextView.render()}});return u}),define("views/report/Vo2MaxTrendChartView",["underscore","backbone","localizer","personalizer","views/report/ChartView","highcharts","highchartsmore","highchartsexport"],function(e,t,n,r,i){return i.extend({createExportDataRowHeader:function(){this.exportData.rows[this.exportDataCount++]={values:["",n.localize("vo2.max.label")]}},determineYAxisTitle:function(){return n.localize("vo2Max_unit")},customizeOptions:function(){this.options.plotOptions={series:{showCheckbox:!1,selected:!0,states:{hover:{enabled:!0,halo:null}}}},this.options.yAxis.title.text=this.determineYAxisTitle(),this.options.tooltip={formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+" "+n.localize("vo2Max_unit")}},this.reportType=="all"&&(this.options.legend.enabled=!0)},initializeChartSeries:function(){this.chartSeries={};if(this.reportType==="wellness"||this.reportType=="running"||this.reportType=="all")this.chartSeries.running={color:"#80ea40",name:n.localize("ACTIVITY_VO2_MAX"),type:"line",data:this.createNullArray()};if(this.reportType=="cycling"||this.reportType=="all")this.chartSeries.cycling={color:"#11a9ed",name:n.localize("label_vo2_max_cycling"),type:"line",data:this.createNullArray()}},processMetricList:function(e){var t=e.get("metricsMap");if(this.reportType==="wellness"||this.reportType=="running"||this.reportType=="all"){this.vo2MaxType="running";var n=t.ACTIVITY_VO2_MAX;if(n)for(var r=0;r<n.length;r++)this.addMetricToDataset(n[r])}if(this.reportType=="cycling"||this.reportType=="all"){this.vo2MaxType="cycling";var i=t.ACTIVITY_VO2_MAX_CYCLING;if(i)for(var r=0;r<i.length;r++)this.addMetricToDataset(i[r])}},addMetricToDataset:function(e){var t=this.determineDataIndex(e);t>=0&&e.value!=null&&e.value>0&&this.chartSeries[this.vo2MaxType]&&(this.chartSeries[this.vo2MaxType].data[t]=e.value,this.exportData.rows[this.exportDataCount++]={values:[this.categories[t],this.vo2MaxType,e.value]})}})}),define("utils/SensorConfig",[],function(){return{AccessoriesWithBatteryStatus:{Vector3:{sku:"006-B2787",name:"Vector 3",imageUrl:"//static.garmincdn.com/com.garmin.connect/content/images/device-images/vector-3.png"}},Accessories:{RdPod:{sku:"010-12520-00",name:"Running Dynamics Pod",imageUrl:"//static.garmincdn.com/com.garmin.connect/content/images/device-images/running-dynamics-pod.png"}},BatteryStatusTypes:{OK:{prefix:"battery_status",status:"battery_good",icon:"icon-battery-status-100",rank:1},GOOD:{prefix:"battery_status",status:"battery_good",icon:"icon-battery-status-100",rank:1},NEW:{prefix:"battery_status",status:"battery_good",icon:"icon-battery-status-100",rank:1},CRITICAL:{prefix:"battery_status",status:"battery_low",icon:"icon-battery-status-25 color-50",rank:0},LOW:{prefix:"battery_status",status:"battery_low",icon:"icon-battery-status-25 color-50",rank:0},UNKNOWN:{prefix:"",status:"battery_unknown",icon:"icon-caution",rank:-1}}}}),define("models/activity/FlatActivitySummary",["underscore","backbone","utils/SensorConfig","utils/ActivityTypeCssClassMapper","utils/activity/ActivitiesUtil"],function(e,t,n,r,i){var s=t.Model.extend({idAttribute:"activityId",url:function(){return"/proxy/activity-service/activity/"+this.id},initialize:function(){this.bind("change:duration",this.validateFields,this),this.bind("change:distance",this.validateFields,this)},getOwnerId:function(){return this.get("userInfoDto").userProfilePk},getActivityTypeKey:function(){return this.get("activityTypeDTO").typeKey},isParent:function(){return this.get("isMultiSportParent")},hasParent:function(){var e=this.get("parentId");return typeof e!="undefined"&&e!=null},isLapSwimming:function(){var e=this.get("numberOfActiveLengths"),t=this.get("activityTypeDTO").typeKey;return typeof e!="undefined"&&e!=null&&e!=0&&t!=="strength_training"},isCycling:function(){return r.map(this.get("activityTypeDTO").typeKey)=="cycling"},isFloorClimbing:function(){return this.getActivityTypeKey()==="floor_climbing"},isDiving:function(){return i.isDivingActivity(this.get("activityTypeDTO").typeKey)},hasCyclingDynamicsData:function(){return!!(this.get("rightPowerPhaseArcCenter")||this.get("rightPowerPhaseArcLength")||this.get("rightPowerPhaseEnd")||this.get("rightPlatformCenterOffset")||this.get("seatedTime")||this.get("standingCount"))},isRunning:function(){return r.map(this.get("activityTypeDTO").typeKey)=="running"},isSwimming:function(){return r.map(this.get("activityTypeDTO").typeKey)=="swimming"},hasConnectIQMeasurements:function(){return this.has("connectIQMeasurements")},getIndexOfChild:function(t){return this.isParent()?e.indexOf(this.get("childIds"),t):null},hasPodSenor:function(){if(this.has("metadataDTO")&&this.get("metadataDTO").sensors){var t=e.find(this.get("metadataDTO").sensors,function(e){return e.bodyLocation&&e.bodyLocation==="WAIST_MID_BACK"});if(t&&!e.isEmpty(t))return!0}return!1},canDisplayAccessories:function(){return this.hasPodSenor()},canDisplayAccessoriesBatteryStatus:function(){var e=!1;return this.has("metadataDTO")&&this.get("metadataDTO").sensors?(e=this.getListOfAccessoriesWithBatteryStatus(),e&&e.length>0):e},getListOfAccessoriesWithBatteryStatus:function(){var t=[],r,i,s;if(this.get("metadataDTO")&&this.get("metadataDTO").sensors)for(var o=0,u=this.get("metadataDTO").sensors.length;o<u;o+=1){r=this.get("metadataDTO").sensors[o];if(r&&r.sku)for(var a in n.AccessoriesWithBatteryStatus)a&&n.AccessoriesWithBatteryStatus.hasOwnProperty(a)&&(i=r.sku.indexOf(n.AccessoriesWithBatteryStatus[a].sku)>-1,s=e.find(t,function(e){return e.sku.indexOf(r.sku)>-1}),i&&!s&&r.batteryStatus&&(r.name=n.AccessoriesWithBatteryStatus[a].name,r.imageUrl=n.AccessoriesWithBatteryStatus[a].imageUrl,t.push(r)))}return t},getListOfAccessories:function(){return n.Accessories},getAccessoryWithBatteryStatus:function(t){var n=e.filter(this.get("metadataDTO").sensors,function(e){if(e.sku&&t===e.sku&&e.batteryStatus)return e});return n},getBatteryInfo:function(t){var r,i={};r=this.getAccessoryWithBatteryStatus(t.sku);if(r)if(r.length===1)i=r[0];else for(var s=0,o=r.length;s<o;s+=1)r[s]&&r[s].batteryStatus&&(!i||e.isEmpty(i)?i=r[s]:n.BatteryStatusTypes[i.batteryStatus].rank>n.BatteryStatusTypes[r[s].batteryStatus].rank&&(i=r[s]));return i.name=t.name,i.imageUrl=t.imageUrl,i},getBatteryStatusTypes:function(){return n.BatteryStatusTypes},isActivitySaveAsCourseCapable:function(){return this.get("activityTypeDTO").typeKey!=="open_water_swimming"},parse:function(t){if(!t)return t;var n={};this.metaDataKeys=[],this.summaryKeys=[],this.diveKeys=[];for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];r==="metadataDTO"?(e.extend(n,i),this.metaDataKeys=e.keys(i)):r==="summaryDTO"?(e.extend(n,i),this.summaryKeys=e.keys(i)):r==="diveInfo"&&(e.extend(n,i),this.diveKeys=e.keys(i)),n[r]=i}return n},save:function(){var n=this.unsavedAttributes();if(!n)return;var r={};for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];e.indexOf(this.metaDataKeys,i)>1?(r.metadataDTO||(r.metadataDTO={}),r.metadataDTO[i]=s):e.indexOf(this.summaryKeys,i)>1?(r.summaryDTO||(r.summaryDTO={}),r.summaryDTO[i]=s):e.indexOf(this.diveKeys,i)>1?(r.diveInfo||(r.diveInfo=this.get("diveInfo")),r.diveInfo[i]=s):r[i]=s}return r[this.idAttribute]=this.id,t.Model.prototype.save.call(this,r,{patch:!0})},toJSON:function(){return t.Model.prototype.toJSON.call(this)}});return s}),define("utils/TrainingEffectUtil",["require","pages/activity_details_2/views/charts/ChartColorMapper","localizer"],function(e){var t=e("pages/activity_details_2/views/charts/ChartColorMapper"),n=e("localizer"),r={Types:{Anaerobic:"ANAEROBIC",Aerobic:"AEROBIC"},getFeedback:function(e,t,r){var i={feedbackTitle:null,feedbackContent:null},s=this.selectFeedbackNum(e,t,r);return i.feedbackTitle=n.localize(e+"_"+s+"_TITLE"),i.feedbackContent=n.localize(e+"_"+s+"_CONTENT"),i},selectFeedbackNum:function(e,t,n){var r;if(n){var i;i=n.split("_"),r=i[i.length-1]}else e===this.Types.Aerobic?r=this.aerobicDefaultFeedback(t):r=this.anaerobicDefaultFeedback(t);return r},aerobicDefaultFeedback:function(e){return e>=5?4:e<5&&e>=4?3:e<4&&e>=3?2:e<3&&e>=2?1:0},anaerobicDefaultFeedback:function(e){return e>=5?4:e<5&&e>=4?3:e<4&&e>=3?2:e<3&&e>=2?1:15},getTrainingEffectColor:function(e){var n;return e>=5?n=t.Colors.red:e>=4?n=t.Colors.mango:e>=3?n=t.Colors.peakGreen:e>=2?n=t.Colors.blue:e>0?n=t.Colors.grey:n=t.Colors.baseGrey,n}};return r}),define("views/report/TrainingEffectGaugeChartView",["require","underscore","backbone","localizer","personalizer","highcharts","highchartssolidgauge","pages/activity_details_2/views/charts/ChartColorMapper","utils/TrainingEffectUtil"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("personalizer"),s=e("highcharts"),o=e("highchartssolidgauge"),u=e("pages/activity_details_2/views/charts/ChartColorMapper"),a=e("utils/TrainingEffectUtil"),f=n.View.extend({className:"te-gauge-chart",maxVal:5,wChart:175,hChart:160,initialize:function(e){return this.teType=e.teType?e.teType:a.Types.Aerobic,this.data=e.data?e.data:0,this.teType===a.Types.Aerobic?this.teTitle=r.localize("label.aerobic.te"):this.teTitle=r.localize("label.anaerobic.te"),e.options?this.options=t.extend({},this.getDefaultOptions(),e.options):this.options=t.extend({},this.getDefaultOptions()),this},render:function(){var e="te-"+this.teType.toLowerCase()+"-gauge-chart";return this.$el.attr("id",e),this.$el.highcharts(this.options),this.formatGauge(),this},getDefaultOptions:function(){var e={chart:{type:"solidgauge",width:this.wChart,height:this.hChart,margin:[0,0,0,0],style:{fontFamily:"'Open Sans', sans-serif"}},title:null,tooltip:{enabled:!1},pane:{size:"100%",center:["50%","60%"],startAngle:-130,endAngle:130,background:{borderWidth:20,backgroundColor:"transparent",shape:"arc",borderColor:u.Colors.baseGrey,outerRadius:"90%",innerRadius:"90%"}},yAxis:{min:0,max:this.maxVal,lineWidth:0,tickPositions:[]},plotOptions:{solidgauge:{animation:!1,dataLabels:{borderWidth:0,useHTML:!0,format:"<div class='training-effect-score'><span class='data-bit'>"+i.personalizeTrainingEffect(this.data)+"</span><span class='data-label'>"+this.teTitle+"</span></div>",y:-68}}},series:[{data:[{y:this.data,radius:"90%",innerRadius:"90%"}]}],credits:{enabled:!1},exporting:{enabled:!1}};return e},formatGauge:function(){var e=this.$el.find(".highcharts-container").find("svg");if(e.length>0){var t=e[0].getElementsByTagName("path");t.length>=3&&(t[0].setAttributeNS(null,"stroke-linejoin","round"),t[2].setAttributeNS(null,"stroke-linejoin","round"),t[2].setAttributeNS(null,"stroke",a.getTrainingEffectColor(this.data)),t[2].setAttributeNS(null,"stroke-width","20"))}}});return f}),define("text!templates/report/TrainingEffectFeedbackView.html",[],function(){return'<h6 id="te-feedback-header"><%= feedbackTitle %></h6>\n<p id="te-feedback-content"><%= feedbackContent %></p>'}),define("views/report/TrainingEffectFeedbackView",["require","underscore","backbone","localizer","utils/TrainingEffectUtil","text!templates/report/TrainingEffectFeedbackView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("utils/TrainingEffectUtil"),s=e("text!templates/report/TrainingEffectFeedbackView.html"),o=n.View.extend({initialize:function(e){this.template=t.template(s),this.teType=e.teType,this.teValue=e.teValue,this.teMessage=e.teMessage},render:function(){var e={feedbackTitle:r.localize(this.teType+"_TRAINING_EFFECT"),feedbackContent:""};return e=i.getFeedback(this.teType,this.teValue,this.teMessage),this.$el.html(this.template({feedbackTitle:e.feedbackTitle,feedbackContent:e.feedbackContent})),this}});return o}),define("text!templates/report/TrainingEffectMostRecentView.html",[],function(){return'<!-- Rounded Gauges (TE scores for last activity on this view) -->\n<div class="data-block small top-s bottom-xs">\n    <div class="data-bit"><a class="colored" href="<%= url(\'/activity/\'+ tabHeaderAttributes.activityId) %>"> <%= tabHeaderAttributes.activityName %> </a></div>\n    <div class="data-label"><%= tabHeaderAttributes.activityDate %> </div>\n</div>\n\n<% if (showAnaerobicTE) { %>\n\n<div class="row-fluid">\n    <div id="te-anaerobic-feedback" class="span9 top-m"></div>\n    <div class="span3">\n        <div class="rounded-gauge" id="te-anaerobic-score"></div>\n    </div>\n</div>\n\n\n    <hr class="top-s bottom-s">\n<% } %>\n\n<div class="row-fluid">\n    <div id="te-aerobic-feedback" class="span9 top-m"></div>\n    <div class="span3">\n        <div class="rounded-gauge" id="te-aerobic-score"></div>\n    </div>\n</div>\n\n<div class="js-report-training-effect-footer"></div>\n'}),define("views/report/TrainingEffectMostRecentView",["require","underscore","backbone","personalizer","localizer","utils/ModelSynchronizer","models/activity/FlatActivitySummary","views/report/TrainingEffectGaugeChartView","views/report/TrainingEffectFeedbackView","utils/TrainingEffectUtil","utils/NavigationUtil","utils/date/DateFormatter","utils/date/DateParser","views/report/TrainingEffectFooterView","views/utils/ToolTipView","text!templates/report/TrainingEffectMostRecentView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("personalizer"),i=e("localizer"),s=e("utils/ModelSynchronizer"),o=e("models/activity/FlatActivitySummary"),u=e("views/report/TrainingEffectGaugeChartView"),a=e("views/report/TrainingEffectFeedbackView"),f=e("utils/TrainingEffectUtil"),l=e("utils/NavigationUtil"),c=e("utils/date/DateFormatter"),h=e("utils/date/DateParser"),p=e("views/report/TrainingEffectFooterView"),d=e("views/utils/ToolTipView"),v=e("text!templates/report/TrainingEffectMostRecentView.html"),m={ModelSyncFail:"ModelSyncFail"},g=n.View.extend({initialize:function(e){this.metricList=e.metricList,this.activityHasAnaerobicTE=!1,this.template=t.template(v),this.activityMetrics={anaerobicScore:null,anaerobicTrainingEffectMessage:null,aerobicScore:null,aerobicTrainingEffectMessage:null}},render:function(){var e=this.metricList.at(0),t=e.get("metricsMap"),n=t.ACTIVITY_AEROBIC_TRAINING_EFFECT,r=this.searchActivityId(n);this.fetchActivityModel(r)},searchActivityId:function(e){var n,r={},i;return e&&(n=t.max(e,function(e){return new Date(e.calendarDate)}),r=t.filter(e,function(e){return e.calendarDate===n.calendarDate}),i=t.max(r,function(e){return e.value})),i.activityId},fetchActivityModel:function(e){var t=new s,n=this;this.activityModel=new o({activityId:e}),t.addModel({model:this.activityModel,required:!0}),t.bind(s.Events.SYNCHRONIZED,function(){n.onActivityMetricsFetched(this.activityModel)},this),t.bind(s.Events.SYNCHRONIZE_FAILED,function(){n.onModelSynchronizedFailed()},this),t.fetchModels()},onActivityMetricsFetched:function(e){this.tabHeaderAttributes={activityName:e.get("activityName")?e.get("activityName"):i.localize("untitled"),activityDate:c.formatMonthDayYear(h.parseISO(e.get("startTimeLocal"))),activityId:e.id},this.getActivityMetrics(f.Types.Anaerobic),this.getActivityMetrics(f.Types.Aerobic),this.activityMetrics.anaerobicScore!==null&&this.activityMetrics.anaerobicScore!==undefined&&(this.activityHasAnaerobicTE=!0),this.renderView(),this.renderTrainingEffectFooterView()},onModelSynchronizedFailed:function(){this.trigger(m.ModelSyncFail)},renderView:function(){this.$el.html(this.template({Localizer:i,tabHeaderAttributes:this.tabHeaderAttributes,url:l.url,showAnaerobicTE:this.activityHasAnaerobicTE}));if(this.activityHasAnaerobicTE){var e=new a({teType:f.Types.Anaerobic,teValue:this.activityMetrics.anaerobicScore,teMessage:this.activityMetrics.anaerobicTrainingEffectMessage}),t=new u({teType:f.Types.Anaerobic,data:this.activityMetrics.anaerobicScore});this.$("#te-anaerobic-feedback").html(e.render().el),this.$("#te-anaerobic-score").html(t.render().el)}var n=new a({teType:f.Types.Aerobic,teValue:this.activityMetrics.aerobicScore,teMessage:this.activityMetrics.aerobicTrainingEffectMessage}),r=new u({teType:f.Types.Aerobic,data:this.activityMetrics.aerobicScore});this.$("#te-aerobic-feedback").html(n.render().el),this.$("#te-aerobic-score").html(r.render().el)},getActivityMetrics:function(e){switch(e){case"ANAEROBIC":this.activityMetrics.anaerobicScore=this.activityModel.get("anaerobicTrainingEffect"),this.activityMetrics.anaerobicTrainingEffectMessage=this.activityModel.get("anaerobicTrainingEffectMessage");break;case"AEROBIC":this.activityMetrics.aerobicScore=this.activityModel.get("trainingEffect"),this.activityMetrics.aerobicTrainingEffectMessage=this.activityModel.get("aerobicTrainingEffectMessage")}},renderTrainingEffectFooterView:function(){var e=new p({showAnaerobicTEFooter:this.activityHasAnaerobicTE,el:this.$(".js-report-training-effect-footer")});this.$(".js-report-training-effect-footer").html(e.render())}});return g.Event=m,g}),define("text!templates/report/TrainingEffectColumnChartView.html",[],function(){return'<div id="week" class="tab-pane">\n\n    <div id="te-ana-7d-container">\n        <div id="te-ana-7d"></div>\n    </div>\n\n    <div id="te-aero-7d-container">\n        <div id="te-aero-7d" class="bottom-none"></div>\n    </div>\n</div>\n\n<div class="js-report-training-effect-footer"></div>'}),define("views/report/TrainingEffectColumnChartView",["require","underscore","backbone","personalizer","localizer","utils/ReportChartUtil","utils/MainNavUtil","pages/activity_details_2/views/charts/ChartColorMapper","views/charts/TEBarChartView","views/report/TrainingEffectFooterView","text!templates/report/TrainingEffectColumnChartView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("personalizer"),i=e("localizer"),s=e("utils/ReportChartUtil"),o=e("utils/MainNavUtil"),u=e("pages/activity_details_2/views/charts/ChartColorMapper"),a=e("views/charts/TEBarChartView"),f=e("views/report/TrainingEffectFooterView"),l=e("text!templates/report/TrainingEffectColumnChartView.html"),c=n.View.extend({initialize:function(e){this.report=e.report,this.reportType=e.reportType,this.chartFormat=e.chartFormat,this.metricList=e.metricList,this.metricPeriod=e.trainingEffectMetricPeriod,this.currentDateOffset=e.currentDateOffset,this.userPreferences=e.userPreferences,this.daysInMonth=e.daysInMonth,this.chartType=e.chartType,this.template=t.template(l),this.anaerobicChartOptions={},this.aerobicChartOptions={},this.showAnaerobicTE=e.showAnaerobicTE,this.showAerobicTE=e.showAerobicTE,o.setExpandCollapseHandler(this.resizeChart.bind(this),20)},render:function(){this.$el.html(this.template({Localizer:i})),this.getXAxisCategories();var e=this.metricList.at(0),t=e.get("metricsMap");if(this.showAnaerobicTE){var n=t.ACTIVITY_ANAEROBIC_TRAINING_EFFECT;this.getAnaerobicChartOptions(),this.processAnaerobicMetricList(n),this.renderAnaerobicChart()}if(this.showAerobicTE){var r=t.ACTIVITY_AEROBIC_TRAINING_EFFECT;this.getAerobicChartOptions(),this.processAerobicMetricList(r),this.renderAerobicChart()}this.chartFormat!=="widget"&&this.renderTrainingEffectFooterView()},createZeroArray:function(){var e=[],t;if(this.metricPeriod)for(t=-6;t<=0;t++)e.push(0);else for(t=this.daysInMonth;t<=0;t++)e.push(0);return e},processAnaerobicMetricList:function(e){var t,n,r,i;for(r=0,i=e.length;r<i;r++)t=this.addMetricToDataset(e[r]),t>=0&&this.anaerobicChartOptions.series&&(this.anaerobicChartOptions.series[0].data[t]!==0?(n=this.anaerobicChartOptions.series[0].data[t],n<=e[r].value?this.anaerobicChartOptions.series[0].data[t]=e[r].value:this.anaerobicChartOptions.series[0].data[t]=n):this.anaerobicChartOptions.series[0].data[t]=e[r].value)},processAerobicMetricList:function(e){var t,n,r,i;for(r=0,i=e.length;r<i;r++)t=this.addMetricToDataset(e[r]),t>=0&&this.aerobicChartOptions.series&&(this.aerobicChartOptions.series[0].data[t]!==0?(n=this.aerobicChartOptions.series[0].data[t],n<=e[r].value?this.aerobicChartOptions.series[0].data[t]=e[r].value:this.aerobicChartOptions.series[0].data[t]=n):this.aerobicChartOptions.series[0].data[t]=e[r].value)},addMetricToDataset:function(e){return this.metricPeriod?this.calculateDailyDataIndex(e.calendarDate,7):this.calculateWeeklyDataIndex(e.calendarDate)},calculateDailyDataIndex:function(e,t){var n=s.formatDate(this.currentDateOffset),r=s.determineNumberOfDays(e,n),i=t-r;return i<0||i>6?-1:i},calculateWeeklyDataIndex:function(e){var t=e.split("-"),n=new Date(t[0],t[1]-1,t[2],0,0,0),r=n.getMonth()+1,s=n.getDate(),o=this.userPreferences.get("dateFormat"),u="";o.formatKey==="mmddyyyy"||o.formatKey==="yyyymmdd"?u=i.localize("month.abbr."+(r>9?r:"0"+r))+" "+s:u=s+" "+i.localize("month.abbr."+(r>9?r:"0"+r));var a=this.categories.indexOf(u);return a<0?-1:a},getAnaerobicChartOptions:function(){var e;this.chartFormat==="widget"?e={type:this.chartType,padding:0,width:290,height:this.showAerobicTE===!0&&this.showAnaerobicTE===!0?100:210,spacingLeft:this.getSpacing(),style:{fontFamily:"'Open Sans', sans-serif"},backgroundColor:""}:e={type:this.chartType,padding:0,spacingLeft:this.getSpacing(),style:{fontFamily:"'Open Sans', sans-serif"},backgroundColor:""},this.anaerobicChartOptions={chart:e,title:{text:""},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{column:{animation:!1}},exporting:{enabled:!1},xAxis:{labels:{rotation:0,style:{textOverflow:"none"}},tickInterval:this.metricPeriod?"":7,categories:this.categories,labels:{enabled:!1}},yAxis:{title:{text:i.localize("ANAEROBIC_CHART")},allowDecimals:!1,alternateGridColor:"rgba(230,230,230,.125)",gridLineColor:"#dadada",tickPositions:[0,1,2,3,4,5]},tooltip:{useHTML:!0,formatter:function(){return"<strong>"+this.x+"</strong></br>"+i.localize("ANAEROBIC_CHART")+": <strong>"+r.formatDecimalNumber(this.y,2)+"</strong><br>"}},plotOptions:{series:{borderWidth:0}},series:[{name:i.localize("ANAEROBIC_CHART"),data:this.buildSeriesData(),color:u.Colors.blue}]}},getAerobicChartOptions:function(){var e={};this.chartFormat==="widget"?e={type:this.chartType,padding:0,width:290,height:this.showAerobicTE===!0&&this.showAnaerobicTE===!0?100:210,spacingLeft:this.getSpacing(),style:{fontFamily:"'Open Sans', sans-serif"},backgroundColor:""}:e={type:this.chartType,padding:0,spacingLeft:this.getSpacing(),style:{fontFamily:"'Open Sans', sans-serif"},backgroundColor:""},this.aerobicChartOptions={chart:e,credits:{enabled:!1},legend:{enabled:!1},plotOptions:{column:{animation:!1}},title:{text:""},exporting:{enabled:!1},xAxis:{labels:{rotation:0,style:{textOverflow:"none"}},tickInterval:this.metricPeriod?"":7,categories:this.categories},yAxis:{min:0,title:{text:i.localize("AEROBIC_CHART")},allowDecimals:!1,alternateGridColor:"rgba(230,230,230,.125)",gridLineColor:"#dadada",tickPositions:[0,1,2,3,4,5]},tooltip:{useHTML:!0,formatter:function(){return"<strong>"+this.x+"</strong><br>"+i.localize("AEROBIC_CHART")+": <strong>"+r.formatDecimalNumber(this.y,2)+"</strong>"}},plotOptions:{series:{borderWidth:0}},series:[{name:i.localize("AEROBIC_CHART"),data:this.buildSeriesData(),color:u.Colors.blue}]}},renderAnaerobicChart:function(){this.anaerobicColumnChart=new a({options:this.anaerobicChartOptions,el:this.$("#te-ana-7d")}),this.$("#te-ana-7d-container").html(this.anaerobicColumnChart.render().el)},renderAerobicChart:function(){this.aerobicColumnChart=new a({options:this.aerobicChartOptions,el:this.$("#te-aero-7d")}),this.$("#te-aero-7d-container").html(this.aerobicColumnChart.render().el)},buildSeriesData:function(){var e=[];return e=this.createZeroArray(this.metricPeriod),e},getSpacing:function(){return this.chartFormat==="widget"?-8:10},getXAxisCategories:function(){this.metricPeriod?this.getDailyCategories():this.getOneMonthCategories()},getDailyCategories:function(){this.categories=[];for(var e=-6;e<=0;e++){var t=new Date;t.setHours(12),t.setMinutes(0),t.setMilliseconds(0),t.setDate(t.getDate()+this.currentDateOffset),t.setDate(t.getDate()+e);var n="",r=t.getDay().toString();n=i.localize("day."+r+".short"),this.categories.push(n)}},getOneMonthCategories:function(){this.categories=[];for(var e=this.daysInMonth;e<=0;e++){var t=new Date;t.setHours(12),t.setMinutes(0),t.setMilliseconds(0),t.setDate(t.getDate()+this.currentDateOffset),t.setDate(t.getDate()+e);var n=t.getDate().toString(),r=(t.getMonth()+1).toString(),s=this.userPreferences.get("dateFormat"),o="";s.formatKey==="mmddyyyy"||s.formatKey==="yyyymmdd"?o=i.localize("month.abbr."+(r>9?r:"0"+r))+" "+n:o=n+" "+i.localize("month.abbr."+(r>9?r:"0"+r)),this.categories.push(o)}},renderTrainingEffectFooterView:function(){var e=new f({showAnaerobicTEFooter:this.showAnaerobicTE,showAerobicTEFooter:this.showAerobicTE,el:this.$(".js-report-training-effect-footer")});this.$(".js-report-training-effect-footer").html(e.render())},resizeChart:function(){this.anaerobicColumnChart&&this.anaerobicColumnChart.chartObj.reflow(),this.aerobicColumnChart&&this.aerobicColumnChart.chartObj.reflow()}});return c}),define("text!pages/activity_details_2/templates/views/stat_views/TrainingEffectThisActivityView.html",[],function(){return'<% if (anaerobicTrainingEffect !== null) {      %>\n<div id="te-anaerobic-feedback" class="te-feedback"></div>\n<div class="rounded-gauge te-score" id="te-anaerobic-score"></div>\n<% } %>\n\n<% if (anaerobicTrainingEffect !== null && aerobicTrainingEffect !== null) {      %>\n<hr class="top-s bottom-s">\n<% } %>\n\n<% if (aerobicTrainingEffect !== null) {      %>\n<div id="te-aerobic-feedback" class="te-feedback"></div>\n<div class="rounded-gauge te-score" id="te-aerobic-score"></div>\n<% } %>\n'}),define("pages/activity_details_2/views/stat_views/TrainingEffectThisActivityView",["require","underscore","backbone","localizer","views/report/TrainingEffectGaugeChartView","views/report/TrainingEffectFeedbackView","utils/TrainingEffectUtil","text!pages/activity_details_2/templates/views/stat_views/TrainingEffectThisActivityView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("views/report/TrainingEffectGaugeChartView"),s=e("views/report/TrainingEffectFeedbackView"),o=e("utils/TrainingEffectUtil"),u=e("text!pages/activity_details_2/templates/views/stat_views/TrainingEffectThisActivityView.html"),a=n.View.extend({template:t.template(u),initialize:function(e){return this.aerobicTrainingEffect=e.aerobicTrainingEffect,this.aerobicTrainingEffectMessage=e.aerobicTrainingEffectMessage,this.anaerobicTrainingEffect=e.anaerobicTrainingEffect,this.anaerobicTrainingEffectMessage=e.anaerobicTrainingEffectMessage,this},render:function(){this.$el.html(this.template({Localizer:r,aerobicTrainingEffect:this.aerobicTrainingEffect,anaerobicTrainingEffect:this.anaerobicTrainingEffect}));if(this.anaerobicTrainingEffect!==null){var e=new s({teType:o.Types.Anaerobic,teValue:this.anaerobicTrainingEffect,teMessage:this.anaerobicTrainingEffectMessage}),t=new i({teType:o.Types.Anaerobic,data:this.anaerobicTrainingEffect});this.$("#te-anaerobic-feedback").html(e.render().el),this.$("#te-anaerobic-score").html(t.render().el)}if(this.aerobicTrainingEffect!==null){var n=new s({teType:o.Types.Aerobic,teValue:this.aerobicTrainingEffect,teMessage:this.aerobicTrainingEffectMessage}),u=new i({teType:o.Types.Aerobic,data:this.aerobicTrainingEffect});this.$("#te-aerobic-feedback").html(n.render().el),this.$("#te-aerobic-score").html(u.render().el)}return this}});return a}),define("text!pages/activity_details_2/templates/views/stat_views/TrainingEffectLearnMoreView.html",[],function(){return"<% if (anaerobicTrainingEffect !== null) {      %>\n<p><strong><%= Localizer.localize('ANAEROBIC_TRAINING_EFFECT') %></strong> <%= Localizer.localize('ANAEROBIC_TE_DESCRIPTION') %></p>\n<% } %>\n\n<p><strong><%= Localizer.localize('AEROBIC_TRAINING_EFFECT') %></strong> <%= Localizer.localize('AEROBIC_TE_DESCRIPTION') %></p>\n\n<div class=\"fine-print\">\n    <%= Localizer.localize('TRAINING_EFFECT_REPORT_FOOTER') %>\n</div>"}),define("pages/activity_details_2/views/stat_views/TrainingEffectLearnMoreView",["require","underscore","backbone","localizer","text!pages/activity_details_2/templates/views/stat_views/TrainingEffectLearnMoreView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("text!pages/activity_details_2/templates/views/stat_views/TrainingEffectLearnMoreView.html"),s=n.View.extend({initialize:function(e){this.template=t.template(i),this.aerobicTrainingEffect=e.aerobicTrainingEffect,this.anaerobicTrainingEffect=e.anaerobicTrainingEffect},render:function(){return this.$el.html(this.template({Localizer:r,aerobicTrainingEffect:this.aerobicTrainingEffect,anaerobicTrainingEffect:this.anaerobicTrainingEffect})),this}});return s}),define("text!pages/activity_details_2/templates/views/stat_views/TrainingEffectScoringScaleView.html",[],function(){return"<table class=\"table table-bordered table-training-effect\">\n    <thead>\n    <tr>\n        <th><%= Localizer.localize('trainingEffect.help.status') %></th>\n        <th><%= Localizer.localize('trainingEffect.help.score') %></th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr>\n        <td><%= Localizer.localize('trainingEffect.help.score5') %></td>\n        <td>5</td>\n    </tr>\n    <tr>\n        <td><%= Localizer.localize('trainingEffect.help.score4') %></td>\n        <td>4</td>\n    </tr>\n    <tr>\n        <td><%= Localizer.localize('trainingEffect.help.score3') %></td>\n        <td>3</td>\n    </tr>\n    <tr>\n        <td><%= Localizer.localize('trainingEffect.help.score2') %></td>\n        <td>2</td>\n    </tr>\n    <tr>\n        <td><%= Localizer.localize('trainingEffect.help.score1') %></td>\n        <td>1</td>\n    </tr>\n    <tr>\n        <td><%= Localizer.localize('trainingEffect.help.score0') %></td>\n        <td>0</td>\n    </tr>\n    </tbody>\n</table>"}),define("pages/activity_details_2/views/stat_views/TrainingEffectScoringScaleView",["require","underscore","backbone","localizer","text!pages/activity_details_2/templates/views/stat_views/TrainingEffectScoringScaleView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("text!pages/activity_details_2/templates/views/stat_views/TrainingEffectScoringScaleView.html"),s=n.View.extend({initialize:function(){this.template=t.template(i)},render:function(){return this.$el.html(this.template({Localizer:r})),this}});return s}),define("text!pages/activity_details_2/templates/views/stat_views/TrainingEffectModalView.html",[],function(){return'<% if (isWidget === false) { %>\n    <ul class="nav nav-tabs">\n        <li class="active"><a href="#te-this-activity-placeholder" data-toggle="tab"><%= Localizer.localize(\'label.this.activity\') %></a></li>\n        <li><a href="#te-learn-placeholder" data-toggle="tab"><%= Localizer.localize(\'agent.learn.more\') %></a></li>\n        <li><a href="#te-scores-placeholder" data-toggle="tab"><%= Localizer.localize(\'label.scoring.scale\') %></a></li>\n    </ul>\n\n    <div class="tab-content">\n        <div class="tab-pane active" id="te-this-activity-placeholder"></div>\n\n        <div class="tab-pane" id="te-learn-placeholder"></div>\n        \n        <div class="tab-pane" id="te-scores-placeholder"></div>\n    </div>\n<% } else { %>\n    <ul class="nav nav-tabs">\n        <li class="active"><a href="#te-learn-placeholder" data-toggle="tab"><%= Localizer.localize(\'agent.learn.more\') %></a></li>\n        <li><a href="#te-scores-placeholder" data-toggle="tab"><%= Localizer.localize(\'label.scoring.scale\') %></a></li>\n    </ul>\n\n    <div class="tab-content">\n        <div class="tab-pane active" id="te-learn-placeholder"></div>\n\n        <div class="tab-pane" id="te-scores-placeholder"></div>\n    </div>\n\n<% } %>\n'}),define("pages/activity_details_2/views/stat_views/TrainingEffectModalView",["require","underscore","backbone","localizer","pages/activity_details_2/views/stat_views/TrainingEffectThisActivityView","pages/activity_details_2/views/stat_views/TrainingEffectLearnMoreView","pages/activity_details_2/views/stat_views/TrainingEffectScoringScaleView","text!pages/activity_details_2/templates/views/stat_views/TrainingEffectModalView.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("pages/activity_details_2/views/stat_views/TrainingEffectThisActivityView"),s=e("pages/activity_details_2/views/stat_views/TrainingEffectLearnMoreView"),o=e("pages/activity_details_2/views/stat_views/TrainingEffectScoringScaleView"),u=e("text!pages/activity_details_2/templates/views/stat_views/TrainingEffectModalView.html"),a=n.View.extend({initialize:function(e){this.template=t.template(u),this.aerobicTrainingEffect=e.aerobicTrainingEffect,this.aerobicTrainingEffectMessage=e.aerobicTrainingEffectMessage,this.anaerobicTrainingEffect=e.anaerobicTrainingEffect,this.anaerobicTrainingEffectMessage=e.anaerobicTrainingEffectMessage,this.isWidget=e.isWidget},render:function(){this.$el.html(this.template({Localizer:r,isWidget:this.isWidget})),this.isWidget===!1&&(this.thisActivityView=new i({aerobicTrainingEffect:this.aerobicTrainingEffect,aerobicTrainingEffectMessage:this.aerobicTrainingEffectMessage,anaerobicTrainingEffect:this.anaerobicTrainingEffect,anaerobicTrainingEffectMessage:this.anaerobicTrainingEffectMessage}),this.$("#te-this-activity-placeholder").html(this.thisActivityView.render().el)),this.learnMoreView=new s({aerobicTrainingEffect:this.aerobicTrainingEffect,anaerobicTrainingEffect:this.anaerobicTrainingEffect}),this.scoringScaleView=new o({}),this.$("#te-learn-placeholder").html(this.learnMoreView.render().el),this.$("#te-scores-placeholder").html(this.scoringScaleView.render().el)}});return a}),define("collections/reports/ReportMetrics",["require","backbone","models/reports/ReportMetric"],function(e){var t=e("backbone"),n=e("models/reports/ReportMetric"),r=t.Collection.extend({model:n,url:function(){var e="",t="";for(var n=0;n<this.metricIdList.length;n++)e+="&metricId="+this.metricIdList[n];for(var r=0;r<this.activityIdList.length;r++)t+="&actTypeId="+this.activityIdList[r];switch(this.metricPeriod){case"daily":return"/proxy/userstats-service/"+this.metricType+"/daily/"+this.getDisplayName()+"?fromDate="+this.startDate+"&untilDate="+this.untilDate+e+"&grpParentActType="+this.groupResults+t;case"weekly":return"/proxy/userstats-service/"+this.metricType+"/weekly/"+this.getDisplayName()+"?fromWeekStartDate="+this.startDate+"&untilWeekStartDate="+this.untilDate+e+"&grpParentActType="+this.groupResults+t;case"monthly":case"yearly":return"/proxy/userstats-service/"+this.metricType+"/monthly/"+this.getDisplayName()+"?fromMonthStartDate="+this.startDate+"&untilMonthStartDate="+this.untilDate+e+"&grpParentActType="+this.groupResults+t;default:return"/proxy/userstats-service/"+this.metricType+"/all/"+this.getDisplayName()+"?fromDate="+this.startDate+"&untilDate="+this.untilDate+e+"&grpParentActType="+this.groupResults+t}},initialize:function(e){this.metricType=e.metricType,this.metricPeriod=e.metricPeriod,this.startDate=e.startDate,this.untilDate=e.untilDate,this.groupResults=e.groupResults,this.metricIdList=e.metricIdList,this.activityIdList=e.activityIdList},setDisplayName:function(e){this.displayName=e},getDisplayName:function(){return this.displayName},parse:function(e){return this.groupResults?e.groupedMetrics:e.allMetrics}});return r}),define("models/reports/RepCountingStatistic",["require","backbone"],function(e){var t=e("backbone");return t.Model.extend({})}),define("collections/reports/RepCountingStatistics",["require","backbone","utils/ReportTypes","models/reports/RepCountingStatistic"],function(e){var t=e("backbone"),n=e("utils/ReportTypes"),r=e("models/reports/RepCountingStatistic");return t.Collection.extend({model:r,url:function(){return"/proxy/fitnessstats-service/fitnessstats/strengthTrainingStats/"+this.aggregation+"?startDate="+this.startDate+"&endDate="+this.endDate},initialize:function(e){this.startDate=e.startDate,this.endDate=e.untilDate,this.aggregation=e.aggregation},setDisplayName:function(e){this.displayName=e}})}),define("models/reports/MetricColorRange",["backbone"],function(e){var t=e.Model.extend({});return t}),define("collections/reports/MetricColorRanges",["backbone","utils/ReportTypes","models/reports/MetricColorRange"],function(e,t,n){var r=e.Collection.extend({model:n,url:function(){return"/proxy/vo2max-service/vo2max/colorrange/"+this.type},initialize:function(e){switch(e.metricName){case t.ACTIVITY_VERTICAL_OSCILLATION:this.type="VerticalOscillation";break;case t.ACTIVITY_GROUND_CONTACT_TIME:this.type="GroundContactTime";break;case t.ACTIVITY_AVERAGE_RUN_CADENCE:this.type="Cadence"}}});return r}),define("models/vo2max/Vo2MaxCategory",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({initialize:function(){}});return n}),define("collections/vo2max/Vo2MaxCategories",["require","backbone","models/vo2max/Vo2MaxCategory"],function(e){var t=e("backbone"),n=e("models/vo2max/Vo2MaxCategory"),r=t.Collection.extend({model:n,url:function(){return"/proxy/vo2max-service/vo2max/range/"+this.gender+"/"+this.ageRange},initialize:function(e,t){t.gender?this.gender=t.gender:this.gender="MALE",t.ageRange?t.ageRange==="Under 20"?this.ageRange="20-29":t.ageRange==="80+"?this.ageRange="70-79":this.ageRange=t.ageRange:this.ageRange="40-49"},getRangeMin:function(){var e=100;for(var t=0;t<this.length;t++)this.models[t].get("categoryRangeMin")<e&&(e=this.models[t].get("categoryRangeMin"));return e},getRangeMax:function(){var e=0;for(var t=0;t<this.length;t++)this.models[t].get("categoryRangeMax")>e&&(e=this.models[t].get("categoryRangeMax"));return e}});return r}),define("models/wellness/AverageSteps",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({urlRoot:"/proxy/usersummary-service/usersummary/stats/averagesteps/",initialize:function(e){this.displayName=e.displayName,this.startDate=e.startDate,this.endDate=e.endDate},url:function(){var e=this.urlRoot+this.displayName+"?startDate="+this.startDate+"&endDate="+this.endDate;return e},parse:function(e){this.set("averageSteps",e)}});return n}),define("models/reports/MostRecentTrainingStatuses",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({url:function(){return"/proxy/metrics-service/metrics/trainingstatus/daily/"+this.calendarDate},initialize:function(e){this.calendarDate=e.calendarDate},setDisplayName:function(e){this.displayName=e}});return n}),define("utils/ChartTypes",[],function(){return{BAR:"BAR",BAR_STACKED:"BAR_STACKED",BAR_NEGATIVE_STACKED:"BAR_NEGATIVE_STACKED",LINE:"LINE",LINE_MULTI_GROUPED:"LINE_MULTI_GROUPED",LINE_WITH_GAUGE:"LINE_WITH_GAUGE",SCATTERED_WITH_AVG:"SCATTERED_WITH_AVG",PIE:"PIE",NONSTANDARD:"NONSTANDARD"}}),define("utils/ReportTypeMetricIds",["require"],function(e){return{ACTIVITY_ACTIVE_CALORIES:1,ACTIVITY_AVERAGE_BIKE_CADENCE:2,ACTIVITY_AVERAGE_HEART_RATE:3,ACTIVITY_AVERAGE_PACE:4,ACTIVITY_AVERAGE_POWER:5,ACTIVITY_AVERAGE_RUN_CADENCE:6,ACTIVITY_AVERAGE_SPEED:7,ACTIVITY_AVERAGE_STROKES:8,ACTIVITY_AVERAGE_SWOLF:9,ACTIVITY_GROUND_CONTACT_TIME:10,ACTIVITY_INTENSITY_FACTOR:11,ACTIVITY_MAX_20_MIN_AVERAGE_POWER:12,ACTIVITY_MAX_HEART_RATE:13,ACTIVITY_MINIMUM_SWOLF:14,ACTIVITY_NORMALIZED_POWER:15,ACTIVITY_NUMBER_OF_ACTIVITIES:16,ACTIVITY_TOTAL_DISTANCE:17,ACTIVITY_TOTAL_DURATION:18,ACTIVITY_TRAINING_STRESS_SCORE:19,ACTIVITY_VERTICAL_OSCILLATION:20,ACTIVITY_VO2_MAX:21,WELLNESS_ACTIVE_CALORIES:22,WELLNESS_BMR_CALORIES:23,FOOD_CALORIES_CONSUMED:24,FOOD_CALORIES_REMAINING:25,SLEEP_SLEEP_DURATION:26,SLEEP_SLEEP_MOOD:27,WELLNESS_TOTAL_CALORIES:28,WELLNESS_TOTAL_STEPS:29,ACTIVITY_AVERAGE_EFFICIENCY:30,ACTIVITY_LEFT_BALANCE:31,ACTIVITY_MINIMUM_EFFICIENCY:32,ACTIVITY_MINIMUM_STROKES:33,ACTIVITY_RIGHT_BALANCE:34,ACTIVITY_TOTAL_ELEVATION_GAIN:35,ACTIVITY_TOTAL_ELEVATION_LOSS:36,ACTIVITY_TOTAL_SWIMMING_STROKES:37,WELLNESS_TOTAL_STEP_GOAL:38,WELLNESS_TOTAL_DISTANCE:39,WELLNESS_AVERAGE_STEPS:40,COMMON_TOTAL_CALORIES:41,COMMON_ACTIVE_CALORIES:42,COMMON_TOTAL_DISTANCE:43,ACTIVITY_VO2_MAX_CYCLING:44,ACTIVITY_AVG_STRIDE_LENGTH:45,ACTIVITY_AVG_VERTICAL_RATIO:46,ACTIVITY_AVG_GROUND_CONTACT_BALANCE:47,ACTIVITY_AVG_LACTATE_THRESHOLD_BPM:48,ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC:49,ACTIVITY_MAX_FTP:50,WELLNESS_MODERATE_INTENSITY_MINUTES:51,WELLNESS_VIGOROUS_INTENSITY_MINUTES:52,WELLNESS_FLOORS_ASCENDED:53,WELLNESS_FLOORS_DESCENDED:54,WELLNESS_USER_INTENSITY_MINUTES_GOAL:55,WELLNESS_USER_FLOORS_ASCENDED_GOAL:56,WELLNESS_MIN_HEART_RATE:57,WELLNESS_MAX_HEART_RATE:58,ACTIVITY_AVERAGE_SWIM_PACE:59,WELLNESS_RESTING_HEART_RATE:60,ACTIVITY_AEROBIC_TRAINING_EFFECT:61,ACTIVITY_ANAEROBIC_TRAINING_EFFECT:62,WELLNESS_AVERAGE_STRESS:63,WELLNESS_HIGH_STRESS:64,ACTIVITY_HRV_STRESS_TEST:65,ACTIVITY_TRAINING_STATUS:-1,STRENGTH_TRAINING:-2}}),define("text!templates/report/reportController.html",[],function(){return'<!-- Page markup starts here -->\n<% if (chartFormat === \'page\') { %>\n\n<!--<div class="span18">-->\n    <% if (report.metricName === \'ACTIVITY_VO2_MAX\' || report.metricName === \'ACTIVITY_VO2_MAX_CYCLING\') { %>\n    <div class="data-block medium vo2-title-block">\n        <h3 class="data-bit"><%= report.metricName === \'ACTIVITY_VO2_MAX\' ? Localizer.localize(\'ACTIVITY_VO2_MAX\') : Localizer.localize(\'vo2_max_cycling_title\') %>\n            <a data-toggle="modal" class="help-icon vo2-max-help-modal" style="display: none"><i class="icon-help"></i></a>\n        </h3>\n    </div>\n    <% } else { %>\n    <h4 class="bottom-s js-report-title"><%= Localizer.localize(report.metricName) %><span class="js-popup-placeholder"></span></h4>\n    <% } %>\n\n    <% if (report.metricName === \'ACTIVITY_TRAINING_STATUS\') { %>\n        <div id="report-current-status-container"></div>\n    <% } %>\n\n    <div class="pull-left reports-pagination top-xs">\n        <span>\n            <button class="btn btn-small btn-secondary js-today-btn"><%= Localizer.localize(\'today\') %></button>\n        </span>\n\n        <div class="reports-navigation">\n        <span>\n            <button class="icon-arrow-left"></button>\n            <button class="icon-arrow-right left-xs"></button>\n        </span>\n            <span class="js-report-date-range"></span>\n        </div>\n    </div>\n\n    <div class="tabbable">\n\n        <!--tabs-->\n        <ul class="nav nav-tabs tabs-right">\n            <li id="tab-pane0">\n                <a href="#pane0" data-toggle="tab" class="js-current"><%= Localizer.localize(\'most_recent\') %></a>\n            </li>\n            <li id="tab-pane1">\n                <a href="#pane1" data-toggle="tab" class="js-last_seven_days"><%= Localizer.localize(\'seven_days\') %></a>\n            </li>\n            <li id="tab-pane2">\n                <a href="#pane2" data-toggle="tab" class="js-last_four_weeks"><%= Localizer.localize(\'four_weeks\') %></a>\n            </li>\n            <li id="tab-pane3">\n                <a href="#pane3" data-toggle="tab" class="js-last_six_months"><%= Localizer.localize(\'six_months\') %></a>\n            </li>\n            <li id="tab-pane4">\n                <a href="#pane4" data-toggle="tab" class="js-last_year"><%= Localizer.localize(\'twelve_months\') %></a>\n            </li>\n        </ul>\n\n        <!--tab content-->\n\n        <div class="h4 top-s bottom-s text-center" id="reportFilter" style="display:none;"></div>\n\n        <div class="tab-content">\n\n            <div id="pane0" class="tab-pane">\n\n                <div class="js-report-chart-current-te"></div>\n\n                <div class="top-l">\n                    <div class="span8">\n                        <div class="text-center vo2-sport-filter bottom-xs" style="display: none">\n                            <div class="btn-group btn-group-pill vo2-widget-filter widget-filter" data-toggle="buttons-radio">\n                                <button class="btn btn-small vo2-sport-filter-cycling"><%= Localizer.localize(\'activity_type_cycling\') %></button>\n                                <button class="btn btn-small vo2-sport-filter-running"><%= Localizer.localize(\'activity_type_running\') %></button>\n                            </div>\n                        </div>\n                        <div class="text-center ftp-filter" style="display: none">\n                            <div class="btn-group btn-group-pill widget-filter ftp-widget-filter">\n                                <button class="btn btn-small ftp-watts"><%= Localizer.localize(\'label_power_unit\') %></button>\n                                <button class="btn btn-small ftp-watts-kg"><%= Localizer.localize(\'label_power_kg\') %></button>\n                            </div>\n                        </div>\n                        <div class="chart-container">\n                            <div class="chart chart-widget">\n                                <span class="additionalPlaceHolder"></span>\n                                <div class="js-report-chart-current"></div>\n                            </div>\n                        </div>\n\n                    </div>\n                    <div class="span8">\n                        <div class="js-report-chart-compare"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div id="pane1" class="tab-pane">\n                <div class="row ftp-filter">\n                    <div class="text-center bottom-xs">\n                        <div class="btn-group btn-group-pill widget-filter ftp-widget-filter">\n                            <button class="btn btn-small ftp-watts-trend"><%= Localizer.localize(\'label_power_unit\') %></button>\n                            <button class="btn btn-small ftp-watts-kg-trend"><%= Localizer.localize(\'label_power_kg\') %></button>\n                        </div>\n                    </div>\n                </div>\n                <div class="row-fluid chart-container">\n                    <div class="chart js-report-chart-seven-day"></div>\n                </div>\n            </div>\n\n            <div id="pane2" class="tab-pane">\n                <div class="row ftp-filter" style="display: none">\n                    <div class="text-center bottom-xs">\n                        <div class="btn-group btn-group-pill widget-filter ftp-widget-filter">\n                            <button class="btn btn-small ftp-watts-trend"><%= Localizer.localize(\'label_power_unit\') %></button>\n                            <button class="btn btn-small ftp-watts-kg-trend"><%= Localizer.localize(\'label_power_kg\') %></button>\n                        </div>\n                    </div>\n                </div>\n                <div class="row-fluid chart-container">\n                    <div class="chart js-report-chart-four-week"></div>\n                </div>\n            </div>\n\n            <div id="pane3" class="tab-pane">\n                <div class="row ftp-filter" style="display: none">\n                    <div class="text-center bottom-xs">\n                        <div class="btn-group btn-group-pill widget-filter ftp-widget-filter">\n                            <button class="btn btn-small ftp-watts-trend"><%= Localizer.localize(\'label_power_unit\') %></button>\n                            <button class="btn btn-small ftp-watts-kg-trend"><%= Localizer.localize(\'label_power_kg\') %></button>\n                        </div>\n                    </div>\n                </div>\n                <div class="row-fluid chart-container">\n                    <div class="chart js-report-chart-six-month"></div>\n                </div>\n            </div>\n\n            <div id="pane4" class="tab-pane">\n                <div class="row ftp-filter" style="display: none">\n                    <div class="text-center bottom-xs">\n                        <div class="btn-group btn-group-pill widget-filter ftp-widget-filter">\n                            <button class="btn btn-small ftp-watts-trend"><%= Localizer.localize(\'label_power_unit\') %></button>\n                            <button class="btn btn-small ftp-watts-kg-trend"><%= Localizer.localize(\'label_power_kg\') %></button>\n                        </div>\n                    </div>\n                </div>\n                <div class="row-fluid chart-container">\n                    <div class="chart js-report-chart-twelve-month"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="reportComparisonPlaceholder"></div>\n\n    <% if (report.metricName === \'ACTIVITY_NORMALIZED_POWER\' || report.metricName === \'ACTIVITY_TRAINING_STRESS_SCORE\') { %>\n        <div class="legal dense muted top-m">\n            <%= Localizer.localize(\'normalized_power_legal_notice\') %>&nbsp;<a href="http://trainingpeaks.com/" class="colored" target="_blank">Peaksware, LLC</a>.\n        </div>\n    <% } %>\n\n    <div id="reportActivityList" style="display:none;"></div>\n<!--</div>-->\n<% } else { %>\n<!-- Page markup stops here -->\n\n\n<!-- Widget markup starts here -->\n<% if (report.metricName === \'ACTIVITY_VO2_MAX\' || report.metricName === \'ACTIVITY_VO2_MAX_CYCLING\') { %>\n\n<div class="data-block medium vo2-title-block">\n    <h3 class="data-bit"><a href="<%= url(reportUrl) %>" class="js-select-report"><%= report.metricName === \'ACTIVITY_VO2_MAX\' ? Localizer.localize(\'ACTIVITY_VO2_MAX\') : Localizer.localize(\'vo2_max_cycling_title\') %></a>\n        <a data-toggle="modal" class="help-icon vo2-max-help-modal"><i class="icon-help"></i></a>\n    </h3>\n    <span class="data-label js-report-date-range"></span>\n</div>\n\n<% } else if (report.metricName === \'ACTIVITY_MAX_FTP\') { %>\n\n<div class="data-1 max-ftp">\n    <h3 class="data-bit">\n        <abbr class="has-tooltip" title="<%= Localizer.localize(report.metricName) %>">\n            <a href="<%= url(reportUrl) %>"><%= Localizer.localize(\'widget_title_\'+report.metricName) %></a>\n        </abbr>\n        <span class="js-popup-placeholder"></span>\n    </h3>\n    <span class="data-label js-report-date-range"></span>\n</div>\n\n<% } else if (report.metricName === \'ACTIVITY_AEROBIC_TRAINING_EFFECT\' || report.metricName === \'ACTIVITY_ANAEROBIC_TRAINING_EFFECT\' ) { %>\n    <div class="data-1">\n        <h3 class="data-bit">\n            <a href="<%= url(reportUrl) %>" title="<%= Localizer.localize(report.metricName) %>" class="js-select-report"><%= Localizer.localize(report.metricName) %></a>\n            <a href="#modal-help-te" data-toggle="modal" class="help-icon te-help" title="<%= Localizer.localize(\'TRAINING_EFFECT_HELP\') %>"><span class="icon-help"></span></a>\n        </h3>\n        <span class="data-label js-report-date-range"></span>\n    </div>\n\n<% } else if (report.metricName === \'ACTIVITY_TRAINING_STATUS\') { %>\n    <div class="data-1">\n        <h3 class="data-bit">\n            <a href="<%= url(reportUrl) %>" title="<%= Localizer.localize(report.metricName) %>" class="js-select-report"><%= Localizer.localize(report.metricName) %></a>\n            <a href="#modal-help-ts" data-toggle="modal" class="help-icon ts-help" title="<%= Localizer.localize(\'TRAINING_STATUS_HELP\') %>"><span class="icon-help"></span></a>\n        </h3>\n    </div>\n\n<% } else if (report.metricName === \'ACTIVITY_HRV_STRESS_TEST\' ) { %>\n<div class="data-1">\n    <h3 class="data-bit">\n        <a href="<%= url(reportUrl) %>" title="<%= Localizer.localize(report.metricName) %>" class="js-select-report"><%= Localizer.localize(report.metricName) %></a>\n        <a href="#modal-help-hrv" data-toggle="modal" class="help-icon hrv-help" title="<%= Localizer.localize(\'learn_more_about_hrv_stress\') %>"><span class="icon-help"></span></a>\n    </h3>\n    <span class="data-label js-report-date-range"></span>\n</div>\n\n<% } else { %>\n<div class="data-1">\n    <h3 class="data-bit"><a href="<%= url(reportUrl) %>" title="<%= Localizer.localize(report.metricName) %>" class="js-select-report">\n        <%= Localizer.localize(report.metricName) %>\n    </a></h3>\n    <span class="data-label js-report-date-range"></span>\n</div>\n\n<% } %>\n\n<div class="text-center vo2-sport-filter" style="display: none">\n    <div class="btn-group btn-group-pill widget-filter vo2-widget-filter" data-toggle="buttons-radio">\n        <button class="btn btn-small vo2-sport-filter-cycling"><%= Localizer.localize(\'activity_type_cycling\') %></button>\n        <button class="btn btn-small vo2-sport-filter-running"><%= Localizer.localize(\'activity_type_running\') %></button>\n    </div>\n</div>\n<div class="text-center ftp-filter" style="display: none">\n    <div class="btn-group btn-group-pill widget-filter ftp-widget-filter">\n        <button class="btn btn-small ftp-watts"><%= Localizer.localize(\'label_power_unit\') %></button>\n        <button class="btn btn-small ftp-watts-kg"><%= Localizer.localize(\'label_power_kg\') %></button>\n    </div>\n</div>\n\n<% if (report.metricName === \'ACTIVITY_TRAINING_STATUS\') { %>\n    <div id="widget-current-status-container" class="training-status-container"></div>\n<% } else { %>\n    <div class="chart-container">\n        <div class="chart chart-widget chart-stacked-report">\n            <span class="additionalPlaceHolder"></span>\n            <span class="reportChartPlaceholder"></span>\n        </div>\n    </div>\n<% } %>\n\n<div class="row-fluid js-report-summary" style="display: none">\n    <div class="span6">\n        <div class="data-1">\n            <div class="h5 data-bit js-report-total-value"></div>\n            <span class="data-label"><%= Localizer.localize(\'total\') %></span>\n        </div>\n    </div>\n    <div class="span6">\n        <div class="data-1 pull-right">\n            <div class="h5 data-bit js-report-avg-value"></div>\n            <span class="data-label"><%= Localizer.localize(\'daily.avg\') %></span>\n        </div>\n    </div>\n</div>\n\n<% } %>\n<!-- Widget markup stops here -->'}),define("views/report/ReportControllerView",["require","underscore","backbone","localizer","personalizer","views/report/ActivityChartView","views/report/ExerciseFilterView","views/report/FloorsClimbedChartView","views/report/FoodChartView","views/report/AllDayStressChartView","views/report/FTPChartView","views/report/FTPLegendView","views/report/FTPMaxInfoView","views/report/FTPTrendChartView","views/report/FTPWeightView","views/report/HeartRateTrendChartView","views/report/HRVStressReportView","views/report/HRVStressReportInfoView","views/report/HRVInfoPopUpView","views/report/IntensityMinutesChartView","views/report/LactateThresholdChartView","views/report/PowerChartView","views/report/RepCountingChartView","views/report/ReportActivityListView","views/report/ReportComparisonView","views/report/ReportEmptyChartView","views/report/ScatterChartView","views/report/SleepChartView","views/report/StepChartView","views/report/SwimChartView","views/report/TotalCaloriesChartView","views/report/TrainingStatusCurrentView","views/report/TrainingStatusReportHeaderView","views/report/TrainingStatusReportView","views/report/TrainingStatusModalView","views/report/Vo2MaxChartView","views/report/Vo2MaxDynamicTextView","views/report/Vo2MaxModalView","views/report/Vo2MaxTrendChartView","views/main/Modal/ModalPopupView","views/report/TrainingEffectMostRecentView","views/report/TrainingEffectColumnChartView","pages/activity_details_2/views/stat_views/TrainingEffectModalView","collections/activity/ActivitiesByActivityType","collections/reports/ReportMetrics","collections/reports/RepCountingStatistics","collections/reports/MetricColorRanges","collections/vo2max/Vo2MaxCategories","models/user/ViewerUserBiometrics","models/user/ViewerSocialProfile","models/user/UserPreference","models/reports/ReportMetric","models/wellness/AverageSteps","models/vo2max/Vo2MaxMetrics","models/reports/MostRecentTrainingStatuses","models/reports/TrainingStatuses","utils/ReportChartUtil","utils/ChartTypes","utils/ReportTypes","utils/ReportTypeMetricIds","utils/Vo2MaxAgeRangeMapper","utils/ModelSynchronizer","utils/NavigationUtil","utils/AnalyticsUtil","utils/date/DateParser","utils/date/DateFormatter","moment","utils/ToolTipUtil","text!templates/report/reportController.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("personalizer"),s=e("views/report/ActivityChartView"),o=e("views/report/ExerciseFilterView"),u=e("views/report/FloorsClimbedChartView"),a=e("views/report/FoodChartView"),f=e("views/report/AllDayStressChartView"),l=e("views/report/FTPChartView"),c=e("views/report/FTPLegendView"),h=e("views/report/FTPMaxInfoView"),p=e("views/report/FTPTrendChartView"),d=e("views/report/FTPWeightView"),v=e("views/report/HeartRateTrendChartView"),m=e("views/report/HRVStressReportView"),g=e("views/report/HRVStressReportInfoView"),y=e("views/report/HRVInfoPopUpView"),b=e("views/report/IntensityMinutesChartView"),w=e("views/report/LactateThresholdChartView"),E=e("views/report/PowerChartView"),S=e("views/report/RepCountingChartView"),x=e("views/report/ReportActivityListView"),T=e("views/report/ReportComparisonView"),N=e("views/report/ReportEmptyChartView"),C=e("views/report/ScatterChartView"),k=e("views/report/SleepChartView"),L=e("views/report/StepChartView"),A=e("views/report/SwimChartView"),O=e("views/report/TotalCaloriesChartView"),M=e("views/report/TrainingStatusCurrentView"),_=e("views/report/TrainingStatusReportHeaderView"),D=e("views/report/TrainingStatusReportView"),P=e("views/report/TrainingStatusModalView"),H=e("views/report/Vo2MaxChartView"),B=e("views/report/Vo2MaxDynamicTextView"),j=e("views/report/Vo2MaxModalView"),F=e("views/report/Vo2MaxTrendChartView"),I=e("views/main/Modal/ModalPopupView"),q=e("views/report/TrainingEffectMostRecentView"),R=e("views/report/TrainingEffectColumnChartView"),U=e("pages/activity_details_2/views/stat_views/TrainingEffectModalView"),z=e("collections/activity/ActivitiesByActivityType"),W=e("collections/reports/ReportMetrics"),X=e("collections/reports/RepCountingStatistics"),V=e("collections/reports/MetricColorRanges"),$=e("collections/vo2max/Vo2MaxCategories"),J=e("models/user/ViewerUserBiometrics"),K=e("models/user/ViewerSocialProfile"),Q=e("models/user/UserPreference"),G=e("models/reports/ReportMetric"),Y=e("models/wellness/AverageSteps"),Z=e("models/vo2max/Vo2MaxMetrics"),et=e("models/reports/MostRecentTrainingStatuses"),tt=e("models/reports/TrainingStatuses"),nt=e("utils/ReportChartUtil"),rt=e("utils/ChartTypes"),it=e("utils/ReportTypes"),st=e("utils/ReportTypeMetricIds"),ot=e("utils/Vo2MaxAgeRangeMapper"),ut=e("utils/ModelSynchronizer"),at=e("utils/NavigationUtil"),ft=e("utils/AnalyticsUtil"),lt=e("utils/date/DateParser"),ct=e("utils/date/DateFormatter"),ht=e("moment"),pt=e("utils/ToolTipUtil"),dt=e("text!templates/report/reportController.html"),vt={ON_VO2_MAX_SHOW_COMPARE:"ON_VO2_MAX_SHOW_COMPARE",ON_VO2_MAX_TOGGLE:"ON_VO2_MAX_TOGGLE",ON_TAB_CHANGED:"ON_TAB_CHANGED",ON_FTP_MAX_TOGGLE:"ON_FTP_MAX_TOGGLE",DISPLAY_FTP_WEIGHT:"DISPLAY_FTP_WEIGHT",FTP_WEIGHT_ENTERED:"FTP_WEIGHT_ENTERED",MODEL_SYNC_FAIL:"MODEL_SYNC_FAIL"},mt="2006-01-01",gt=n.View.extend({events:{"click .js-current":"onCurrentClicked","click .js-last_seven_days":"onSevenDaysClicked","click .js-last_four_weeks":"onFourWeeksClicked","click .js-last_six_months":"onSixMonthsClicked","click .js-last_year":"onTwelveMonthsClicked","click .js-today-btn":"onTodayButtonClicked","click .icon-arrow-left":"onPreviousClicked","click .icon-arrow-right":"onNextClicked","click .vo2-widget-filter":"onVo2MaxFilterClicked","click .ftp-watts-kg":"onFtpMaxFilterClicked","click .ftp-watts":"onFtpMaxFilterClicked","click .ftp-watts-kg-trend":"onFtpTrendClicked","click .ftp-watts-trend":"onFtpTrendClicked","click .te-help":"onTEHelpClicked","click .ts-help":"onTSHelpClicked","click .hrv-help":"renderHRVInfoModal","click .modal-hrv-stress":"renderHRVInfoModal","click .vo2-max-help-modal":"onVo2MaxHelpModal","click .show-more":"onShowMoreClicked"},initialize:function(e){this.template=t.template(dt),this.reports=e.reports,this.report=e.report,this.reportType=e.reportType,this.chartFormat=e.chartFormat,this.userPreferences=e.userPreferences,this.displayName=e.displayName,this.activeTab=e.activeTab,this.vo2MaxToggle=e.vo2MaxToggle,this.ftpMaxToggle=e.ftpMaxToggle,this.profileId=K.get("profileId"),this.reportMetricsFetched=!1,this.vo2MaxDataFetched=!1,this.metricColorRangesFetched=!1,this.reportAveragesFetched=!1,this.pageOffset=0,this.displayGaugeChart=!0,this.displayTEGaugeChart=!1,this.trainingEffectMetricPeriod=!1,this.hrvStressReportMetricPeriod=!1,this.showAnaerobicTE=!0,this.showAerobicTE=!0,this.lactateThreshold=this.report.get("metricName")==it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM||this.report.get("metricName")==it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC,this.trainingStatusData=null,this.prevRecordedDevices=null,this.mostRecentStatuses=null,this.activityTypes=e.activityTypes,this.activityListEnabled=e.activityListEnabled},render:function(){this.reportUrl="/report/"+this.report.get("metricId")+"/"+this.reportType+(this.lactateThreshold&&this.activeTab=="current"?"/last_four_weeks":"/"+this.activeTab);var e=this.template({Localizer:r,Personalizer:i,chartFormat:this.chartFormat,report:this.report.toJSON(),activeTab:this.activeTab,url:at.url,reportUrl:this.reportUrl});jQuery(this.el).html(e),this.$(".vo2-info-trigger").hide(),this.$(".ftp-filter").hide(),this.$(".hrv-info-trigger").hide();if(this.report.get("metricName")===it.ACTIVITY_VO2_MAX||this.report.get("metricName")===it.ACTIVITY_VO2_MAX_CYCLING){if(!this.activeTab||this.activeTab==="undefined")this.activeTab="current";this.$("#tab-pane0").show(),this.vo2MaxToggle?this.$(".vo2-sport-filter-"+this.vo2MaxToggle).addClass("active"):this.$(".vo2-sport-filter-running").addClass("active"),this.hideSevenDayTab()}else if(this.report.get("metricName")===it.ACTIVITY_MAX_FTP){if(!this.activeTab||this.activeTab==="undefined")this.activeTab="current";this.$("#tab-pane0").show(),this.ftpMaxToggle?this.$("."+this.ftpMaxToggle).addClass("active"):this.$(".ftp-watts").addClass("active"),this.hideSevenDayTab()}else if(this.report.get("metricName")===it.ACTIVITY_AEROBIC_TRAINING_EFFECT||this.report.get("metricName")===it.ACTIVITY_ANAEROBIC_TRAINING_EFFECT){if(!this.activeTab||this.activeTab==="undefined")this.activeTab="current";this.$("#tab-pane0").show(),this.hideSixMonthsTab(),this.hideTwelveMonthsTab()}else if(this.report.get("metricName")===it.ACTIVITY_TRAINING_STATUS){if(!this.activeTab||this.activeTab==="undefined")this.activeTab="last_four_weeks";this.$("#tab-pane0").hide(),this.hideSevenDayTab()}else if(this.report.get("metricName")===it.ACTIVITY_HRV_STRESS_TEST){if(!this.activeTab||this.activeTab==="undefined")this.activeTab="last_seven_days";this.$("#tab-pane0").hide(),this.hideSixMonthsTab(),this.hideTwelveMonthsTab()}else{this.vo2MaxToggle="",this.ftpMaxToggle="";if(!this.activeTab||this.activeTab=="undefined")this.activeTab="last_seven_days";this.$("#tab-pane0").hide()}this.determineActiveTab();switch(this.activeTab){case"current":this.processCurrentTab();break;case"last_seven_days":this.processSevenDayTab();break;case"last_four_weeks":this.processFourWeekTab();break;case"last_six_months":this.processSixMonthTab();break;case"last_year":this.processTwelveMonthTab()}if(this.report.get("metricName")===it.ACTIVITY_MAX_FTP){var t=new h({el:this.$(".js-popup-placeholder"),report:this.report,chartFormat:this.chartFormat});t.render()}else if(this.report.get("metricName")==it.ACTIVITY_HRV_STRESS_TEST){var n=new g({el:this.$(".js-popup-placeholder")});n.render()}pt.renderTooltips.call(this)},hideSevenDayTab:function(){this.chartFormat==="page"&&(this.$(".js-last_seven_days").hide(),this.activeTab==="last_seven_days"&&(this.activeTab="last_four_weeks"))},hideSixMonthsTab:function(){this.chartFormat==="page"&&(this.$(".js-last_six_months").hide(),this.activeTab==="last_six_months"&&(this.activeTab="last_seven_days"))},hideTwelveMonthsTab:function(){this.chartFormat==="page"&&(this.$(".js-last_year").hide(),this.activeTab==="last_year"&&(this.activeTab="last_seven_days"))},determineActiveTab:function(){var e=1;switch(this.activeTab){case"current":e=0;break;case"last_seven_days":e=1;break;case"last_four_weeks":e=2;break;case"last_six_months":e=3;break;case"last_year":e=4}this.$("#tab-pane"+e).addClass("active"),this.$("#pane"+e).addClass("active")},processCurrentTab:function(){this.displayGaugeChart=!0,this.tabSelection="current";switch(this.report.get("chartType")){case rt.BAR:case rt.BAR_STACKED:case rt.LINE_WITH_GAUGE:case rt.LINE_MULTI_GROUPED:this.metricPeriod="daily";break;case rt.LINE:case rt.SCATTERED_WITH_AVG:case rt.BAR_NEGATIVE_STACKED:case rt.PIE:this.report.get("metricName").indexOf("SLEEP")==0||this.report.get("metricName").indexOf("RESTING_HEART_RATE")!=-1||this.report.get("metricName").indexOf("FOOD")==0?this.metricPeriod="daily":this.metricPeriod="all"}this.displayPeriod="daily",this.report.get("metricName")===it.ACTIVITY_AEROBIC_TRAINING_EFFECT||this.report.get("metricName")===it.ACTIVITY_ANAEROBIC_TRAINING_EFFECT?(this.displayTEGaugeChart=!0,this.startDateOffset=-365*(this.pageOffset+1)+1,this.currentDateOffset=-365*this.pageOffset,this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod),this.untilDate=nt.formatDate(this.currentDateOffset)):(this.startDate=nt.formatDate(0),this.untilDate=nt.formatDate(0)),Date.parse(this.startDate)<=Date.parse(mt)&&(this.startDate=mt),this.retrieveChartMetrics(),this.resetReportUrl()},processSevenDayTab:function(){this.displayGaugeChart=!1,this.displayTEGaugeChart=!1,this.trainingEffectMetricPeriod=!0,this.hrvStressReportMetricPeriod=!0,this.tabSelection="seven-day",this.displayPeriod="daily";switch(this.report.get("chartType")){case rt.BAR:case rt.BAR_STACKED:case rt.LINE_WITH_GAUGE:case rt.LINE_MULTI_GROUPED:case rt.PIE:this.metricPeriod="daily";break;case rt.LINE:case rt.SCATTERED_WITH_AVG:case rt.BAR_NEGATIVE_STACKED:this.report.get("metricName").indexOf("SLEEP")==0||this.report.get("metricName").indexOf("RESTING_HEART_RATE")!=-1||this.report.get("metricName").indexOf("WELLNESS_AVERAGE_STRESS")!==-1||this.report.get("metricName").indexOf("FOOD")==0||this.report.get("metricName")===it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC||this.report.get("metricName")===it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM?this.metricPeriod="daily":this.metricPeriod="all";break;case rt.NONSTANDARD:this.metricPeriod="daily"}if(this.report.get("metricName")===it.ACTIVITY_AEROBIC_TRAINING_EFFECT||this.report.get("metricName")===it.ACTIVITY_ANAEROBIC_TRAINING_EFFECT)this.metricPeriod="all";this.report.get("metricName")===it.ACTIVITY_HRV_STRESS_TEST&&(this.metricPeriod="daily");if(this.report.get("metricName")===it.WELLNESS_MODERATE_INTENSITY_MINUTES){var e=1-(new Date).getDay();e>0&&(e-=7),this.startDateOffset=e+ -7*this.pageOffset,this.currentDateOffset=e+6+ -7*this.pageOffset}else this.startDateOffset=-7*(this.pageOffset+1)+1,this.currentDateOffset=-7*this.pageOffset;this.startDate=nt.formatDate(this.startDateOffset),this.untilDate=nt.formatDate(this.currentDateOffset),Date.parse(this.startDate)<=Date.parse(mt)&&(this.startDate=mt),this.retrieveChartMetrics(),this.resetReportUrl()},processFourWeekTab:function(){this.displayGaugeChart=!1,this.displayTEGaugeChart=!1,this.trainingEffectMetricPeriod=!1,this.hrvStressReportMetricPeriod=!1,this.tabSelection="four-week";switch(this.report.get("chartType")){case rt.BAR:case rt.BAR_STACKED:case rt.LINE_WITH_GAUGE:case rt.LINE_MULTI_GROUPED:this.metricPeriod="weekly";break;case rt.LINE:case rt.SCATTERED_WITH_AVG:case rt.BAR_NEGATIVE_STACKED:case rt.PIE:this.report.get("metricName").indexOf("SLEEP")==0||this.report.get("metricName").indexOf("FOOD")==0?this.metricPeriod="daily":this.report.get("metricName").indexOf("RESTING_HEART_RATE")!=-1||this.report.get("metricName").indexOf("WELLNESS_AVERAGE_STRESS")!==-1||this.report.get("metricName")===it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC||this.report.get("metricName")===it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM?this.metricPeriod="weekly":this.metricPeriod="all";break;default:this.metricPeriod="weekly"}if(this.report.get("metricName")===it.ACTIVITY_AEROBIC_TRAINING_EFFECT||this.report.get("metricName")===it.ACTIVITY_ANAEROBIC_TRAINING_EFFECT)this.metricPeriod="all";this.metricPeriod==="weekly"?(this.startDateOffset=-28*(this.pageOffset+1)+1,this.currentDateOffset=-28*this.pageOffset,this.untilDate=nt.formatAdjustedStartDate(this.currentDateOffset,this.userPreferences,this.metricPeriod),this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)):(this.startDateOffset=-30*(this.pageOffset+1)+1,this.currentDateOffset=-30*this.pageOffset,this.startDate=nt.formatDate(this.startDateOffset),this.untilDate=nt.formatDate(this.currentDateOffset)),this.displayPeriod="weekly",Date.parse(this.startDate)<=Date.parse(mt)&&(this.startDate=mt),this.report.get("metricName")===it.ACTIVITY_HRV_STRESS_TEST&&(this.metricPeriod="daily"),this.retrieveChartMetrics(),this.resetReportUrl()},processSixMonthTab:function(){this.displayGaugeChart=!1,this.tabSelection="six-month",this.startDateOffset=-180*(this.pageOffset+1)+1,this.currentDateOffset=-180*this.pageOffset;switch(this.report.get("chartType")){case rt.BAR:case rt.BAR_STACKED:case rt.LINE_WITH_GAUGE:case rt.LINE_MULTI_GROUPED:this.metricPeriod="monthly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod);break;case rt.PIE:this.metricPeriod="daily",this.startDate=nt.formatDate(this.startDateOffset);break;case rt.LINE:case rt.SCATTERED_WITH_AVG:case rt.BAR_NEGATIVE_STACKED:this.report.get("metricName").indexOf("SLEEP_DURATION")>-1?(this.metricPeriod="weekly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)):this.report.get("metricName").indexOf("_HEART_RATE")!=-1||this.report.get("metricName").indexOf("WELLNESS_AVERAGE_STRESS")!==-1||this.report.get("metricName")===it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC||this.report.get("metricName")===it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM?(this.metricPeriod="monthly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)):this.chartFormat=="widget"?(this.metricPeriod="weekly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)):this.report.get("metricName").indexOf("FOOD")==0?(this.metricPeriod="daily",this.startDate=nt.formatDate(this.startDateOffset)):(this.metricPeriod="monthly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod));break;default:this.metricPeriod="monthly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)}this.displayPeriod="monthly",this.untilDate=nt.formatDate(this.currentDateOffset),Date.parse(this.startDate)<=Date.parse(mt)&&(this.startDate=mt),this.retrieveChartMetrics(),this.resetReportUrl()},processTwelveMonthTab:function(){this.displayGaugeChart=!1,this.tabSelection="twelve-month",this.startDateOffset=-365*(this.pageOffset+1)+1,this.currentDateOffset=-365*this.pageOffset;switch(this.report.get("chartType")){case rt.BAR:case rt.BAR_STACKED:case rt.LINE_WITH_GAUGE:case rt.LINE_MULTI_GROUPED:this.metricPeriod="yearly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod);break;case rt.PIE:this.metricPeriod="daily",this.startDate=nt.formatDate(this.startDateOffset);break;case rt.LINE:case rt.SCATTERED_WITH_AVG:case rt.BAR_NEGATIVE_STACKED:this.report.get("metricName").indexOf("SLEEP_DURATION")>-1?(this.metricPeriod="weekly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)):this.report.get("metricName")===it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC||this.report.get("metricName")===it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM?(this.metricPeriod="yearly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)):this.report.get("metricName").indexOf("_HEART_RATE")!=-1||this.report.get("metricName").indexOf("WELLNESS_AVERAGE_STRESS")!==-1?(this.metricPeriod="monthly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)):this.chartFormat=="widget"?(this.metricPeriod="weekly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)):this.report.get("metricName").indexOf("FOOD")==0?(this.metricPeriod="daily",this.startDate=nt.formatDate(this.startDateOffset)):(this.metricPeriod="monthly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod));break;default:this.metricPeriod="monthly",this.startDate=nt.formatAdjustedStartDate(this.startDateOffset,this.userPreferences,this.metricPeriod)}this.displayPeriod="yearly",this.untilDate=nt.formatDate(this.currentDateOffset),Date.parse(this.startDate)<=Date.parse(mt)&&(this.startDate=mt),this.retrieveChartMetrics(),this.resetReportUrl()},resetReportUrl:function(){this.ftpMaxToggle?this.reportUrl="/report/"+this.report.get("metricId")+"/"+this.reportType+"/"+this.activeTab+"/"+this.ftpMaxToggle:+this.report.get("metricId")<0?this.reportUrl="/report/"+this.report.get("metricName").toLowerCase()+"/"+this.reportType+"/"+this.activeTab:this.reportUrl="/report/"+this.report.get("metricId")+"/"+this.reportType+(this.lactateThreshold&&this.activeTab==="current"?"/last_four_weeks":"/"+this.activeTab),this.$(".js-select-report").attr("href",at.url(this.reportUrl))},retrieveChartMetrics:function(){var e,t=new ut,n=this;if(this.report.get("metricName")==it.ACTIVITY_VERTICAL_OSCILLATION||this.report.get("metricName")==it.ACTIVITY_GROUND_CONTACT_TIME||this.report.get("metricName")==it.ACTIVITY_AVERAGE_RUN_CADENCE||this.report.get("metricName")==it.ACTIVITY_HRV_STRESS_TEST){this.metricColorRangesFetched=!1;var r=new V({metricName:this.report.get("metricName")});t.addModel({model:r,required:!0}),t.bind(ut.Events.SYNCHRONIZED,function(){n.onMetricColorRangeReadyToRender(r)},this)}else this.metricColorRangesFetched=!0;this.reportMetricsFetched=!1,this.report.get("metricName").indexOf("ACTIVITY")==0?this.metricType="activities":this.metricType="wellness",this.report.get("metricName")===it.ACTIVITY_NUMBER_OF_ACTIVITIES||this.report.get("metricName")===it.ACTIVITY_ACTIVE_CALORIES||this.report.get("metricName")===it.ACTIVITY_TOTAL_DISTANCE||this.report.get("metricName")===it.ACTIVITY_TOTAL_DURATION?this.groupResults=!0:this.groupResults=!1;if(this.report.get("metricName")===it.ACTIVITY_NUMBER_OF_ACTIVITIES||this.report.get("metricName")===it.ACTIVITY_ACTIVE_CALORIES||this.report.get("metricName")===it.ACTIVITY_TOTAL_DISTANCE||this.report.get("metricName")===it.ACTIVITY_TOTAL_DURATION||this.report.get("metricName")===it.STRENGTH_TRAINING&&this.chartFormat==="page"&&this.activityListEnabled){var i=ct.formatConnectTimestamp(lt.parseISO(this.startDate)),s=ht(lt.parseISO(this.untilDate)).endOf("day");s=ct.formatConnectTimestamp(s.toDate()),this.aggregation=this.metricPeriod==="monthly"||this.metricPeriod==="yearly"?"monthly":"weekly",this.activityList=new z(null,{displayName:this.displayName,activityTypeId:this.reportType!=="all"?this.activityTypes.findByTypeKey(this.reportType).get("typeId"):null,fetchSize:5,startTimestampLocal:i,endTimestampLocal:s}),t.addModel({model:this.activityList,required:!0})}if(this.report.get("metricName")===it.ACTIVITY_TRAINING_STATUS)this.chartFormat==="widget"?e=new et({calendarDate:nt.formatDate(0)}):(this.mostRecentStatuses===null&&(this.mostRecentStatuses=new et({calendarDate:nt.formatDate(0)}),t.addModel({model:this.mostRecentStatuses,required:!0})),this.vo2Metrics=new W({metricId:it.ACTIVITY_VO2_MAX,metricType:this.metricType,metricPeriod:this.metricPeriod==="weekly"?"daily":"weekly",startDate:this.startDate,untilDate:this.untilDate,groupResults:this.groupResults,metricIdList:this.buildMetricIdList(),activityIdList:this.buildActivityIdList()}),this.vo2Metrics.setDisplayName(this.userPreferences.get("displayName")),t.addModel({model:this.vo2Metrics,required:!0}),e=new tt({metricPeriod:this.metricPeriod,displayName:this.displayName,startDate:this.startDate,endDate:this.untilDate}));else if(this.report.get("metricName")===it.STRENGTH_TRAINING){var o="daily";if(this.metricPeriod==="monthly"||this.metricPeriod==="yearly")o="monthly";this.aggregation=o,e=new X({aggregation:o,startDate:this.startDate,untilDate:this.untilDate})}else e=new W({metricId:this.report.get("metricName"),metricType:this.metricType,metricPeriod:this.metricPeriod,startDate:this.startDate,untilDate:this.untilDate,groupResults:this.groupResults,metricIdList:this.buildMetricIdList(),activityIdList:this.buildActivityIdList()});e.setDisplayName(this.userPreferences.get("displayName")),t.addModel({model:e,required:!0}),t.bind(ut.Events.SYNCHRONIZED,function(){n.onReportMetricsReadyToRender(e)},this);if(this.report.get("metricName")===it.WELLNESS_TOTAL_STEPS&&this.chartFormat==="widget"){this.reportAveragesFetched=!1;var u=new Y({displayName:this.displayName,startDate:this.startDate,endDate:this.untilDate});t.addModel({model:u,required:!0}),t.bind(ut.Events.SYNCHRONIZED,function(){n.onReportAveragesReadyToRender(u)},this)}else this.reportAveragesFetched=!0;t.fetchModels()},buildMetricIdList:function(){var e=[],t;if(this.report.get("metricId")){t=this.report.get("metricName");switch(t){case it.COMMON_TOTAL_CALORIES:e.push(this.report.get("metricId")),e.push(st.COMMON_ACTIVE_CALORIES),e.push(st.WELLNESS_BMR_CALORIES);break;case it.WELLNESS_TOTAL_STEPS:e.push(this.report.get("metricId")),e.push(st.WELLNESS_TOTAL_STEP_GOAL);break;case it.WELLNESS_FLOORS_ASCENDED:e.push(this.report.get("metricId")),e.push(st.WELLNESS_FLOORS_DESCENDED),e.push(st.WELLNESS_USER_FLOORS_ASCENDED_GOAL);break;case it.WELLNESS_MODERATE_INTENSITY_MINUTES:e.push(st.WELLNESS_MODERATE_INTENSITY_MINUTES),e.push(st.WELLNESS_VIGOROUS_INTENSITY_MINUTES),e.push(st.WELLNESS_USER_INTENSITY_MINUTES_GOAL);break;case it.ACTIVITY_TRAINING_STRESS_SCORE:e.push(this.report.get("metricId")),e.push(st.ACTIVITY_INTENSITY_FACTOR);break;case it.ACTIVITY_AVERAGE_PACE:case it.ACTIVITY_AVERAGE_SPEED:case it.ACTIVITY_AVERAGE_SWIM_PACE:e.push(this.report.get("metricId")),e.push(st.ACTIVITY_TOTAL_DISTANCE),e.push(st.ACTIVITY_TOTAL_DURATION);break;case it.ACTIVITY_VO2_MAX:case it.ACTIVITY_VO2_MAX_CYCLING:case it.ACTIVITY_TRAINING_STATUS:this.vo2MaxMetricIdList(e);break;case it.ACTIVITY_AEROBIC_TRAINING_EFFECT:case it.ACTIVITY_ANAEROBIC_TRAINING_EFFECT:e.push(st.ACTIVITY_AEROBIC_TRAINING_EFFECT),e.push(st.ACTIVITY_ANAEROBIC_TRAINING_EFFECT);break;case it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM:case it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC:this.lactateMetricIdList(e);case it.ACTIVITY_HRV_STRESS_TEST:e.push(this.report.get("metricId"));break;default:e.push(this.report.get("metricId"))}}return e},vo2MaxMetricIdList:function(e){return(this.reportType==="wellness"||this.reportType==="running"||this.reportType==="all")&&e.push(st.ACTIVITY_VO2_MAX),(this.reportType==="cycling"||this.reportType==="all")&&e.push(st.ACTIVITY_VO2_MAX_CYCLING),e},lactateMetricIdList:function(e){var n=null,r=this.reports.get("runningMetricsAvailability");return this.report.get("metricName")===it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM?n=t.find(r,function(e){return e.metric.metricName===it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC&&e.available===!0}):this.report.get("metricName")===it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC&&(n=t.find(r,function(e){return e.metric.metricName===it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM&&e.available===!0})),n&&e.push(n.metric.metricId),e.push(this.report.get("metricId")),e},buildActivityIdList:function(){var e=[];switch(this.reportType){case"running":e.push(1);break;case"cycling":e.push(2);break;case"swimming":e.push(26);break;case"yoga":e.push(this.activityTypes.findByTypeKey("yoga").get("typeId"))}return e},buildPrevRecordedDevices:function(){this.prevRecordedDevices===null?this.prevRecordedDevices=this.reportMetrics.attributes.recordedDevices:this.prevRecordedDevices=this.trainingStatusData.attributes.recordedDevices},buildTrainingStatusData:function(){var e,t,n,r=!1,i={};i.attributes={},i.attributes.recordedDevices=[],i.attributes.reportData={},i.attributes.latestTrainingStatusData={},i.attributes.reportData=this.reportMetrics.get("reportData"),i.attributes.latestTrainingStatusData=this.mostRecentStatuses.get("latestTrainingStatusData");if(this.prevRecordedDevices===null)i.attributes.recordedDevices=this.reportMetrics.get("recordedDevices");else{for(n=0;n<this.reportMetrics.get("recordedDevices").length;n++)i.attributes.recordedDevices.push(this.reportMetrics.get("recordedDevices")[n]);for(e=0;e<this.prevRecordedDevices.length;e++){r=!1;for(t=0;t<this.reportMetrics.get("recordedDevices").length;t++)if(this.prevRecordedDevices[e].deviceId===this.reportMetrics.get("recordedDevices")[t].deviceId){r=!0;break}r||i.attributes.recordedDevices.push(this.prevRecordedDevices[e])}}return i},onReportMetricsReadyToRender:function(e){this.reportMetrics=e,this.reportMetricsFetched=!0,this.readyToRender()},onReportAveragesReadyToRender:function(e){this.averageSteps=e,this.reportAveragesFetched=!0,this.readyToRender()},onVo2MaxDataReadyToRender:function(e,t){this.vo2MaxCategories=e,this.vo2MaxMetrics=t,this.currentVo2Max=t.get("generic")?t.get("generic").vo2MaxValue:null,this.currentVo2MaxCycling=t.get("cycling")?t.get("cycling").vo2MaxValue:null,this.vo2MaxDataFetched=!0,this.readyToRender()},onMetricColorRangeReadyToRender:function(e){this.metricColorRanges=e,this.metricColorRangesFetched=!0,this.readyToRender()},readyToRender:function(){this.report.get("metricName")===it.ACTIVITY_VO2_MAX||this.report.get("metricName")===it.ACTIVITY_VO2_MAX_CYCLING?this.vo2MaxDataFetched?this.determineChartView():this.setVo2MaxProperties():this.reportMetricsFetched&&this.metricColorRangesFetched&&this.reportAveragesFetched&&this.determineChartView()},setVo2MaxProperties:function(){var e=i.calculateAge(J.get("birthDate"));this.gender=J.get("gender")||"MALE",this.ageRange=J.get("birthDate")?ot.getAgeRange(e):"40-49",this.retrieveVo2MaxData()},retrieveVo2MaxData:function(){var e=this,t=new ut,n=new $([],{gender:this.gender,ageRange:this.ageRange}),r=new Z({});t.addModel({model:n,required:!0}),t.addModel({model:r,required:!0}),t.bind(ut.Events.SYNCHRONIZED,function(){e.onVo2MaxDataReadyToRender(n,r)},this),t.fetchModels()},determineChartView:function(){if(this.report.get("metricName")!==it.ACTIVITY_VO2_MAX&&this.report.get("metricName")!==it.ACTIVITY_VO2_MAX_CYCLING||this.activeTab!=="current")(this.lactateThreshold||this.ftpMaxToggle)&&this.activeTab=="current"?this.$(".js-report-date-range").html(r.localize("lactate.threshold.most.recent")):this.$(".js-report-date-range").html(nt.personalizeDateRange(this.startDate,this.untilDate,this.displayPeriod,this.metricPeriod,this.userPreferences));else{var e=this.vo2MaxMetrics.get("generic")?this.vo2MaxMetrics.get("generic").calendarDate:null,t=this.vo2MaxMetrics.get("cycling")?this.vo2MaxMetrics.get("cycling").calendarDate:null;e&&this.$(".js-report-date-range").html(ct.formatMonthDayOptionalYear(lt.parseISO(e))),this.reportType==="cycling"&&t&&this.$(".js-report-date-range").html(ct.formatMonthDayOptionalYear(lt.parseISO(t)))}this.pageOffset==0?(this.$(".js-today-btn").addClass("disabled"),this.$(".js-today-btn").attr("disabled",!0),this.$(".icon-arrow-right").addClass("disabled"),this.$(".icon-arrow-right").attr("disabled",!0)):(this.$(".js-today-btn").removeClass("disabled"),this.$(".js-today-btn").attr("disabled",!1),this.$(".icon-arrow-right").removeClass("disabled"),this.$(".icon-arrow-right").attr("disabled",!1)),Date.parse(this.startDate)<=Date.parse(mt)?(this.$(".icon-arrow-left").addClass("disabled"),this.$(".icon-arrow-left").attr("disabled",!0)):(this.$(".icon-arrow-left").removeClass("disabled"),this.$(".icon-arrow-left").attr("disabled",!1)),this.chartFormat==="page"?this.displayTEGaugeChart?this.chartPlaceholder="js-report-chart-current-te":this.chartPlaceholder="js-report-chart-"+this.tabSelection:this.chartPlaceholder="reportChartPlaceholder";switch(this.report.get("metricName")){case it.ACTIVITY_VO2_MAX:case it.ACTIVITY_VO2_MAX_CYCLING:this.processVo2MaxReport();break;case it.ACTIVITY_MAX_FTP:this.processFTPMaxChartView();break;case it.ACTIVITY_NUMBER_OF_ACTIVITIES:this.processActivityLineReport();break;case it.ACTIVITY_TOTAL_DISTANCE:case it.ACTIVITY_TOTAL_DURATION:case it.ACTIVITY_ACTIVE_CALORIES:this.processActivityColumnReport();break;case it.ACTIVITY_AVERAGE_STROKES:case it.ACTIVITY_AVERAGE_SWOLF:case it.ACTIVITY_MINIMUM_SWOLF:this.processSwimReport();break;case it.SLEEP_SLEEP_DURATION:this.processSleepReport();break;case it.WELLNESS_TOTAL_STEPS:this.processStepReport();break;case it.WELLNESS_FLOORS_ASCENDED:this.processFloorsReport();break;case it.WELLNESS_RESTING_HEART_RATE:this.processWellnessHRReport();break;case it.WELLNESS_AVERAGE_STRESS:this.processWellnessStressReport();break;case it.WELLNESS_MODERATE_INTENSITY_MINUTES:this.processIntensityMinutesReport();break;case it.COMMON_TOTAL_CALORIES:this.processTotalCalorieReport();break;case it.ACTIVITY_AVERAGE_SPEED:case it.ACTIVITY_AVERAGE_PACE:case it.ACTIVITY_AVERAGE_SWIM_PACE:case it.ACTIVITY_AVERAGE_HEART_RATE:case it.ACTIVITY_MAX_HEART_RATE:case it.ACTIVITY_AVERAGE_POWER:case it.ACTIVITY_AVERAGE_BIKE_CADENCE:case it.ACTIVITY_AVERAGE_RUN_CADENCE:case it.ACTIVITY_NORMALIZED_POWER:case it.ACTIVITY_MAX_20_MIN_AVERAGE_POWER:case it.ACTIVITY_VERTICAL_OSCILLATION:case it.ACTIVITY_GROUND_CONTACT_TIME:case it.ACTIVITY_AVG_STRIDE_LENGTH:case it.ACTIVITY_AVG_VERTICAL_RATIO:case it.ACTIVITY_AVG_GROUND_CONTACT_BALANCE:this.processScatterChartReport();break;case it.FOOD_CALORIES_CONSUMED:case it.FOOD_CALORIES_REMAINING:this.processFoodReport();break;case it.ACTIVITY_TRAINING_STRESS_SCORE:this.processPowerReport();break;case it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM:case it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC:this.processLactateThresholdChartReport();break;case it.ACTIVITY_AEROBIC_TRAINING_EFFECT:case it.ACTIVITY_ANAEROBIC_TRAINING_EFFECT:this.processTrainingEffectChartReports();break;case it.ACTIVITY_TRAINING_STATUS:this.processTrainingStatusReport();break;case it.ACTIVITY_HRV_STRESS_TEST:this.processHRVStressReport();break;case it.STRENGTH_TRAINING:this.processStrengthTrainingReport()}this.reportChartView.render()},processVo2MaxReport:function(){!this.displayGaugeChart||this.currentVo2Max&&this.currentVo2Max<=100||this.currentVo2MaxCycling&&this.currentVo2MaxCycling<100?(this.$(".vo2-info-trigger").show(),this.displayGaugeChart?(this.$(".vo2-max-help-modal").show(),this.$(".js-today-btn").hide(),this.$(".icon-arrow-left").hide(),this.$(".icon-arrow-right").hide(),this.$(".chart-widget").addClass("chart-gauge-vo2"),this.$(".chart-widget").removeClass("chart-stacked-report"),this.$(".vo2-title-block").removeClass("bottom-xs").addClass("bottom-none"),this.currentVo2Max&&this.currentVo2MaxCycling&&this.reportType==="all"&&this.$(".vo2-sport-filter").show(),this.chartFormat==="page"&&(this.$(".js-report-date-range").hide(),this.initializeVo2MaxDynamicTextView()),this.initializeVo2MaxChartView()):(this.$(".vo2-max-help-modal").show(),this.$(".js-report-date-range").show(),this.$(".js-today-btn").show(),this.$(".icon-arrow-left").show(),this.$(".icon-arrow-right").show(),this.$(".chart-widget").removeClass("chart-gauge-vo2"),this.$(".chart-widget").addClass("chart-stacked-report"),this.$(".vo2-title-block").removeClass("bottom-none").addClass("bottom-xs"),nt.determineNonZeroMetricsFound(this.reportMetrics,it.ACTIVITY_VO2_MAX_CYCLING)||nt.determineNonZeroMetricsFound(this.reportMetrics,it.ACTIVITY_VO2_MAX)?this.initializeChartView(F,"area",-27):(this.$(".chart-widget").addClass("chart-gauge-vo2"),this.initializeEmptyChartView()))):(this.$(".chart-widget").addClass("chart-gauge-vo2"),this.initializeEmptyChartView())},processActivityLineReport:function(){nt.determineNonZeroActivityMetricsFound(this.reportMetrics.toJSON(),it[this.report.get("metricName")])?(this.initializeChartView(s,"line",-27),this.processActivityList()):(this.initializeEmptyChartView(),this.$("#reportActivityList").hide())},processActivityColumnReport:function(){nt.determineNonZeroActivityMetricsFound(this.reportMetrics.toJSON(),it[this.report.get("metricName")])?(this.initializeChartView(s,"column",-27),this.processActivityList()):(this.initializeEmptyChartView(),this.$("#reportActivityList").hide())},processSwimReport:function(){nt.determineNonZeroMetricsFound(this.reportMetrics,it[this.report.get("metricName")])?this.initializeChartView(A,"column",-27):this.initializeEmptyChartView()},processSleepReport:function(){if(nt.determineNonZeroMetricsFound(this.reportMetrics,it[this.report.get("metricName")])){var e=-30;switch(this.displayPeriod){case"monthly":e=-185;break;case"yearly":e=-370}this.initializeChartView(k,"spline",e)}else this.initializeEmptyChartView()},processStepReport:function(){if(this.reportMetrics&&this.reportMetrics.length>0){if(this.chartFormat==="widget"){var e=this.reportMetrics.at(0),t=e.get("metricsMap"),n=t.WELLNESS_TOTAL_STEPS,r=0,s=this.averageSteps.get("averageSteps");if(n)for(var o=0;o<n.length;o++)r+=n[o].value;this.$(".js-report-total-value").html(jQuery.formatNumber(r,{format:"###,###,##0",locale:i.numberSeparator})),this.$(".js-report-avg-value").html(jQuery.formatNumber(s,{format:"#,###,##0",locale:i.numberSeparator})),this.$(".js-report-summary").show()}this.initializeChartView(L,"column",-27)}else this.initializeEmptyChartView()},processFloorsReport:function(){nt.determineNonZeroMetricsFound(this.reportMetrics,"WELLNESS_FLOORS_ASCENDED")?this.initializeChartView(u,"column",-27):this.initializeEmptyChartView()},processWellnessHRReport:function(){nt.determineNonZeroMetricsFound(this.reportMetrics,"WELLNESS_RESTING_HEART_RATE")?this.initializeChartView(v,"area",-27):this.initializeEmptyChartView()},processWellnessStressReport:function(){nt.determineNonZeroMetricsFound(this.reportMetrics,"WELLNESS_AVERAGE_STRESS")?this.initializeChartView(f,"area",-27):this.initializeEmptyChartView()},processIntensityMinutesReport:function(){if(this.reportMetrics&&this.reportMetrics.length>0){var e=this.reportMetrics.at(0),t=e.get("metricsMap"),n=t.WELLNESS_MODERATE_INTENSITY_MINUTES;this.initializeChartView(b,"column",-27)}else this.initializeEmptyChartView()},processTotalCalorieReport:function(){nt.determineNonZeroMetricsFound(this.reportMetrics,"WELLNESS_BMR_CALORIES")||nt.determineNonZeroMetricsFound(this.reportMetrics,"COMMON_ACTIVE_CALORIES")?this.initializeChartView(O,"column",-27):this.initializeEmptyChartView()},processLactateThresholdChartReport:function(){this.activeTab=="current"||nt.determineNonZeroMetricsFound(this.reportMetrics,it.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM)||nt.determineNonZeroMetricsFound(this.reportMetrics,it.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC)?this.initializeChartView(w,"column",-30):(this.$(".chart-container .chart").removeClass("span9"),this.$(".lt-page").remove(),this.initializeEmptyChartView())},processScatterChartReport:function(){nt.determineNonZeroMetricsFound(this.reportMetrics,it[this.report.get("metricName")])?this.initializeScatterChartView():this.initializeEmptyChartView()},processFoodReport:function(){nt.determineNonNullMetricsFound(this.reportMetrics,it[this.report.get("metricName")])?this.initializeChartView(a,"column",-30):this.initializeEmptyChartView()},processPowerReport:function(){nt.determineNonZeroMetricsFound(this.reportMetrics,it[this.report.get("metricName")])?this.initializeChartView(E,"column",-27):this.initializeEmptyChartView()},processTrainingEffectChartReports:function(){this.showAerobicTE=nt.determineNonNullMetricsFound(this.reportMetrics,it.ACTIVITY_AEROBIC_TRAINING_EFFECT),this.showAnaerobicTE=nt.determineNonNullMetricsFound(this.reportMetrics,it.ACTIVITY_ANAEROBIC_TRAINING_EFFECT),this.$(".js-report-date-range").show(),this.$(".js-today-btn").show(),this.$(".icon-arrow-left").show(),this.$(".icon-arrow-right").show(),this.showAerobicTE||this.showAnaerobicTE?this.displayTEGaugeChart?(this.$(".js-report-date-range").hide(),this.$(".js-today-btn").hide(),this.$(".icon-arrow-left").hide(),this.$(".icon-arrow-right").hide(),this.initializeTrainingEffectCurrentView()):this.initializeTrainingEffectColumnChartView("column",-28):this.initializeEmptyChartView()},processStrengthTrainingReport:function(){this.reportMetrics.length>0?(this.initializeChartView(S,"line",-27),this.chartFormat==="page"&&(this.processActivityList(),this.exerciseFilterView?(this.exerciseFilterView.setExerciseList(this.reportMetrics),this.exerciseFilterView.render()):(this.exerciseFilterView=new o({metricsList:this.reportMetrics}),this.exerciseFilterView.render(),this.$("#reportFilter").append(this.exerciseFilterView.$el)),this.$("#reportFilter").show(),this.listenTo(this.exerciseFilterView,o.Events.EXERCISE_FILTER_SELECTED,this.onStrengthTrainingFilter))):(this.initializeEmptyChartView(),this.$("#reportActivityList").hide(),this.$("#reportFilter").hide())},onStrengthTrainingFilter:function(e){this.reportChartView.setFilter(e),this.reportChartView.render()},processTrainingStatusReport:function(){this.chartFormat==="widget"?this.initializeTrainingStatusCurrentView():(this.trainingStatusData=this.buildTrainingStatusData(),this.initializeTrainingStatusReportHeaderView(),this.initializeTrainingStatusReportView())},processHRVStressReport:function(){this.$(".hrv-info-trigger").show(),this.$(".hrv-info-filter").hide(),this.showHRVStress=nt.determineNonNullMetricsFound(this.reportMetrics,it.ACTIVITY_HRV_STRESS_TEST),this.$(".js-report-date-range").show(),this.$(".js-today-btn").show(),this.$(".icon-arrow-left").show(),this.$(".icon-arrow-right").show();if(this.showHRVStress)this.$(".js-report-date-range").show(),this.$(".js-today-btn").show(),this.$(".icon-arrow-left").show(),this.$(".icon-arrow-right").show(),this.initializeHRVStressReportView("column",28);else{var e=this.chartFormat==="widget";e&&this.$(".js-report-date-range").hide(),this.initializeEmptyChartView(!0,e)}},processActivityList:function(){this.chartFormat==="page"&&this.activityListEnabled&&(this.activityListView?(this.activityListView.setActivityList(this.activityList,this.aggregation),this.activityListView.clearLastIndex(),this.activityListView.render()):(this.activityListView=new x({activityList:this.activityList,aggregation:this.aggregation}),this.activityListView.render(),this.$("#reportActivityList").append(this.activityListView.$el)),this.$("#reportActivityList").show(),this.listenTo(this.activityListView,x.Events.SHOW_MORE_CLICKED,this.onShowMoreClicked),this.listenTo(this.activityList,z.Events.ACTIVITIES_FETCHED,this.onActivitiesFectched),this.listenTo(this.activityList,z.Events.NO_MORE_ACTIVITIES,this.onNoMoreActivities))},initializeHRVStressReportView:function(e,t){this.reportChartView=new m({report:this.report.toJSON(),reportType:this.reportType,chartFormat:this.chartFormat,chartType:e,metricList:this.reportMetrics,metricPeriod:this.metricPeriod,currentDateOffset:this.currentDateOffset,userPreferences:this.userPreferences,daysInMonth:t,displayName:this.displayName,hrvStressReportMetricPeriod:this.hrvStressReportMetricPeriod,el:this.$("."+this.chartPlaceholder)})},initializeTrainingEffectColumnChartView:function(e,t){this.reportChartView=new R({report:this.report.toJSON(),reportType:this.reportType,chartFormat:this.chartFormat,chartType:e,trainingEffectMetricPeriod:this.trainingEffectMetricPeriod,currentDateOffset:this.currentDateOffset,userPreferences:this.userPreferences,metricList:this.reportMetrics,daysInMonth:t,showAnaerobicTE:this.showAnaerobicTE,showAerobicTE:this.showAerobicTE,el:this.$("."+this.chartPlaceholder)})},initializeTrainingEffectCurrentView:function(){this.reportChartView=new q({el:this.$("."+this.chartPlaceholder),metricList:this.reportMetrics}),this.listenTo(this.reportChartView,q.Event.ModelSyncFail,this.onModelSyncFail)},initializeTrainingStatusCurrentView:function(){this.reportChartView&&(this.reportChartView.remove(),this.reportChartView=null),this.reportChartView=new M({metricList:this.reportMetrics}),this.$("#widget-current-status-container").html(this.reportChartView.el)},initializeTrainingStatusReportHeaderView:function(){this.trainingStatusReportHeader=new _({metricList:this.trainingStatusData,untilDate:this.untilDate}),this.$("#report-current-status-container").html(this.trainingStatusReportHeader.render().el)},initializeTrainingStatusReportView:function(){this.reportChartView=new D({report:this.report.toJSON(),reportType:this.reportType,metricList:this.trainingStatusData,vo2MaxData:this.vo2Metrics.at(0).get("metricsMap"),metricPeriod:this.metricPeriod,userPreferences:this.userPreferences,startDate:this.startDate,untilDate:this.untilDate,el:this.$("."+this.chartPlaceholder)}),this.listenTo(this.reportChartView,D.Events.SELECTED_DEVICE_CHANGE,this.onTSDeviceChange)},onModelSyncFail:function(){this.trigger(vt.MODEL_SYNC_FAIL)},initializeEmptyChartView:function(e,n){this.reportChartView=new N({el:this.$("."+this.chartPlaceholder),hidden:t.isUndefined(e)?!1:e,isWidget:t.isUndefined(n)?!1:n})},initializeChartView:function(e,t,n){this.reportChartView=new e({report:this.report.toJSON(),reportType:this.reportType,activeTab:this.activeTab,metricList:this.reportMetrics,metricPeriod:this.displayPeriod,userPreferences:this.userPreferences,daysInMonth:n,chartType:t,chartFormat:this.chartFormat,currentDateOffset:this.currentDateOffset,el:this.$("."+this.chartPlaceholder)}),this.trigger(vt.ON_TAB_CHANGED,!0)},initializeScatterChartView:function(){this.$(".reportComparisonPlaceholder").show();var e=0;switch(this.report.get("metricName")){case it.ACTIVITY_AVERAGE_SPEED:case it.ACTIVITY_AVERAGE_PACE:case it.ACTIVITY_AVERAGE_SWIM_PACE:this.reportMetrics.each(function(t){var n=t.get("metricsMap"),r=n.ACTIVITY_TOTAL_DURATION,i=n.ACTIVITY_TOTAL_DISTANCE,s=0,o=0;if(r)for(var u=0;u<r.length;u++){var a=r[u];s+=a.value}if(i)for(var u=0;u<i.length;u++){var f=i[u];o+=f.value}o>0&&s>0&&(this.report.get("metricName")==it.ACTIVITY_AVERAGE_PACE||this.report.get("metricName")==it.ACTIVITY_AVERAGE_SWIM_PACE?e=s/o:e=o/s)},this);break;default:var t=this.reportMetrics.at(0),n=t.get("metricsMap"),r=n[this.report.get("metricName")],i=0,s=0;if(r)for(var o=0;o<r.length;o++){var t=r[o];t.value&&t.value>0&&(i+=t.value,s++)}e=Math.round(i/s*1e3)/1e3}this.reportChartView=new C({report:this.report.toJSON(),reportType:this.reportType,activeTab:this.activeTab,metricList:this.reportMetrics,metricPeriod:this.displayPeriod,userPreferences:this.userPreferences,chartFormat:this.chartFormat,chartType:"scatter",metricColorRanges:this.metricColorRanges,metricAvg:e,currentDateOffset:this.currentDateOffset,el:this.$("."+this.chartPlaceholder)}),this.trigger(vt.ON_TAB_CHANGED,!0)},processFTPMaxChartView:function(){this.activeTab=="current"?(this.chartFormat==="page"?this.$(".chart-widget").addClass("chart-gauge-ftp"):this.$(".chart-widget").addClass("chart-gauge-vo2"),this.$(".reports-pagination").hide(),this.ftpMaxToggle=this.ftpMaxToggle||"ftp-watts",this.$(".ftp-watts-trend").removeClass("ftp-watts-trend").addClass("ftp-watts"),this.$(".ftp-watts-kg-trend").removeClass("ftp-watts-kg-trend").addClass("ftp-watts-kg"),this.$(".ftp-filter").show(),this.$(".ftp-watts").removeClass("active"),this.$(".ftp-watts-kg").removeClass("active"),this.$("."+this.ftpMaxToggle).addClass("active"),this.reportChartView=new l({report:this.report.toJSON(),reportType:this.reportType,chartFormat:this.chartFormat,ftpMaxToggle:this.ftpMaxToggle,el:this.$("."+this.chartPlaceholder)}),this.reportChartView.once(l.Events.NO_DATA_AVAILABLE,function(){this.initializeEmptyChartView(),this.$(".ftp-filter").hide(),this.$(".chart-widget").removeClass("chart-gauge-vo2"),this.reportChartView.render()},this),this.ftpLegendView=new c({chartFormat:this.chartFormat,el:this.$(".js-report-chart-compare")}),this.ftpLegendView.render(),this.trigger(vt.ON_TAB_CHANGED,!0)):(this.$(".chart-widget").removeClass("chart-gauge-vo2"),this.$(".reports-pagination").show(),this.$(".additionalPlaceHolder").children().length>0&&(this.$(".additionalPlaceHolder").children().remove(),this.$("."+this.chartPlaceholder).parent().find(".reportChartPlaceholder").show()),nt.determineNonZeroMetricsFound(this.reportMetrics,it[this.report.get("metricName")])?(this.$(".ftp-watts").removeClass("ftp-watts").addClass("ftp-watts-trend"),this.$(".ftp-watts-kg").removeClass("ftp-watts-kg").addClass("ftp-watts-kg-trend"),this.$(".ftp-filter").show(),this.ftpMaxToggle=t.isUndefined(this.ftpMaxToggle)?"ftp-watts":this.ftpMaxToggle,this.$(".ftp-watts-trend").removeClass("active"),this.$(".ftp-watts-kg-trend").removeClass("active"),this.$("."+this.ftpMaxToggle+"-trend").addClass("active"),this.reportChartView=new p({report:this.report.toJSON(),reportType:this.reportType,activeTab:this.activeTab,metricList:this.reportMetrics,metricPeriod:this.displayPeriod,userPreferences:this.userPreferences,daysInMonth:-27,chartType:"line",chartFormat:this.chartFormat,currentDateOffset:this.currentDateOffset,ftpMaxToggle:this.ftpMaxToggle,el:this.$("."+this.chartPlaceholder)}),this.trigger(vt.ON_TAB_CHANGED,!0)):(this.$(".ftp-filter").hide(),this.initializeEmptyChartView()))},initializeVo2MaxChartView:function(){this.reportChartView=new H({el:this.$("."+this.chartPlaceholder),chartFormat:this.chartFormat,report:this.report.toJSON(),reportType:this.reportType,vo2MaxMetrics:this.vo2MaxMetrics,gender:this.gender,ageRange:this.ageRange,vo2MaxCategories:this.vo2MaxCategories,vo2MaxToggle:this.vo2MaxToggle}),this.trigger(vt.ON_TAB_CHANGED,!0)},initializeVo2MaxDynamicTextView:function(){this.vo2MaxDynamicTextView=new B({el:this.$(".js-report-chart-compare"),chartFormat:this.chartFormat,reportType:this.reportType,vo2MaxMetrics:this.vo2MaxMetrics,gender:this.gender,ageRange:this.ageRange,vo2MaxToggle:this.vo2MaxToggle}),this.vo2MaxDynamicTextView.render()},onCurrentClicked:function(){this.pageOffset=0,this.report.get("metricName")===it.ACTIVITY_TRAINING_STATUS?this.activeTab="last_four_weeks":this.activeTab="current",this.processCurrentTab(),this.updateUrl(),this.trigger(vt.ON_TAB_CHANGED,!1)},onSevenDaysClicked:function(){this.pageOffset=0,this.activeTab="last_seven_days",this.processSevenDayTab(),this.updateUrl(),this.trigger(vt.ON_TAB_CHANGED,!1)},onFourWeeksClicked:function(){this.pageOffset=0,this.activeTab="last_four_weeks",this.processFourWeekTab(),this.updateUrl(),this.trigger(vt.ON_TAB_CHANGED,!1)},onSixMonthsClicked:function(){this.pageOffset=0,this.activeTab="last_six_months",this.processSixMonthTab(),this.updateUrl(),this.trigger(vt.ON_TAB_CHANGED,!1)},onTwelveMonthsClicked:function(){this.pageOffset=0,this.activeTab="last_year",this.processTwelveMonthTab(),this.updateUrl(),this.trigger(vt.ON_TAB_CHANGED,!1)},onTodayButtonClicked:function(e){e.preventDefault(),this.report&&this.report.get("metricName")===it.ACTIVITY_TRAINING_STATUS&&this.buildPrevRecordedDevices(),this.pageOffset=0,this.tabNavigation()},onPreviousClicked:function(e){e.preventDefault(),this.report&&this.report.get("metricName")===it.ACTIVITY_TRAINING_STATUS&&this.buildPrevRecordedDevices(),this.pageOffset++,this.tabNavigation(),this.pushPreviousClickedAnalyticsEvents()},pushPreviousClickedAnalyticsEvents:function(){ft.push({event:"track_event",category:"Reports Page Events",Action:"Navigate To Previous Date"})},onNextClicked:function(e){e.preventDefault(),this.report&&this.report.get("metricName")===it.ACTIVITY_TRAINING_STATUS&&this.buildPrevRecordedDevices(),this.pageOffset--,this.tabNavigation()},onFtpTrendClicked:function(e){e.preventDefault();var t=jQuery(e.target),n=t.hasClass("ftp-watts-trend")?"ftp-watts":"ftp-watts-kg";if(this.ftpMaxToggle==n)return;this.ftpMaxToggle=n,this.reportChartView.toggle(this.ftpMaxToggle),this.trigger(vt.ON_FTP_MAX_TOGGLE,this.ftpMaxToggle),this.$(".ftp-watts-trend").removeClass("active"),this.$(".ftp-watts-kg-trend").removeClass("active"),t.addClass("active")},onTEHelpClicked:function(){var e=new U({aerobicTrainingEffect:this.showAerobicTE?0:null,anaerobicTrainingEffect:this.showAnaerobicTE?0:null,isWidget:this.chartFormat==="widget"});this.trainingEffectModal=new I({view:e,showFooter:!1,customClasses:"modal-training-effect",modalTitle:r.localize("label.trainingEffect")}),this.trainingEffectModal.render()},onTSHelpClicked:function(){var e=new P({isWidget:this.chartFormat==="widget"}),t=new I({view:e,showFooter:!1,customClasses:"modal-training-status",modalTitle:r.localize("TRAINING_STATUS")});t.render()},onTSDeviceChange:function(e){this.trainingStatusReportHeader&&this.trainingStatusReportHeader.onDeviceChanged(e)},displayFTPWeight:function(e,t,n){var i=new d({prompt:r.localize("ftp.weight.modal.prompt"),weightDate:e}),s=new I({modalTitle:r.localize("ftp.modal.title"),view:i,showFooter:!0,showCancelButton:!1});i.once(d.Events.WEIGHT_SUCCESS,function(){t.addClass("active"),n.removeClass("active"),this.ftpMaxToggle="ftp-watts-kg",this.trigger(vt.ON_FTP_MAX_TOGGLE,this.ftpMaxToggle),s.close(),this.trigger(vt.ON_TAB_CHANGED,!1),this.retrieveChartMetrics(),this.resetReportUrl()},this),i.once(d.Events.WEIGHT_LOADED,function(){s.render()},this),i.render()},onFtpMaxFilterClicked:function(e){e.preventDefault();var t=jQuery(e.target),n=t.hasClass("ftp-watts")?"ftp-watts":"ftp-watts-kg";if(this.ftpMaxToggle==n)return;this.ftpMaxToggle=n;var r=this.reportChartView.displayWeightPrompt(this.ftpMaxToggle);if(r.displayWeightPrompt){this.ftpMaxToggle="ftp-watts",this.$(".ftp-watts").addClass("active"),this.$(".ftp-watts-kg").removeClass("active");if(this.chartFormat=="widget"){var i=this;this.trigger(vt.DISPLAY_FTP_WEIGHT,{weightDate:r.weightDate,successHandler:function(){t.addClass("active"),i.ftpMaxToggle="ftp-watts-kg",i.trigger(vt.ON_FTP_MAX_TOGGLE,i.ftpMaxToggle),i.retrieveChartMetrics(),i.resetReportUrl(),i.trigger(vt.FTP_WEIGHT_ENTERED)}})}else this.displayFTPWeight(r.weightDate,t,this.$(".ftp-watts"))}else this.$(".ftp-watts").removeClass("active"),this.$(".ftp-watts-kg").removeClass("active"),t.addClass("active"),this.processCurrentTab(),this.trigger(vt.ON_TAB_CHANGED,!1),this.trigger(vt.ON_FTP_MAX_TOGGLE,this.ftpMaxToggle)},onVo2MaxFilterClicked:function(e){e.preventDefault(),this.pageOffset=0,this.activeTab="current",this.vo2MaxToggle=this.$(".vo2-sport-filter-running").hasClass("active")?"cycling":"running",this.processCurrentTab(),this.trigger(vt.ON_TAB_CHANGED,!1)},onVo2MaxHelpModal:function(){var e=new j({chartFormat:this.chartFormat,reportType:this.reportType,vo2MaxMetrics:this.vo2MaxMetrics,gender:this.gender,ageRange:this.ageRange,vo2MaxToggle:this.vo2MaxToggle}),t=new I({modalTitle:this.getVo2MaxHelpModalTitle(),view:e,customBodyClasses:"modal-tall",showFooter:!1,showCancelButton:!1});t.render()},getVo2MaxHelpModalTitle:function(){return this.reportType==="cycling"||this.reportType==="all"&&this.vo2MaxToggle==="cycling"?r.localize("vo2_max_cycling_title"):r.localize("ACTIVITY_VO2_MAX")},onShowMoreClicked:function(){this.activityList.fetchMore()},onActivitiesFectched:function(){this.activityListView.drawAdditionalRows(this.activityList)},onNoMoreActivities:function(){this.activityListView.hideShowMore()},tabNavigation:function(){switch(this.tabSelection){case"seven-day":this.processSevenDayTab();break;case"four-week":this.processFourWeekTab();break;case"six-month":this.processSixMonthTab();break;case"twelve-month":this.processTwelveMonthTab()}},getExportData:function(){return this.reportChartView.getExportData()},getActiveTab:function(){return this.activeTab},updateUrl:function(){if(this.chartFormat=="page"){var e="/report/"+this.report.get("metricId")+"/"+this.reportType+"/"+this.activeTab;n.history.navigate(e,{trigger:!1})}},renderHRVInfoModal:function(){var e=r.localize("ACTIVITY_HRV_STRESS_TEST"),t=new y,n=new I({modalTitle:e,view:t,showFooter:!1,showCancelButton:!1});n.render()}});return gt.Events=vt,gt}),define("text!widgets/report/templates/report.html",[],function(){return'<!-- ============================================================================================== -->\n<!-- Report Widget                                                                                 -->\n<!-- ============================================================================================== -->\n\n<!-- If the user hasn\'t selected a report, present a list of items to choose from -->\n<% if (!report) {%>\n\n<div class="text-center">\n\n    <h5 class="font-thin top-l"><%= Localizer.localize(\'report.choose\') %></h5>\n\n    <select name="select-report" class="center-input">\n        <option value=\'\'><%= Localizer.localize(\'select.one\') %></option>\n        <% for(var i=0; i < reports.length; i++) { %>\n        <% if (reportTypes[reports[i].metricName]) { %>\n        <option value=\'<%= reports[i].metricId %>\'><%= Localizer.localize(reports[i].metricName) %></option>\n        <% } %>\n        <% } %>\n    </select>\n\n    <button id="btn-save-report-config" class="btn top-s btn-reports-save"><%= Localizer.localize(\'save\') %></button>\n\n</div>\n\n\n<% } else { %>\n\n\n<!-- Report Info View -->\n\n<div class="js-report-controller-placeholder"></div>\n\n<% if (report.metricName === \'ACTIVITY_NORMALIZED_POWER\' || report.metricName === \'ACTIVITY_TRAINING_STRESS_SCORE\') { %>\n<div class="legal dense muted absolute-bottom-left">\n    <%= Localizer.localize(\'normalized_power_legal_notice\') %>&nbsp;<a href="http://trainingpeaks.com/" class="colored" target="_blank">Peaksware, LLC</a>.\n</div>\n<% } %>\n<!-- END .widget-content -->\n\n<% }       %>\n\n'}),define("text!widgets/report/templates/noData.html",[],function(){return'<div class="text-center">\n    <h5 class="font-thin top-l"><%~ Localizer.localize(\'report.add.msg\') %></h5>\n</div>\n'}),define("widgets/report/Reports",["require","underscore","backbone","localizer","personalizer","models/reports/AvailableReport","models/reports/StatisticsAvailability","collections/activity/ActivitiesByActivityType","collections/activity/ActivityTypes","models/indicators/UsageIndicators","collections/reports/AvailableReports","views/main/WidgetView","views/report/ReportControllerView","views/report/FTPWeightView","utils/ChartTypes","utils/ModelSynchronizer","utils/ReportTypes","utils/RoleUtil","utils/NavigationUtil","utils/ReportTypeMetricIds","utils/TrainingStatusUtil","constants/main/ApplicationEvents","text!widgets/report/templates/report.html","text!templates/main/Widget/SmallWidgetContent.html","text!widgets/report/templates/noData.html"],function(e){var t=e("underscore"),n=e("backbone"),r=e("localizer"),i=e("personalizer"),s=e("models/reports/AvailableReport"),o=e("models/reports/StatisticsAvailability"),u=e("collections/activity/ActivitiesByActivityType"),a=e("collections/activity/ActivityTypes"),f=e("models/indicators/UsageIndicators"),l=e("collections/reports/AvailableReports"),c=e("views/main/WidgetView"),h=e("views/report/ReportControllerView"),p=e("views/report/FTPWeightView"),d=e("utils/ChartTypes"),v=e("utils/ModelSynchronizer"),m=e("utils/ReportTypes"),g=e("utils/RoleUtil"),y=e("utils/NavigationUtil"),b=e("utils/ReportTypeMetricIds"),w=e("utils/TrainingStatusUtil"),E=e("constants/main/ApplicationEvents"),S=e("text!widgets/report/templates/report.html"),x=e("text!templates/main/Widget/SmallWidgetContent.html"),T=e("text!widgets/report/templates/noData.html");return c.extend({viewStates:[{name:"large-state",views:[{titleKeyName:"title_reports_widget_report",menuKeyName:"title_reports_widget_report_details",headerUrl:function(){if(this.report&&this.report.get("metricId")){var e=this.widgetState.get("args"),t=e.ftpMaxToggle;return t?"/report/"+this.report.get("metricId")+"/"+this.reportType+"/"+this.activeTab+"/"+t:+this.report.get("metricId")<0?"/report/"+this.report.get("metricName").toLowerCase()+"/"+this.reportType+"/"+this.activeTab:"/report/"+this.report.get("metricId")+"/"+this.reportType+(this.report.get("metricName")==m.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC||this.report.get("metricName")==m.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM?"/last_four_weeks":"/"+this.activeTab)}return g.isWellnessUserOnly()?"/report/29/wellness":"/report/16/all"},name:"reports",stateClassName:"widget-medium reports widget-vo2",templateHtml:S,noDataTemplateHtml:T,showFooter:!1,hasConfiguration:!0,menuGroups:[{groupName:"setup",menuItems:[{key:"menu_configure_report",handlerName:"onAddButtonClicked",index:1}]},{groupName:"duration",menuItems:[{key:"last_seven_days",handlerName:"onLastSevenDaysClicked",index:1},{key:"last_four_weeks",handlerName:"onLastFourWeeksClicked",index:2},{key:"last_six_months",handlerName:"onLastSixMonthsClicked",index:3},{key:"last_year",handlerName:"onLastYearClicked",index:4}]}]}]},{name:"small-state",views:[{titleKeyName:"title_reports_widget_report",menuKeyName:"title_widget_small",name:"reportsSmall",stateClassName:"widget widget-small",headerUrl:function(){return g.isWellnessUserOnly()?"/report/29/wellness":"/report/16/all"},templateHtml:x,noDataTemplateHtml:x,showFooter:!1,showHeaderTitle:!1}]}],propertyFiles:["/main/js/properties/units/units","/main/js/properties/settings/settings","/main/js/properties/userprofile/userprofile","/main/js/properties/reportswidget/reportswidget","/main/js/properties/vo2maxreportswidget/vo2maxreportswidget","/main/js/properties/wellness/wellness","/main/js/properties/activity_types/activity_types","/main/js/properties/legal/legal","/main/js/properties/activity-api/activity-api","/main/js/properties/stress/stress","/main/js/properties/daily_summary/daily_summary","/main/js/properties/device/device","/main/js/properties/stress_report/stress_report","/main/js/properties/weightwidget/weightwidget"],widgetEvents:{"change select":"onSelectionBoxChanged","click #btn-save-report-config":"onSaveClicked"},applicationEvents:{FTP_WEIGHT_CHANGED:"onFtpWeightChanged"},initializeWidget:function(e){this.metricId=e.metricId,this.activeTab=e.metricPeriod,this.report=null,this.reports=new l,this.reports.setDisplayName(this.userPreferences.get("displayName")),this.statisticsAvailabilityReports=new o,this.statisticsAvailabilityReports.setDisplayName(this.userPreferences.get("displayName")),this.activityTypes=new a([]),this.createReportModels(),this.usageIndicators=new f,t.bind(this.displayFtpTakeover,this)},createReportModels:function(){this.metricId&&typeof this.metricId!="undefined"&&(this.report=new s({metricId:this.metricId}))},addNonStandardMetrics:function(){w.isTrainingStatusAvailable(this.usageIndicators)&&this.addTrainingStatusReport();if(this.usageIndicators.checkDeviceIndicator("hasVO2MaxRunCapableDevice")){var e=new s({metricId:b.ACTIVITY_VO2_MAX});e.set("metricName",m.ACTIVITY_VO2_MAX),this.reports.add(e)}if(this.usageIndicators.checkDeviceIndicator("hasVO2MaxBikeCapableDevice")){var t=new s({metricId:b.ACTIVITY_VO2_MAX_CYCLING});t.set("metricName",m.ACTIVITY_VO2_MAX_CYCLING),this.reports.add(t)}this.setHRVStressVisibility()},addTrainingStatusReport:function(){var e=new s({metricId:b.ACTIVITY_TRAINING_STATUS});e.set("metricName",m.ACTIVITY_TRAINING_STATUS),this.reports.add(e)},lactateThresholdCheck:function(){if(this.report&&this.activeTab=="current"&&(this.report.get("metricName")==m.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC||this.report.get("metricName")==m.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM)){var e="/report/"+this.report.get("metricId")+"/"+this.reportType+"/last_four_weeks";this.updateWidgetTitleLink(e)}},updateWidgetTitleLink:function(e){this.$(".widget-title a").attr("href",y.url(e))},onDependenciesLoaded:function(e){this.addNonStandardMetrics();if(e===0&&this.reports&&this.reports.hasReport(m.ACTIVITY_NUMBER_OF_ACTIVITIES))return!1;if(e===1&&this.repCountingActivityList.length>0){var t=new s({metricId:b.STRENGTH_TRAINING,metricName:m.STRENGTH_TRAINING});this.reports.add(t)}if(this.reports.length==1&&typeof this.metricId=="undefined")return this.report=this.reports.at(0),this.metricId=this.report.get("metricId"),this.updateReportWidget(this.metricId,!1),this.createReportModels(),!1;if(this.report&&this.report.get("metricName")===m.ACTIVITY_VO2_MAX||this.report&&this.report.get("metricName")===m.ACTIVITY_VO2_MAX_CYCLING||this.report&&this.report.get("metricName")===m.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM||this.report&&this.report.get("metricName")===m.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC||this.report&&this.report.get("metricName")===m.ACTIVITY_MAX_FTP||this.report&&this.report.get("metricName")===m.ACTIVITY_HRV_STRESS_TEST){this.addCustomMenuItem("duration",{key:"current",handlerName:"onCurrentClicked",index:0});switch(this.report.get("metricName")){case m.ACTIVITY_VO2_MAX:case m.ACTIVITY_VO2_MAX_CYCLING:case m.ACTIVITY_MAX_FTP:this.removeMenuItem("duration","last_seven_days")}}this.report&&this.report.get("metricName")===m.ACTIVITY_TRAINING_STATUS&&(this.removeMenuItem("duration","last_four_weeks"),this.removeMenuItem("duration","last_seven_days"));if(this.report&&this.report.get("metricName")===m.ACTIVITY_AEROBIC_TRAINING_EFFECT||this.report&&this.report.get("metricName")===m.ACTIVITY_ANAEROBIC_TRAINING_EFFECT||this.report&&this.report.get("metricName")===m.ACTIVITY_TRAINING_STATUS||this.report&&this.report.get("metricName")===m.ACTIVITY_HRV_STRESS_TEST)this.removeMenuItem("duration","last_six_months"),this.removeMenuItem("duration","last_year");if(this.report&&this.report.get("metricName"))switch(this.report.get("metricName")){case m.ACTIVITY_ACTIVE_CALORIES:case m.ACTIVITY_AVERAGE_SPEED:case m.ACTIVITY_AVERAGE_PACE:case m.ACTIVITY_AVERAGE_HEART_RATE:case m.ACTIVITY_MAX_HEART_RATE:case m.ACTIVITY_NUMBER_OF_ACTIVITIES:case m.ACTIVITY_TOTAL_DISTANCE:case m.ACTIVITY_TOTAL_DURATION:case m.ACTIVITY_TRAINING_STATUS:case m.ACTIVITY_HRV_STRESS_TEST:this.reportType="all";break;case m.ACTIVITY_AVERAGE_POWER:case m.ACTIVITY_AVERAGE_BIKE_CADENCE:case m.ACTIVITY_NORMALIZED_POWER:case m.ACTIVITY_MAX_20_MIN_AVERAGE_POWER:case m.ACTIVITY_TRAINING_STRESS_SCORE:case m.ACTIVITY_VO2_MAX_CYCLING:case m.ACTIVITY_MAX_FTP:case m.ACTIVITY_TRAINING_STATUS:this.reportType="cycling";break;case m.ACTIVITY_AVERAGE_RUN_CADENCE:case m.ACTIVITY_VERTICAL_OSCILLATION:case m.ACTIVITY_GROUND_CONTACT_TIME:case m.ACTIVITY_AVG_STRIDE_LENGTH:case m.ACTIVITY_AVG_VERTICAL_RATIO:case m.ACTIVITY_AVG_GROUND_CONTACT_BALANCE:case m.ACTIVITY_AVG_LACTATE_THRESHOLD_BPM:case m.ACTIVITY_AVG_LT_SPEED_MTR_PER_SEC:case m.ACTIVITY_AEROBIC_TRAINING_EFFECT:case m.ACTIVITY_ANAEROBIC_TRAINING_EFFECT:case m.ACTIVITY_TRAINING_STATUS:this.reportType="running";break;case m.ACTIVITY_AVERAGE_STROKES:case m.ACTIVITY_AVERAGE_SWOLF:case m.ACTIVITY_MINIMUM_SWOLF:case m.ACTIVITY_AVERAGE_SWIM_PACE:this.reportType="swimming";break;case m.COMMON_TOTAL_CALORIES:case m.WELLNESS_TOTAL_STEPS:case m.SLEEP_SLEEP_DURATION:case m.FOOD_CALORIES_CONSUMED:case m.FOOD_CALORIES_REMAINING:case m.WELLNESS_FLOORS_ASCENDED:case m.WELLNESS_MODERATE_INTENSITY_MINUTES:case m.WELLNESS_RESTING_HEART_RATE:case m.WELLNESS_AVERAGE_STRESS:case m.ACTIVITY_VO2_MAX:this.reportType="wellness";break;case m.STRENGTH_TRAINING:this.reportType="strength_training";break;default:this.reportType="all"}return!0},metricNameComparator:function(e,t){var n=r.localize(e.metricName),i=r.localize(t.metricName),s=n.localeCompare(i);return s},postRender:function(e){this.enableSaveButton(!1);if(e=="large-state"&&this.report){if(!this.activeTab||this.activeTab=="undefined")this.report.get("metricId")==b.ACTIVITY_VO2_MAX||this.report.get("metricId")==b.ACTIVITY_VO2_MAX_CYCLING||this.report.get("metricId")==b.ACTIVITY_MAX_FTP?this.activeTab="current":this.activeTab="last_seven_days";this.setMenuSelected("duration",this.activeTab)}else this.menuItems={},e=="small-state"&&(!this.activeTab||this.activeTab=="undefined")&&(this.activeTab="last_seven_days");if(this.report&&this.report.get("metricName")){var t=this.widgetState.get("args"),n=t.ftpMaxToggle;this.reportControllerView=new h({el:this.$(".js-report-controller-placeholder"),report:this.report,reports:this.statisticsAvailabilityReports,reportType:this.reportType,chartFormat:"widget",userPreferences:this.userPreferences,displayName:this.getDisplayName(),activeTab:this.activeTab,ftpMaxToggle:n}),this.reportControllerView.bind(h.Events.ON_FTP_MAX_TOGGLE,this.onToggleFTPMax,this),this.reportControllerView.bind(h.Events.DISPLAY_FTP_WEIGHT,this.displayFtpTakeover,this),this.reportControllerView.bind(h.Events.FTP_WEIGHT_ENTERED,this.onFtpWeightEntered,this),this.reportControllerView.render()}this.lactateThresholdCheck()},maxPage:function(e,t){return 0},numLoadedPages:function(e,t){return this.reports.length==0&&!this.metricId?0:1},provideModels:function(e,t,n){if(e==="small-state")return{classIconName:"icon-reports"};var r=this.removeDuplicateReports(this.reports.toJSON());return r.sort(this.metricNameComparator),{report:this.report?this.report.toJSON():null,reports:r,reportTypes:m}},removeDuplicateReports:function(e){var n=t.filter(e,function(t,n){if(m[t.metricName])for(n+=1;n<e.length;n+=1)if(r.localize(t.metricName).localeCompare(r.localize(e[n].metricName))===0&&m[e[n].metricName])return this.log("Filtering out report "+t.metricName+", because it's localized value matches "+e[n].metricName),!1;return!0},this);return n},log:function(e){typeof console!="undefined"&&typeof console.log!="undefined"&&console.log((new Date).toString()+" - "+e)},provideDependencies:function(e,n){n===0?(e.addModel({model:this.reports,required:!0}),e.addModel({model:this.statisticsAvailabilityReports,required:!0}),e.addModel({model:this.usageIndicators,required:!0}),e.addModel({model:this.activityTypes,required:!0})):n===1&&(this.repCountingActivityList=new u(null,{displayName:this.userPreferences.get("displayName"),activityTypeId:this.activityTypes.findByTypeKey("strength_training").get("typeId"),maxCount:2}),e.addModel({model:this.repCountingActivityList,required:!0}));if(this.metricId&&typeof this.metricId!="undefined"){this.metricId=+this.metricId;if(this.metricId>=0)e.addModel({model:this.report,required:!0});else{var r=this;this.report.set("metricName",t.findKey(b,function(e){return e===r.metricId})),this.report.set("chartType",d.NONSTANDARD)}}},onAddButtonClicked:function(e){e.preventDefault(),this.updateReportWidget(null,!0)},updateReportWidget:function(e,t){var n=this.widgetState.get("args"),r=n.metricId,i=n.metricPeriod;if(r!=e){n.metricId=e;if(i=="current"&&e!=b.ACTIVITY_VO2_MAX&&e!=b.ACTIVITY_VO2_MAX_CYCLING&&e!=b.ACTIVITY_MAX_FTP&&e!=b.ACTIVITY_TRAINING_STATUS)n.metricPeriod="last_seven_days";else{if(e==b.ACTIVITY_VO2_MAX||e==b.ACTIVITY_VO2_MAX_CYCLING||e==b.ACTIVITY_MAX_FTP)n.metricPeriod="current";e==b.ACTIVITY_TRAINING_STATUS&&(n.metricPeriod="last_four_weeks")}this.widgetState.save(),t&&this.reload()}},updateReportPeriodWidget:function(e,t){var n=this.widgetState.get("args"),r=n.metricPeriod;r!=e&&(n.metricPeriod=e,this.widgetState.save(),t&&this.reload()),this.updateWidgetTitleLink("/report/"+this.report.get("metricId")+"/"+this.reportType+"/"+this.activeTab),this.lactateThresholdCheck()},onToggleFTPMax:function(e){var t=this.widgetState.get("args"),n=t.ftpMaxToggle;n!=e&&(t.ftpMaxToggle=e,this.widgetState.save()),this.$(".widget-title").find("a:first").attr("href",y.url("/report/"+this.report.get("metricId")+"/"+this.reportType+"/"+this.activeTab+"/"+e))},onSelectionBoxChanged:function(e){e.preventDefault();var t=e.currentTarget;this.selectedReport=t.value,this.selectedReport?this.enableSaveButton(!0):this.enableSaveButton(!1)},enableSaveButton:function(e){var t=this.$("#btn-save-report-config");e?(t.removeAttr("disabled"),t.removeClass("disabled"),this.saveButtonEnabled=!0):(t.attr("disabled",!0),t.addClass("disabled"),this.saveButtonEnabled=!1)},onSaveClicked:function(e){e.preventDefault(),this.saveButtonEnabled&&this.updateReportWidget(this.selectedReport,!0)},onCurrentClicked:function(e){e.preventDefault(),this.report&&(+this.metricId===b.ACTIVITY_TRAINING_STATUS?this.activeTab="last_four_weeks":this.activeTab="current",this.setMenuSelected("duration",this.activeTab),this.updateReportPeriodWidget(this.activeTab,!1),this.reportControllerView.onCurrentClicked())},onLastSevenDaysClicked:function(e){e.preventDefault(),this.report&&(this.activeTab="last_seven_days",this.setMenuSelected("duration",this.activeTab),this.updateReportPeriodWidget(this.activeTab,!1),this.reportControllerView.onSevenDaysClicked())},onLastFourWeeksClicked:function(e){e.preventDefault(),this.report&&(this.activeTab="last_four_weeks",this.setMenuSelected("duration",this.activeTab),this.updateReportPeriodWidget(this.activeTab,!1),this.reportControllerView.onFourWeeksClicked())},onLastSixMonthsClicked:function(e){e.preventDefault(),this.report&&(this.activeTab="last_six_months",this.setMenuSelected("duration",this.activeTab),this.updateReportPeriodWidget(this.activeTab,!1),this.reportControllerView.onSixMonthsClicked())},onLastYearClicked:function(e){e.preventDefault(),this.report&&(this.activeTab="last_year",this.setMenuSelected("duration",this.activeTab),this.updateReportPeriodWidget(this.activeTab,!1),this.reportControllerView.onTwelveMonthsClicked())},displayFtpTakeover:function(e){var t=new p({displaySaveButton:!0,displayWeightLabel:!1,maxView:!1,prompt:r.localize("ftp.weight.title"),title:r.localize("ftp.weight.prompt"),weightDate:e.weightDate});t.bind(p.Events.WEIGHT_SUCCESS,function(){this.closeWidgetTakeover(),e.successHandler()},this),this.displaySheet(t,"","text-center widget-sheet-bottom")},onFtpWeightEntered:function(){this.raiseApplicationEvent(E.FTP_WEIGHT_CHANGED)},onFtpWeightChanged:function(){this.reload()},setHRVStressVisibility:function(){if(this.usageIndicators.get("deviceBasedIndicators").hasHrvStressTestCapableDevice){var e=new n.Model;e.set("metricId",b.ACTIVITY_HRV_STRESS_TEST),e.set("metricName","ACTIVITY_HRV_STRESS_TEST"),this.reports.add(e)}}})});