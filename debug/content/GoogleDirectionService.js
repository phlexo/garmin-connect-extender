define(["underscore","jquery","googleapis","views/utils/LeafletMap/utils/Util","views/utils/LeafletMap/MapServices/DirectionService"],function(e,t,n,r,i){var s={CYCLING:google.maps.TravelMode.BICYCLING,PEDESTRIAN:google.maps.TravelMode.WALKING},o=function(e){return i.call(this,e),this.directionService=new google.maps.DirectionsService,this.retryCount=0,this};return o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.retryCountSet=function(){this.retryCount=0},o.prototype.fetch=function(n,i){var o=google.maps.TravelMode.WALKING,u=this,a=new google.maps.LatLng(n.start[0],n.start[1]),f=new google.maps.LatLng(n.end[0],n.end[1]);s[this.transitMode]&&(o=s[this.transitMode]);var l={origin:a,destination:f,travelMode:o,provideRouteAlternatives:!1,avoidHighways:!0,avoidTolls:!0};n.isMetric?l.unitSystem=google.maps.UnitSystem.METRIC:l.unitSystem=google.maps.UnitSystem.IMPERIAL,this.directionService.route(l,function(e,a){if(a===google.maps.DirectionsStatus.OK){var f=e.routes[0],l=0;for(var c=0;c<f.legs.length;c++)l+=f.legs[c].distance.value;var h=[];t.each(f.overview_path,function(e,t){h.push([t.lat(),t.lng(),0,0])}),u.errorCount=0,n.success.call(i,{points:h,meters:l})}else o===s.CYCLING&&u.retryCount==0?(u.transitMode=r.TRANSIT_MODE.PEDESTRIAN,u.retryCount++,u.fetch(n,i)):n.error.call(i,a,a,r.ErrorCodes.GENERIC)})},o});