define(["underscore","jquery","personalizer","constants/map/map","views/utils/LeafletMap/utils/Util","views/utils/LeafletMap/MapServices/DirectionService"],function(e,t,n,r,i,s){var o={CYCLING:"Driving",PEDESTRIAN:"Walking"},u={"The route distance is too long to calculate a route.":i.ErrorCodes.ROUTE_TO_LONG,"One or more waypoints can't be routed because they are too far from any roads.":i.ErrorCodes.ROUTE_TO_FAR_FROM_ROADS},a=function(e){return s.call(this,e),this};return a.prototype=Object.create(s.prototype),a.prototype.constructor=a,a.prototype.fetch=function(s,a){var f=this.transitMode;o[this.transitMode]&&(f=o[this.transitMode]);var l=["https://dev.virtualearth.net/REST/v1/Routes/"];l.push(f+"?"),l.push("key="+r.bingKey),l.push("&wp.0="+s.start[0]+","+s.start[1]),l.push("&wp.1="+s.end[0]+","+s.end[1]),l.push("&rpo=Points"),l.push("&ra=routePath"),l.push("&avoid=highways,tolls"),l.push("&distanceUnit="+(s.isMetric?"km":"mi")),l.push("&jsonp=?"),t.getJSON(l.join(""),function(e){if(e.resourceSets&&e.resourceSets.length>0&&e.resourceSets[0].resources&&e.resourceSets[0].resources.length>0){var r=e.resourceSets[0].resources[0],o=s.isMetric?r.travelDistance*n.ConversionFactors.KmToMeters:r.travelDistance*n.ConversionFactors.MilesToMeters,f=[];t.each(r.routePath.line.coordinates,function(e,t){f.push([t[0],t[1],0,0])}),s.success.call(a,{points:f,meters:o})}else s.error.call(a,e.errorDetails[0],e.statusCode,u[e.errorDetails[0]]||i.ErrorCodes.GENERIC)}).fail(function(e,t,n){s.error.call(a,t,n,i.ErrorCodes.GENERIC)})},a});